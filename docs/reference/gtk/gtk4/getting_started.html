<!--
SPDX-FileCopyrightText: 2021 GNOME Foundation

SPDX-License-Identifier: Apache-2.0 OR GPL-3.0-or-later
-->

<!--
SPDX-FileCopyrightText: 2021 GNOME Foundation

SPDX-License-Identifier: Apache-2.0 OR GPL-3.0-or-later
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <title>Gtk &ndash; 4.0: Getting Started with GTK</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta charset="utf-8" />

  
  <meta property="og:type" content="website"/>

  
  <meta property="og:image:width" content="256"/>
  <meta property="og:image:height" content="256"/>
  <meta property="og:image:secure_url" content="gtk-logo.svg"/>
  <meta property="og:image:alt" content="Gtk-4.0"/>
  

  
  <meta property="og:title" content="Gtk: Getting Started with GTK"/>
  <meta property="og:description" content="Reference for Gtk-4.0: Getting Started with GTK"/>
  <meta name="twitter:title" content="Gtk: Getting Started with GTK"/>
  <meta name="twitter:description" content="Reference for Gtk-4.0: Getting Started with GTK"/>


  
  <meta name="twitter:card" content="summary"/>

  

  <link rel="stylesheet" href="style.css" type="text/css" />

  

  
  <script src="urlmap.js"></script>
  
  
  <script src="fzy.js"></script>
  <script src="search.js"></script>
  
  <script src="main.js"></script>
  <!--[if IE]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>

<body>
  <div id="body-wrapper" tabindex="-1">

    <nav class="sidebar devhelp-hidden">
      
      <div class="section">
        <img src="gtk-logo.svg" class="logo"/>
      </div>
      
      
      <div class="search section">
        <form id="search-form" autocomplete="off">
          <input id="search-input" type="text" name="do-not-autocomplete" placeholder="Click, or press 's' to search" autocomplete="off"/>
        </form>
      </div>
      
      <div class="section namespace">
        <h3><a href="index.html">Gtk</a></h3>
        <p>API Version: 4.0</p>
        
        <p>Library Version: 4.3.1</p>
        
      </div>
      
      
    </nav>

    
    <button id="btn-to-top" class="hidden"><span class="up-arrow"></span></button>
    

    
<section id="main" class="content">
  <section>
    <div class="docblock">
    <p><span class="caps">GTK</span> is a <a href="http://en.wikipedia.org/wiki/Widget_toolkit">widget toolkit</a>.
Each user interface created by <span class="caps">GTK</span> consists of widgets. This is implemented
in C using <a href="#gobject">GObject</a>, an object-oriented framework for C. Widgets
are organized in a hierarchy. The window widget is the main container.
The user interface is then built by adding buttons, drop-down menus, input
fields, and other widgets to the window. If you are creating complex user
interfaces it is recommended to use GtkBuilder and its <span class="caps">GTK</span>-specific markup
description language, instead of assembling the interface manually. You can
also use a visual user interface editor, like <a href="https://glade.gnome.org/">glade</a>.</p>
<p><span class="caps">GTK</span> is event-driven. The toolkit listens for events such as a click
on a button, and passes the event to your&nbsp;application.</p>
<p>This chapter contains some tutorial information to get you started with
<span class="caps">GTK</span> programming. It assumes that you have <span class="caps">GTK</span>, its dependencies and a C
compiler installed and ready to use. If you need to build <span class="caps">GTK</span> itself first,
refer to the <a href="#gtk-compiling">Compiling the <span class="caps">GTK</span> libraries</a> section in this&nbsp;reference.</p>
<h2 id="basics">Basics<a class="md-anchor" href="#basics" title="Permanent link"></a></h2>
<p>To begin our introduction to <span class="caps">GTK</span>, we&#8217;ll start with a very simple
application. This program will create an empty 200 Ã— 200 pixel&nbsp;window.</p>
<p><img alt="A window" src="window-default.png" /></p>
<p>Create a new file with the following content named <code>example-0.c</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">&lt;gtk/gtk.h&gt;</span><span class="cp"></span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">activate</span> <span class="p">(</span><span class="n">GtkApplication</span><span class="o">*</span> <span class="n">app</span><span class="p">,</span>
          <span class="n">gpointer</span>        <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">GtkWidget</span> <span class="o">*</span><span class="n">window</span><span class="p">;</span>

  <span class="n">window</span> <span class="o">=</span> <span class="n">gtk_application_window_new</span> <span class="p">(</span><span class="n">app</span><span class="p">);</span>
  <span class="n">gtk_window_set_title</span> <span class="p">(</span><span class="n">GTK_WINDOW</span> <span class="p">(</span><span class="n">window</span><span class="p">),</span> <span class="s">&quot;Window&quot;</span><span class="p">);</span>
  <span class="n">gtk_window_set_default_size</span> <span class="p">(</span><span class="n">GTK_WINDOW</span> <span class="p">(</span><span class="n">window</span><span class="p">),</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
  <span class="n">gtk_widget_show</span> <span class="p">(</span><span class="n">window</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span>
<span class="n">main</span> <span class="p">(</span><span class="kt">int</span>    <span class="n">argc</span><span class="p">,</span>
      <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">GtkApplication</span> <span class="o">*</span><span class="n">app</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

  <span class="n">app</span> <span class="o">=</span> <span class="n">gtk_application_new</span> <span class="p">(</span><span class="s">&quot;org.gtk.example&quot;</span><span class="p">,</span> <span class="n">G_APPLICATION_FLAGS_NONE</span><span class="p">);</span>
  <span class="n">g_signal_connect</span> <span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="s">&quot;activate&quot;</span><span class="p">,</span> <span class="n">G_CALLBACK</span> <span class="p">(</span><span class="n">activate</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">);</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">g_application_run</span> <span class="p">(</span><span class="n">G_APPLICATION</span> <span class="p">(</span><span class="n">app</span><span class="p">),</span> <span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
  <span class="n">g_object_unref</span> <span class="p">(</span><span class="n">app</span><span class="p">);</span>

  <span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>You can compile the program above with <span class="caps">GCC</span>&nbsp;using:</p>
<div class="codehilite"><pre><span></span><code>gcc $( pkg-config --cflags gtk4 ) -o example-0 example-0.c $( pkg-config --libs gtk4 )
</code></pre></div>

<p>For more information on how to compile a <span class="caps">GTK</span> application, please
refer to the <a href="#gtk-compiling">Compiling <span class="caps">GTK</span> Applications</a>
section in this&nbsp;reference.</p>
<p>All <span class="caps">GTK</span> applications will, of course, include <code>gtk/gtk.h</code>, which declares
functions, types and macros required by <span class="caps">GTK</span>&nbsp;applications.</p>
<p>Even if <span class="caps">GTK</span> installs multiple header files, only the top-level <code>gtk/gtk.h</code>
header can be directly included by third-party code. The compiler will abort
with an error if any other header is directly&nbsp;included.</p>
<p>In a <span class="caps">GTK</span> application, the purpose of the <code>main()</code> function is to create a
<a href="class.Application.html"><code>GtkApplication</code></a> object and run it. In this example a
<a href="class.Application.html"><code>GtkApplication</code></a> pointer named <code>app</code> is declared and then initialized
using <code>gtk_application_new()</code>.</p>
<p>When creating a <a href="class.Application.html"><code>GtkApplication</code></a>, you need to pick an application
identifier (a name) and pass it to <a href="ctor.Application.new.html">gtk_application_new()</a> as parameter. For
this example <code>org.gtk.example</code> is used. For choosing an identifier for your
application, see <a href="https://wiki.gnome.org/HowDoI/ChooseApplicationID">this guide</a>.
Lastly, <a href="ctor.Application.new.html">gtk_application_new()</a> takes <code>GApplicationFlags</code> as input
for your application, if your application would have special&nbsp;needs.</p>
<p>Next the <a href="https://wiki.gnome.org/HowDoI/GtkApplication">activate signal</a> is
connected to the activate() function above the <code>main()</code> function. The <code>activate</code>
signal will be emitted when your application is launched with <code>g_application_run()</code>
on the line below. The <code>g_application_run()</code> call also takes as arguments the
command line arguments (the <code>argc</code> count and the <code>argv</code> string array).
Your application can override the command line handling, e.g. to open
files passed on the&nbsp;commandline.</p>
<p>Within <code>g_application_run()</code> the activate signal is sent and we then proceed
into the activate() function of the application. This is where we construct
our <span class="caps">GTK</span> window, so that a window is shown when the application is launched.
The call to <a href="ctor.ApplicationWindow.new.html">gtk_application_window_new()</a> will create a new
<a href="class.ApplicationWindow.html"><code>GtkApplicationWindow</code></a> and store it inside the <code>window</code> pointer. The
window will have a frame, a title bar, and window controls depending on the&nbsp;platform.</p>
<p>A window title is set using <a href="method.Window.set_title.html">gtk_window_set_title()</a>. This function
takes a <code>GtkWindow</code> pointer and a string as input. As our <code>window</code> pointer
is a <code>GtkWidget</code> pointer, we need to cast it to <code>GtkWindow</code>; instead of
casting <code>window</code> via a typical C cast like <code>(GtkWindow*)</code>, <code>window</code> can be
cast using the macro <code>GTK_WINDOW()</code>. <code>GTK_WINDOW()</code> will check if the
pointer is an instance of the <code>GtkWindow</code> class, before casting, and emit a
warning if the check fails. More information about this convention can be
found <a href="https://developer.gnome.org/gobject/stable/gtype-conventions.html">here</a>.</p>
<p>Finally the window size is set using <a href="method.Window.set_default_size.html">gtk_window_set_default_size()</a>
and the window is then shown by <span class="caps">GTK</span> via <a href="method.Widget.show.html">gtk_widget_show()</a>.</p>
<p>When you close the window, by (for example) pressing the X button, the
<code>g_application_run()</code> call returns with a number which is saved inside an
integer variable named <code>status</code>. Afterwards, the <code>GtkApplication</code> object is
freed from memory with <code>g_object_unref()</code>. Finally the status integer is
returned and the application&nbsp;exits.</p>
<p>While the program is running, <span class="caps">GTK</span> is receiving <em>events</em>. These are typically
input events caused by the user interacting with your program, but also things
like messages from the window manager or other applications. <span class="caps">GTK</span> processes
these and as a result, <em>signals</em> may be emitted on your widgets. Connecting
handlers for these signals is how you normally make your program do something
in response to user&nbsp;input.</p>
<p>The following example is slightly more complex, and tries to
showcase some of the capabilities of <span class="caps">GTK</span>.</p>
<h2 id="hello-world">Hello, World<a class="md-anchor" href="#hello-world" title="Permanent link"></a></h2>
<p>In the long tradition of programming languages and libraries,
this example is called <em>Hello, World</em>.</p>
<p><img alt="Hello, world" src="hello-world.png" /></p>
<h3 id="hello-world-in-c">Hello World in C<a class="md-anchor" href="#hello-world-in-c" title="Permanent link"></a></h3>
<p>Create a new file with the following content named <code>example-1.c</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">&lt;gtk/gtk.h&gt;</span><span class="cp"></span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">print_hello</span> <span class="p">(</span><span class="n">GtkWidget</span> <span class="o">*</span><span class="n">widget</span><span class="p">,</span>
             <span class="n">gpointer</span>   <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">g_print</span> <span class="p">(</span><span class="s">&quot;Hello World</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">activate</span> <span class="p">(</span><span class="n">GtkApplication</span> <span class="o">*</span><span class="n">app</span><span class="p">,</span>
          <span class="n">gpointer</span>        <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">GtkWidget</span> <span class="o">*</span><span class="n">window</span><span class="p">;</span>
  <span class="n">GtkWidget</span> <span class="o">*</span><span class="n">button</span><span class="p">;</span>
  <span class="n">GtkWidget</span> <span class="o">*</span><span class="n">box</span><span class="p">;</span>

  <span class="n">window</span> <span class="o">=</span> <span class="n">gtk_application_window_new</span> <span class="p">(</span><span class="n">app</span><span class="p">);</span>
  <span class="n">gtk_window_set_title</span> <span class="p">(</span><span class="n">GTK_WINDOW</span> <span class="p">(</span><span class="n">window</span><span class="p">),</span> <span class="s">&quot;Window&quot;</span><span class="p">);</span>
  <span class="n">gtk_window_set_default_size</span> <span class="p">(</span><span class="n">GTK_WINDOW</span> <span class="p">(</span><span class="n">window</span><span class="p">),</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>

  <span class="n">box</span> <span class="o">=</span> <span class="n">gtk_box_new</span> <span class="p">(</span><span class="n">GTK_ORIENTATION_HORIZONTAL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="n">gtk_window_set_child</span> <span class="p">(</span><span class="n">GTK_WINDOW</span> <span class="p">(</span><span class="n">window</span><span class="p">),</span> <span class="n">box</span><span class="p">);</span>

  <span class="n">button</span> <span class="o">=</span> <span class="n">gtk_button_new_with_label</span> <span class="p">(</span><span class="s">&quot;Hello World&quot;</span><span class="p">);</span>
  <span class="n">g_signal_connect</span> <span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="s">&quot;clicked&quot;</span><span class="p">,</span> <span class="n">G_CALLBACK</span> <span class="p">(</span><span class="n">print_hello</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">);</span>
  <span class="n">g_signal_connect_swapped</span> <span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="s">&quot;clicked&quot;</span><span class="p">,</span> <span class="n">G_CALLBACK</span> <span class="p">(</span><span class="n">gtk_window_destroy</span><span class="p">),</span> <span class="n">window</span><span class="p">);</span>
  <span class="n">gtk_box_append</span> <span class="p">(</span><span class="n">GTK_BOX</span> <span class="p">(</span><span class="n">box</span><span class="p">),</span> <span class="n">button</span><span class="p">);</span>

  <span class="n">gtk_widget_show</span> <span class="p">(</span><span class="n">window</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span>
<span class="n">main</span> <span class="p">(</span><span class="kt">int</span>    <span class="n">argc</span><span class="p">,</span>
      <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">GtkApplication</span> <span class="o">*</span><span class="n">app</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

  <span class="n">app</span> <span class="o">=</span> <span class="n">gtk_application_new</span> <span class="p">(</span><span class="s">&quot;org.gtk.example&quot;</span><span class="p">,</span> <span class="n">G_APPLICATION_FLAGS_NONE</span><span class="p">);</span>
  <span class="n">g_signal_connect</span> <span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="s">&quot;activate&quot;</span><span class="p">,</span> <span class="n">G_CALLBACK</span> <span class="p">(</span><span class="n">activate</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">);</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">g_application_run</span> <span class="p">(</span><span class="n">G_APPLICATION</span> <span class="p">(</span><span class="n">app</span><span class="p">),</span> <span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
  <span class="n">g_object_unref</span> <span class="p">(</span><span class="n">app</span><span class="p">);</span>

  <span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>You can compile the program above with <span class="caps">GCC</span>&nbsp;using:</p>
<div class="codehilite"><pre><span></span><code>gcc $( pkg-config --cflags gtk4 ) -o example-1 example-1.c $( pkg-config --libs gtk4 )
</code></pre></div>

<p>As seen above, <code>example-1.c</code> builds further upon <code>example-0.c</code> by adding a
button to our window, with the label &#8220;Hello World&#8221;. Two new <code>GtkWidget</code>
pointers are declared to accomplish this, <code>button</code> and <code>box</code>. The box
variable is created to store a <a href="class.Box.html"><code>GtkBox</code></a>, which is <span class="caps">GTK</span>&#8217;s way of
controlling the size and layout of&nbsp;buttons.</p>
<p>The <code>GtkBox</code> widget is created with <a href="ctor.Box.new.html">gtk_box_new()</a>, which takes a
<a href="enum.Orientation.html"><code>GtkOrientation</code></a> enumeration value as parameter. The buttons which
this box will contain can either be laid out horizontally or vertically.
This does not matter in this particular case, as we are dealing with only
one button. After initializing box with the newly created <code>GtkBox</code>, the code
adds the box widget to the window widget using <a href="method.Window.set_child.html">gtk_window_set_child()</a>.</p>
<p>Next the <code>button</code> variable is initialized in similar manner.
<a href="ctor.Button.new_with_label.html">gtk_button_new_with_label()</a> is called which returns a
<a href="class.Button.html"><code>GtkButton</code></a> to be stored in <code>button</code>. Afterwards <code>button</code> is added to
our <code>box</code>.</p>
<p>Using <code>g_signal_connect()</code>, the button is connected to a function in our app called
<code>print_hello()</code>, so that when the button is clicked, <span class="caps">GTK</span> will call this function.
As the <code>print_hello()</code> function does not use any data as input, <code>NULL</code> is passed
to it. <code>print_hello()</code> calls <code>g_print()</code> with the string &#8220;Hello World&#8221; which will
print Hello World in a terminal if the <span class="caps">GTK</span> application was started from&nbsp;one.</p>
<p>After connecting <code>print_hello()</code>, another signal is connected to the &#8220;clicked&#8221;
state of the button using <code>g_signal_connect_swapped()</code>. This functions is similar
to a <code>g_signal_connect()</code>, with the difference lying in how the callback function
is treated; <code>g_signal_connect_swapped()</code> allows you to specify what the callback
function should take as parameter by letting you pass it as data. In this case
the function being called back is <a href="method.Window.destroy.html">gtk_window_destroy()</a> and the <code>window</code> pointer
is passed to it. This has the effect that when the button is clicked, the whole
<span class="caps">GTK</span> window is destroyed. In contrast if a normal <code>g_signal_connect()</code> were used
to connect the &#8220;clicked&#8221; signal with <a href="method.Window.destroy.html">gtk_window_destroy()</a>, then the function
would be called on <code>button</code> (which would not go well, since the function expects
a <code>GtkWindow</code> as&nbsp;argument).</p>
<p>More information about creating buttons can be found
<a href="https://wiki.gnome.org/HowDoI/Buttons">here</a>.</p>
<p>The rest of the code in <code>example-1.c</code> is identical to <code>example-0.c</code>. The next
section will elaborate further on how to add several GtkWidgets to your <span class="caps">GTK</span>&nbsp;application.</p>
<h2 id="packing">Packing<a class="md-anchor" href="#packing" title="Permanent link"></a></h2>
<p>When creating an application, you&#8217;ll want to put more than one widget inside
a window. When you do so, it becomes important to control how each widget is
positioned and sized. This is where packing comes&nbsp;in.</p>
<p><span class="caps">GTK</span> comes with a large variety of <em>layout containers</em> whose purpose it
is to control the layout of the child widgets that are added to them.
See <a href="LayoutContainers">Layout containers</a> for an&nbsp;overview.</p>
<p>The following example shows how the GtkGrid container lets you
arrange several&nbsp;buttons:</p>
<p><img alt="Grid packing" src="grid-packing.png" /></p>
<h3 id="packing-buttons">Packing buttons<a class="md-anchor" href="#packing-buttons" title="Permanent link"></a></h3>
<p>Create a new file with the following content named <code>example-2.c</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">&lt;gtk/gtk.h&gt;</span><span class="cp"></span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">print_hello</span> <span class="p">(</span><span class="n">GtkWidget</span> <span class="o">*</span><span class="n">widget</span><span class="p">,</span>
             <span class="n">gpointer</span>   <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">g_print</span> <span class="p">(</span><span class="s">&quot;Hello World</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">activate</span> <span class="p">(</span><span class="n">GtkApplication</span> <span class="o">*</span><span class="n">app</span><span class="p">,</span>
          <span class="n">gpointer</span>        <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">GtkWidget</span> <span class="o">*</span><span class="n">window</span><span class="p">;</span>
  <span class="n">GtkWidget</span> <span class="o">*</span><span class="n">grid</span><span class="p">;</span>
  <span class="n">GtkWidget</span> <span class="o">*</span><span class="n">button</span><span class="p">;</span>

  <span class="cm">/* create a new window, and set its title */</span>
  <span class="n">window</span> <span class="o">=</span> <span class="n">gtk_application_window_new</span> <span class="p">(</span><span class="n">app</span><span class="p">);</span>
  <span class="n">gtk_window_set_title</span> <span class="p">(</span><span class="n">GTK_WINDOW</span> <span class="p">(</span><span class="n">window</span><span class="p">),</span> <span class="s">&quot;Window&quot;</span><span class="p">);</span>

  <span class="cm">/* Here we construct the container that is going pack our buttons */</span>
  <span class="n">grid</span> <span class="o">=</span> <span class="n">gtk_grid_new</span> <span class="p">();</span>

  <span class="cm">/* Pack the container in the window */</span>
  <span class="n">gtk_window_set_child</span> <span class="p">(</span><span class="n">GTK_WINDOW</span> <span class="p">(</span><span class="n">window</span><span class="p">),</span> <span class="n">grid</span><span class="p">);</span>

  <span class="n">button</span> <span class="o">=</span> <span class="n">gtk_button_new_with_label</span> <span class="p">(</span><span class="s">&quot;Button 1&quot;</span><span class="p">);</span>
  <span class="n">g_signal_connect</span> <span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="s">&quot;clicked&quot;</span><span class="p">,</span> <span class="n">G_CALLBACK</span> <span class="p">(</span><span class="n">print_hello</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">);</span>

  <span class="cm">/* Place the first button in the grid cell (0, 0), and make it fill</span>
<span class="cm">   * just 1 cell horizontally and vertically (ie no spanning)</span>
<span class="cm">   */</span>
  <span class="n">gtk_grid_attach</span> <span class="p">(</span><span class="n">GTK_GRID</span> <span class="p">(</span><span class="n">grid</span><span class="p">),</span> <span class="n">button</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

  <span class="n">button</span> <span class="o">=</span> <span class="n">gtk_button_new_with_label</span> <span class="p">(</span><span class="s">&quot;Button 2&quot;</span><span class="p">);</span>
  <span class="n">g_signal_connect</span> <span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="s">&quot;clicked&quot;</span><span class="p">,</span> <span class="n">G_CALLBACK</span> <span class="p">(</span><span class="n">print_hello</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">);</span>

  <span class="cm">/* Place the second button in the grid cell (1, 0), and make it fill</span>
<span class="cm">   * just 1 cell horizontally and vertically (ie no spanning)</span>
<span class="cm">   */</span>
  <span class="n">gtk_grid_attach</span> <span class="p">(</span><span class="n">GTK_GRID</span> <span class="p">(</span><span class="n">grid</span><span class="p">),</span> <span class="n">button</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

  <span class="n">button</span> <span class="o">=</span> <span class="n">gtk_button_new_with_label</span> <span class="p">(</span><span class="s">&quot;Quit&quot;</span><span class="p">);</span>
  <span class="n">g_signal_connect_swapped</span> <span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="s">&quot;clicked&quot;</span><span class="p">,</span> <span class="n">G_CALLBACK</span> <span class="p">(</span><span class="n">gtk_window_destroy</span><span class="p">),</span> <span class="n">window</span><span class="p">);</span>

  <span class="cm">/* Place the Quit button in the grid cell (0, 1), and make it</span>
<span class="cm">   * span 2 columns.</span>
<span class="cm">   */</span>
  <span class="n">gtk_grid_attach</span> <span class="p">(</span><span class="n">GTK_GRID</span> <span class="p">(</span><span class="n">grid</span><span class="p">),</span> <span class="n">button</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

  <span class="n">gtk_widget_show</span> <span class="p">(</span><span class="n">window</span><span class="p">);</span>

<span class="p">}</span>

<span class="kt">int</span>
<span class="n">main</span> <span class="p">(</span><span class="kt">int</span>    <span class="n">argc</span><span class="p">,</span>
      <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">GtkApplication</span> <span class="o">*</span><span class="n">app</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

  <span class="n">app</span> <span class="o">=</span> <span class="n">gtk_application_new</span> <span class="p">(</span><span class="s">&quot;org.gtk.example&quot;</span><span class="p">,</span> <span class="n">G_APPLICATION_FLAGS_NONE</span><span class="p">);</span>
  <span class="n">g_signal_connect</span> <span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="s">&quot;activate&quot;</span><span class="p">,</span> <span class="n">G_CALLBACK</span> <span class="p">(</span><span class="n">activate</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">);</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">g_application_run</span> <span class="p">(</span><span class="n">G_APPLICATION</span> <span class="p">(</span><span class="n">app</span><span class="p">),</span> <span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
  <span class="n">g_object_unref</span> <span class="p">(</span><span class="n">app</span><span class="p">);</span>

  <span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>You can compile the program above with <span class="caps">GCC</span>&nbsp;using:</p>
<div class="codehilite"><pre><span></span><code>gcc $( pkg-config --cflags gtk4 ) -o example-2 example-2.c $( pkg-config --libs gtk4 )
</code></pre></div>

<h2 id="custom-drawing">Custom Drawing<a class="md-anchor" href="#custom-drawing" title="Permanent link"></a></h2>
<p>Many widgets, like buttons, do all their drawing themselves. You just tell
them the label you want to see, and they figure out what font to use, draw
the button outline and focus rectangle, etc. Sometimes, it is necessary to
do some custom drawing. In that case, a <a href="class.DrawingArea.html"><code>GtkDrawingArea</code></a> might be the right
widget to use. It offers a canvas on which you can draw by setting its
draw&nbsp;function.</p>
<p>The contents of a widget often need to be partially or fully redrawn, e.g.
when another window is moved and uncovers part of the widget, or when the
window containing it is resized. It is also possible to explicitly cause a
widget to be redrawn, by calling <a href="method.Widget.queue_draw.html">gtk_widget_queue_draw()</a>. <span class="caps">GTK</span> takes
care of most of the details by providing a ready-to-use cairo context to the
draw&nbsp;function.</p>
<p>The following example shows how to use a draw function with GtkDrawingArea.
It is a bit more complicated than the previous examples, since it also
demonstrates input event handling with event&nbsp;controllers.</p>
<p><img alt="Drawing" src="drawing.png" /></p>
<h3 id="drawing-in-response-to-input">Drawing in response to input<a class="md-anchor" href="#drawing-in-response-to-input" title="Permanent link"></a></h3>
<p>Create a new file with the following content named <code>example-4.c</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">&lt;gtk/gtk.h&gt;</span><span class="cp"></span>

<span class="cm">/* Surface to store current scribbles */</span>
<span class="k">static</span> <span class="n">cairo_surface_t</span> <span class="o">*</span><span class="n">surface</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">clear_surface</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">cairo_t</span> <span class="o">*</span><span class="n">cr</span><span class="p">;</span>

  <span class="n">cr</span> <span class="o">=</span> <span class="n">cairo_create</span> <span class="p">(</span><span class="n">surface</span><span class="p">);</span>

  <span class="n">cairo_set_source_rgb</span> <span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <span class="n">cairo_paint</span> <span class="p">(</span><span class="n">cr</span><span class="p">);</span>

  <span class="n">cairo_destroy</span> <span class="p">(</span><span class="n">cr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Create a new surface of the appropriate size to store our scribbles */</span>
<span class="k">static</span> <span class="kt">void</span>
<span class="n">resize_cb</span> <span class="p">(</span><span class="n">GtkWidget</span> <span class="o">*</span><span class="n">widget</span><span class="p">,</span>
           <span class="kt">int</span>        <span class="n">width</span><span class="p">,</span>
           <span class="kt">int</span>        <span class="n">height</span><span class="p">,</span>
           <span class="n">gpointer</span>   <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">surface</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">cairo_surface_destroy</span> <span class="p">(</span><span class="n">surface</span><span class="p">);</span>
      <span class="n">surface</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">gtk_native_get_surface</span> <span class="p">(</span><span class="n">gtk_widget_get_native</span> <span class="p">(</span><span class="n">widget</span><span class="p">)))</span>
    <span class="p">{</span>
      <span class="n">surface</span> <span class="o">=</span> <span class="n">gdk_surface_create_similar_surface</span> <span class="p">(</span><span class="n">gtk_native_get_surface</span> <span class="p">(</span><span class="n">gtk_widget_get_native</span> <span class="p">(</span><span class="n">widget</span><span class="p">)),</span>
                                                   <span class="n">CAIRO_CONTENT_COLOR</span><span class="p">,</span>
                                                   <span class="n">gtk_widget_get_width</span> <span class="p">(</span><span class="n">widget</span><span class="p">),</span>
                                                   <span class="n">gtk_widget_get_height</span> <span class="p">(</span><span class="n">widget</span><span class="p">));</span>

      <span class="cm">/* Initialize the surface to white */</span>
      <span class="n">clear_surface</span> <span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* Redraw the screen from the surface. Note that the draw</span>
<span class="cm"> * callback receives a ready-to-be-used cairo_t that is already</span>
<span class="cm"> * clipped to only draw the exposed areas of the widget</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span>
<span class="n">draw_cb</span> <span class="p">(</span><span class="n">GtkDrawingArea</span> <span class="o">*</span><span class="n">drawing_area</span><span class="p">,</span>
         <span class="n">cairo_t</span>        <span class="o">*</span><span class="n">cr</span><span class="p">,</span>
         <span class="kt">int</span>             <span class="n">width</span><span class="p">,</span>
         <span class="kt">int</span>             <span class="n">height</span><span class="p">,</span>
         <span class="n">gpointer</span>        <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">cairo_set_source_surface</span> <span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">surface</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="n">cairo_paint</span> <span class="p">(</span><span class="n">cr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Draw a rectangle on the surface at the given position */</span>
<span class="k">static</span> <span class="kt">void</span>
<span class="n">draw_brush</span> <span class="p">(</span><span class="n">GtkWidget</span> <span class="o">*</span><span class="n">widget</span><span class="p">,</span>
            <span class="kt">double</span>     <span class="n">x</span><span class="p">,</span>
            <span class="kt">double</span>     <span class="n">y</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">cairo_t</span> <span class="o">*</span><span class="n">cr</span><span class="p">;</span>

  <span class="cm">/* Paint to the surface, where we store our state */</span>
  <span class="n">cr</span> <span class="o">=</span> <span class="n">cairo_create</span> <span class="p">(</span><span class="n">surface</span><span class="p">);</span>

  <span class="n">cairo_rectangle</span> <span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
  <span class="n">cairo_fill</span> <span class="p">(</span><span class="n">cr</span><span class="p">);</span>

  <span class="n">cairo_destroy</span> <span class="p">(</span><span class="n">cr</span><span class="p">);</span>

  <span class="cm">/* Now invalidate the drawing area. */</span>
  <span class="n">gtk_widget_queue_draw</span> <span class="p">(</span><span class="n">widget</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">double</span> <span class="n">start_x</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">double</span> <span class="n">start_y</span><span class="p">;</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">drag_begin</span> <span class="p">(</span><span class="n">GtkGestureDrag</span> <span class="o">*</span><span class="n">gesture</span><span class="p">,</span>
            <span class="kt">double</span>          <span class="n">x</span><span class="p">,</span>
            <span class="kt">double</span>          <span class="n">y</span><span class="p">,</span>
            <span class="n">GtkWidget</span>      <span class="o">*</span><span class="n">area</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">start_x</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
  <span class="n">start_y</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>

  <span class="n">draw_brush</span> <span class="p">(</span><span class="n">area</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">drag_update</span> <span class="p">(</span><span class="n">GtkGestureDrag</span> <span class="o">*</span><span class="n">gesture</span><span class="p">,</span>
             <span class="kt">double</span>          <span class="n">x</span><span class="p">,</span>
             <span class="kt">double</span>          <span class="n">y</span><span class="p">,</span>
             <span class="n">GtkWidget</span>      <span class="o">*</span><span class="n">area</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">draw_brush</span> <span class="p">(</span><span class="n">area</span><span class="p">,</span> <span class="n">start_x</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="n">start_y</span> <span class="o">+</span> <span class="n">y</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">drag_end</span> <span class="p">(</span><span class="n">GtkGestureDrag</span> <span class="o">*</span><span class="n">gesture</span><span class="p">,</span>
          <span class="kt">double</span>          <span class="n">x</span><span class="p">,</span>
          <span class="kt">double</span>          <span class="n">y</span><span class="p">,</span>
          <span class="n">GtkWidget</span>      <span class="o">*</span><span class="n">area</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">draw_brush</span> <span class="p">(</span><span class="n">area</span><span class="p">,</span> <span class="n">start_x</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="n">start_y</span> <span class="o">+</span> <span class="n">y</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">pressed</span> <span class="p">(</span><span class="n">GtkGestureClick</span> <span class="o">*</span><span class="n">gesture</span><span class="p">,</span>
         <span class="kt">int</span>              <span class="n">n_press</span><span class="p">,</span>
         <span class="kt">double</span>           <span class="n">x</span><span class="p">,</span>
         <span class="kt">double</span>           <span class="n">y</span><span class="p">,</span>
         <span class="n">GtkWidget</span>       <span class="o">*</span><span class="n">area</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">clear_surface</span> <span class="p">();</span>
  <span class="n">gtk_widget_queue_draw</span> <span class="p">(</span><span class="n">area</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">close_window</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">surface</span><span class="p">)</span>
    <span class="n">cairo_surface_destroy</span> <span class="p">(</span><span class="n">surface</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">activate</span> <span class="p">(</span><span class="n">GtkApplication</span> <span class="o">*</span><span class="n">app</span><span class="p">,</span>
          <span class="n">gpointer</span>        <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">GtkWidget</span> <span class="o">*</span><span class="n">window</span><span class="p">;</span>
  <span class="n">GtkWidget</span> <span class="o">*</span><span class="n">frame</span><span class="p">;</span>
  <span class="n">GtkWidget</span> <span class="o">*</span><span class="n">drawing_area</span><span class="p">;</span>
  <span class="n">GtkGesture</span> <span class="o">*</span><span class="n">drag</span><span class="p">;</span>
  <span class="n">GtkGesture</span> <span class="o">*</span><span class="n">press</span><span class="p">;</span>

  <span class="n">window</span> <span class="o">=</span> <span class="n">gtk_application_window_new</span> <span class="p">(</span><span class="n">app</span><span class="p">);</span>
  <span class="n">gtk_window_set_title</span> <span class="p">(</span><span class="n">GTK_WINDOW</span> <span class="p">(</span><span class="n">window</span><span class="p">),</span> <span class="s">&quot;Drawing Area&quot;</span><span class="p">);</span>

  <span class="n">g_signal_connect</span> <span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="s">&quot;destroy&quot;</span><span class="p">,</span> <span class="n">G_CALLBACK</span> <span class="p">(</span><span class="n">close_window</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">);</span>

  <span class="n">frame</span> <span class="o">=</span> <span class="n">gtk_frame_new</span> <span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
  <span class="n">gtk_window_set_child</span> <span class="p">(</span><span class="n">GTK_WINDOW</span> <span class="p">(</span><span class="n">window</span><span class="p">),</span> <span class="n">frame</span><span class="p">);</span>

  <span class="n">drawing_area</span> <span class="o">=</span> <span class="n">gtk_drawing_area_new</span> <span class="p">();</span>
  <span class="cm">/* set a minimum size */</span>
  <span class="n">gtk_widget_set_size_request</span> <span class="p">(</span><span class="n">drawing_area</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>

  <span class="n">gtk_frame_set_child</span> <span class="p">(</span><span class="n">GTK_FRAME</span> <span class="p">(</span><span class="n">frame</span><span class="p">),</span> <span class="n">drawing_area</span><span class="p">);</span>

  <span class="n">gtk_drawing_area_set_draw_func</span> <span class="p">(</span><span class="n">GTK_DRAWING_AREA</span> <span class="p">(</span><span class="n">drawing_area</span><span class="p">),</span> <span class="n">draw_cb</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

  <span class="n">g_signal_connect_after</span> <span class="p">(</span><span class="n">drawing_area</span><span class="p">,</span> <span class="s">&quot;resize&quot;</span><span class="p">,</span> <span class="n">G_CALLBACK</span> <span class="p">(</span><span class="n">resize_cb</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">);</span>

  <span class="n">drag</span> <span class="o">=</span> <span class="n">gtk_gesture_drag_new</span> <span class="p">();</span>
  <span class="n">gtk_gesture_single_set_button</span> <span class="p">(</span><span class="n">GTK_GESTURE_SINGLE</span> <span class="p">(</span><span class="n">drag</span><span class="p">),</span> <span class="n">GDK_BUTTON_PRIMARY</span><span class="p">);</span>
  <span class="n">gtk_widget_add_controller</span> <span class="p">(</span><span class="n">drawing_area</span><span class="p">,</span> <span class="n">GTK_EVENT_CONTROLLER</span> <span class="p">(</span><span class="n">drag</span><span class="p">));</span>
  <span class="n">g_signal_connect</span> <span class="p">(</span><span class="n">drag</span><span class="p">,</span> <span class="s">&quot;drag-begin&quot;</span><span class="p">,</span> <span class="n">G_CALLBACK</span> <span class="p">(</span><span class="n">drag_begin</span><span class="p">),</span> <span class="n">drawing_area</span><span class="p">);</span>
  <span class="n">g_signal_connect</span> <span class="p">(</span><span class="n">drag</span><span class="p">,</span> <span class="s">&quot;drag-update&quot;</span><span class="p">,</span> <span class="n">G_CALLBACK</span> <span class="p">(</span><span class="n">drag_update</span><span class="p">),</span> <span class="n">drawing_area</span><span class="p">);</span>
  <span class="n">g_signal_connect</span> <span class="p">(</span><span class="n">drag</span><span class="p">,</span> <span class="s">&quot;drag-end&quot;</span><span class="p">,</span> <span class="n">G_CALLBACK</span> <span class="p">(</span><span class="n">drag_end</span><span class="p">),</span> <span class="n">drawing_area</span><span class="p">);</span>

  <span class="n">press</span> <span class="o">=</span> <span class="n">gtk_gesture_click_new</span> <span class="p">();</span>
  <span class="n">gtk_gesture_single_set_button</span> <span class="p">(</span><span class="n">GTK_GESTURE_SINGLE</span> <span class="p">(</span><span class="n">press</span><span class="p">),</span> <span class="n">GDK_BUTTON_SECONDARY</span><span class="p">);</span>
  <span class="n">gtk_widget_add_controller</span> <span class="p">(</span><span class="n">drawing_area</span><span class="p">,</span> <span class="n">GTK_EVENT_CONTROLLER</span> <span class="p">(</span><span class="n">press</span><span class="p">));</span>

  <span class="n">g_signal_connect</span> <span class="p">(</span><span class="n">press</span><span class="p">,</span> <span class="s">&quot;pressed&quot;</span><span class="p">,</span> <span class="n">G_CALLBACK</span> <span class="p">(</span><span class="n">pressed</span><span class="p">),</span> <span class="n">drawing_area</span><span class="p">);</span>

  <span class="n">gtk_widget_show</span> <span class="p">(</span><span class="n">window</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span>
<span class="n">main</span> <span class="p">(</span><span class="kt">int</span>    <span class="n">argc</span><span class="p">,</span>
      <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">GtkApplication</span> <span class="o">*</span><span class="n">app</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

  <span class="n">app</span> <span class="o">=</span> <span class="n">gtk_application_new</span> <span class="p">(</span><span class="s">&quot;org.gtk.example&quot;</span><span class="p">,</span> <span class="n">G_APPLICATION_FLAGS_NONE</span><span class="p">);</span>
  <span class="n">g_signal_connect</span> <span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="s">&quot;activate&quot;</span><span class="p">,</span> <span class="n">G_CALLBACK</span> <span class="p">(</span><span class="n">activate</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">);</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">g_application_run</span> <span class="p">(</span><span class="n">G_APPLICATION</span> <span class="p">(</span><span class="n">app</span><span class="p">),</span> <span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
  <span class="n">g_object_unref</span> <span class="p">(</span><span class="n">app</span><span class="p">);</span>

  <span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>You can compile the program above with <span class="caps">GCC</span>&nbsp;using:</p>
<div class="codehilite"><pre><span></span><code>gcc $( pkg-config --cflags gtk4 ) -o example-4 example-4.c $( pkg-config --libs gtk4 )
</code></pre></div>

<h2 id="building-user-interfaces">Building user interfaces<a class="md-anchor" href="#building-user-interfaces" title="Permanent link"></a></h2>
<p>When constructing a more complicated user interface, with dozens
or hundreds of widgets, doing all the setup work in C code is
cumbersome, and making changes becomes next to&nbsp;impossible.</p>
<p>Thankfully, <span class="caps">GTK</span> supports the separation of user interface
layout from your business logic, by using <span class="caps">UI</span> descriptions in an
<span class="caps">XML</span> format that can be parsed by the <a href="class.Builder.html"><code>GtkBuilder</code></a>&nbsp;class.</p>
<h3 id="packing-buttons-with-gtkbuilder">Packing buttons with GtkBuilder<a class="md-anchor" href="#packing-buttons-with-gtkbuilder" title="Permanent link"></a></h3>
<p>Create a new file with the following content named <code>example-3.c</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">&lt;gtk/gtk.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;glib/gstdio.h&gt;</span><span class="cp"></span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">print_hello</span> <span class="p">(</span><span class="n">GtkWidget</span> <span class="o">*</span><span class="n">widget</span><span class="p">,</span>
             <span class="n">gpointer</span>   <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">g_print</span> <span class="p">(</span><span class="s">&quot;Hello World</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">quit_cb</span> <span class="p">(</span><span class="n">GtkWindow</span> <span class="o">*</span><span class="n">window</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">gtk_window_close</span> <span class="p">(</span><span class="n">window</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">activate</span> <span class="p">(</span><span class="n">GtkApplication</span> <span class="o">*</span><span class="n">app</span><span class="p">,</span>
          <span class="n">gpointer</span>        <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
  <span class="cm">/* Construct a GtkBuilder instance and load our UI description */</span>
  <span class="n">GtkBuilder</span> <span class="o">*</span><span class="n">builder</span> <span class="o">=</span> <span class="n">gtk_builder_new</span> <span class="p">();</span>
  <span class="n">gtk_builder_add_from_file</span> <span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="s">&quot;builder.ui&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

  <span class="cm">/* Connect signal handlers to the constructed widgets. */</span>
  <span class="n">GObject</span> <span class="o">*</span><span class="n">window</span> <span class="o">=</span> <span class="n">gtk_builder_get_object</span> <span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="s">&quot;window&quot;</span><span class="p">);</span>
  <span class="n">gtk_window_set_application</span> <span class="p">(</span><span class="n">GTK_WINDOW</span> <span class="p">(</span><span class="n">window</span><span class="p">),</span> <span class="n">app</span><span class="p">);</span>

  <span class="n">GObject</span> <span class="o">*</span><span class="n">button</span> <span class="o">=</span> <span class="n">gtk_builder_get_object</span> <span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="s">&quot;button1&quot;</span><span class="p">);</span>
  <span class="n">g_signal_connect</span> <span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="s">&quot;clicked&quot;</span><span class="p">,</span> <span class="n">G_CALLBACK</span> <span class="p">(</span><span class="n">print_hello</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">);</span>

  <span class="n">button</span> <span class="o">=</span> <span class="n">gtk_builder_get_object</span> <span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="s">&quot;button2&quot;</span><span class="p">);</span>
  <span class="n">g_signal_connect</span> <span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="s">&quot;clicked&quot;</span><span class="p">,</span> <span class="n">G_CALLBACK</span> <span class="p">(</span><span class="n">print_hello</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">);</span>

  <span class="n">button</span> <span class="o">=</span> <span class="n">gtk_builder_get_object</span> <span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="s">&quot;quit&quot;</span><span class="p">);</span>
  <span class="n">g_signal_connect_swapped</span> <span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="s">&quot;clicked&quot;</span><span class="p">,</span> <span class="n">G_CALLBACK</span> <span class="p">(</span><span class="n">quit_cb</span><span class="p">),</span> <span class="n">window</span><span class="p">);</span>

  <span class="n">gtk_widget_show</span> <span class="p">(</span><span class="n">GTK_WIDGET</span> <span class="p">(</span><span class="n">window</span><span class="p">));</span>

  <span class="cm">/* We do not need the builder any more */</span>
  <span class="n">g_object_unref</span> <span class="p">(</span><span class="n">builder</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span>
<span class="n">main</span> <span class="p">(</span><span class="kt">int</span>   <span class="n">argc</span><span class="p">,</span>
      <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
<span class="cp">#ifdef GTK_SRCDIR</span>
  <span class="n">g_chdir</span> <span class="p">(</span><span class="n">GTK_SRCDIR</span><span class="p">);</span>
<span class="cp">#endif</span>

  <span class="n">GtkApplication</span> <span class="o">*</span><span class="n">app</span> <span class="o">=</span> <span class="n">gtk_application_new</span> <span class="p">(</span><span class="s">&quot;org.gtk.example&quot;</span><span class="p">,</span> <span class="n">G_APPLICATION_FLAGS_NONE</span><span class="p">);</span>
  <span class="n">g_signal_connect</span> <span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="s">&quot;activate&quot;</span><span class="p">,</span> <span class="n">G_CALLBACK</span> <span class="p">(</span><span class="n">activate</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">);</span>

  <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">g_application_run</span> <span class="p">(</span><span class="n">G_APPLICATION</span> <span class="p">(</span><span class="n">app</span><span class="p">),</span> <span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
  <span class="n">g_object_unref</span> <span class="p">(</span><span class="n">app</span><span class="p">);</span>

  <span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>Create a new file with the following content named <code>builder.ui</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;interface&gt;</span>
  <span class="nt">&lt;object</span> <span class="na">id=</span><span class="s">&quot;window&quot;</span> <span class="na">class=</span><span class="s">&quot;GtkWindow&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;title&quot;</span><span class="nt">&gt;</span>Grid<span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;child&gt;</span>
      <span class="nt">&lt;object</span> <span class="na">id=</span><span class="s">&quot;grid&quot;</span> <span class="na">class=</span><span class="s">&quot;GtkGrid&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;child&gt;</span>
          <span class="nt">&lt;object</span> <span class="na">id=</span><span class="s">&quot;button1&quot;</span> <span class="na">class=</span><span class="s">&quot;GtkButton&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;label&quot;</span><span class="nt">&gt;</span>Button 1<span class="nt">&lt;/property&gt;</span>
            <span class="nt">&lt;layout&gt;</span>
              <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;column&quot;</span><span class="nt">&gt;</span>0<span class="nt">&lt;/property&gt;</span>
              <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>0<span class="nt">&lt;/property&gt;</span>
            <span class="nt">&lt;/layout&gt;</span>
          <span class="nt">&lt;/object&gt;</span>
        <span class="nt">&lt;/child&gt;</span>
        <span class="nt">&lt;child&gt;</span>
          <span class="nt">&lt;object</span> <span class="na">id=</span><span class="s">&quot;button2&quot;</span> <span class="na">class=</span><span class="s">&quot;GtkButton&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;label&quot;</span><span class="nt">&gt;</span>Button 2<span class="nt">&lt;/property&gt;</span>
            <span class="nt">&lt;layout&gt;</span>
              <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;column&quot;</span><span class="nt">&gt;</span>1<span class="nt">&lt;/property&gt;</span>
              <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>0<span class="nt">&lt;/property&gt;</span>
            <span class="nt">&lt;/layout&gt;</span>
          <span class="nt">&lt;/object&gt;</span>
        <span class="nt">&lt;/child&gt;</span>
        <span class="nt">&lt;child&gt;</span>
          <span class="nt">&lt;object</span> <span class="na">id=</span><span class="s">&quot;quit&quot;</span> <span class="na">class=</span><span class="s">&quot;GtkButton&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;label&quot;</span><span class="nt">&gt;</span>Quit<span class="nt">&lt;/property&gt;</span>
            <span class="nt">&lt;layout&gt;</span>
              <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;column&quot;</span><span class="nt">&gt;</span>0<span class="nt">&lt;/property&gt;</span>
              <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>1<span class="nt">&lt;/property&gt;</span>
              <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;column-span&quot;</span><span class="nt">&gt;</span>2<span class="nt">&lt;/property&gt;</span>
            <span class="nt">&lt;/layout&gt;</span>
          <span class="nt">&lt;/object&gt;</span>
        <span class="nt">&lt;/child&gt;</span>
      <span class="nt">&lt;/object&gt;</span>
    <span class="nt">&lt;/child&gt;</span>
  <span class="nt">&lt;/object&gt;</span>
<span class="nt">&lt;/interface&gt;</span>
</code></pre></div>

<p>You can compile the program above with <span class="caps">GCC</span>&nbsp;using:</p>
<div class="codehilite"><pre><span></span><code>gcc $( pkg-config --cflags gtk4 ) -o example-3 example-3.c $( pkg-config --libs gtk4 )
</code></pre></div>

<p>Note that <code>GtkBuilder</code> can also be used to construct objects that are
not widgets, such as tree models, adjustments, etc. That is the reason
the method we use here is called <a href="method.Builder.get_object.html">gtk_builder_get_object()</a> and returns
a <code>GObject</code> instead of a <code>GtkWidget</code>.</p>
<p>Normally, you would pass a full path to <a href="method.Builder.add_from_file.html">gtk_builder_add_from_file()</a> to
make the execution of your program independent of the current directory.
A common location to install <span class="caps">UI</span> descriptions and similar data is
<code>/usr/share/appname</code>.</p>
<p>It is also possible to embed the <span class="caps">UI</span> description in the source code as a
string and use <a href="method.Builder.add_from_string.html">gtk_builder_add_from_string()</a> to load it. But keeping the
<span class="caps">UI</span> description in a separate file has several advantages: It is then possible
to make minor adjustments to the <span class="caps">UI</span> without recompiling your program, and,
more importantly, graphical <span class="caps">UI</span> editors such as <a href="http://glade.gnome.org">Glade</a>
can load the file and allow you to create and modify your <span class="caps">UI</span> by&nbsp;point-and-click.</p>
<h2 id="building-applications">Building applications<a class="md-anchor" href="#building-applications" title="Permanent link"></a></h2>
<p>An application consists of a number of&nbsp;files:</p>
<dl>
<dt>The&nbsp;binary</dt>
<dd>This gets installed in <code>/usr/bin</code>.</dd>
<dt>A desktop&nbsp;file</dt>
<dd>The desktop file provides important information about the application to
   the desktop shell, such as its name, icon, D-Bus name, commandline to launch
   it, etc. It is installed in <code>/usr/share/applications</code>.</dd>
<dt>An&nbsp;icon</dt>
<dd>The icon gets installed in <code>/usr/share/icons/hicolor/48x48/apps</code>, where it
   will be found regardless of the current&nbsp;theme.</dd>
<dt>A settings&nbsp;schema</dt>
<dd>If the application uses GSettings, it will install its schema in
   <code>/usr/share/glib-2.0/schemas</code>, so that tools like dconf-editor can find&nbsp;it.</dd>
<dt>Other&nbsp;resources</dt>
<dd>Other files, such as GtkBuilder ui files, are best loaded from
   resources stored in the application binary itself. This eliminates the
   need for most of the files that would traditionally be installed in
   an application-specific location in <code>/usr/share</code>.</dd>
</dl>
<p><span class="caps">GTK</span> includes application support that is built on top of <code>GApplication</code>. In this
tutorial we&#8217;ll build a simple application by starting from scratch, adding more
and more pieces over time. Along the way, we&#8217;ll learn about <a href="class.Application.html"><code>GtkApplication</code></a>,
templates, resources, application menus, settings, <a href="class.HeaderBar.html"><code>GtkHeaderBar</code></a>, <a href="class.Stack.html"><code>GtkStack</code></a>,
<a href="class.SearchBar.html"><code>GtkSearchBar</code></a>, <a href="class.ListBox.html"><code>GtkListBox</code></a>, and&nbsp;more.</p>
<p>The full, buildable sources for these examples can be found in the
<code>examples</code> directory of the <span class="caps">GTK</span> source distribution, or
<a href="https://gitlab.gnome.org/GNOME/gtk/blob/master/examples">online</a> in the <span class="caps">GTK</span>
source code repository. You can build each example separately by using make
with the <code>Makefile.example</code> file. For more information, see the <code>README</code>
included in the examples&nbsp;directory.</p>
<h3 id="a-trivial-application">A trivial application<a class="md-anchor" href="#a-trivial-application" title="Permanent link"></a></h3>
<p>When using <code>GtkApplication</code>, the <code>main()</code> function can be very simple. We just call
<code>g_application_run()</code> and give it an instance of our application&nbsp;class.</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">&lt;gtk/gtk.h&gt;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&quot;exampleapp.h&quot;</span><span class="cp"></span>

<span class="kt">int</span>
<span class="nf">main</span> <span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">g_application_run</span> <span class="p">(</span><span class="n">G_APPLICATION</span> <span class="p">(</span><span class="n">example_app_new</span> <span class="p">()),</span> <span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>All the application logic is in the application class, which is a subclass of
GtkApplication. Our example does not yet have any interesting functionality.
All it does is open a window when it is activated without arguments, and open
the files it is given, if it is started with&nbsp;arguments.</p>
<p>To handle these two cases, we override the activate() vfunc, which gets
called when the application is launched without commandline arguments, and
the <code>open()</code> virtual function, which gets called when the application is
launched with commandline&nbsp;arguments.</p>
<p>To learn more about <code>GApplication</code> entry points, consult the <span class="caps">GIO</span>
<a href="https://developer.gnome.org/gio/stable/GApplication.html#GApplication.description">documentation</a>.</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">&lt;gtk/gtk.h&gt;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&quot;exampleapp.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;exampleappwin.h&quot;</span><span class="cp"></span>

<span class="k">struct</span> <span class="nc">_ExampleApp</span>
<span class="p">{</span>
  <span class="n">GtkApplication</span> <span class="n">parent</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">G_DEFINE_TYPE</span><span class="p">(</span><span class="n">ExampleApp</span><span class="p">,</span> <span class="n">example_app</span><span class="p">,</span> <span class="n">GTK_TYPE_APPLICATION</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">example_app_init</span> <span class="p">(</span><span class="n">ExampleApp</span> <span class="o">*</span><span class="n">app</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">example_app_activate</span> <span class="p">(</span><span class="n">GApplication</span> <span class="o">*</span><span class="n">app</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">ExampleAppWindow</span> <span class="o">*</span><span class="n">win</span><span class="p">;</span>

  <span class="n">win</span> <span class="o">=</span> <span class="n">example_app_window_new</span> <span class="p">(</span><span class="n">EXAMPLE_APP</span> <span class="p">(</span><span class="n">app</span><span class="p">));</span>
  <span class="n">gtk_window_present</span> <span class="p">(</span><span class="n">GTK_WINDOW</span> <span class="p">(</span><span class="n">win</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">example_app_open</span> <span class="p">(</span><span class="n">GApplication</span>  <span class="o">*</span><span class="n">app</span><span class="p">,</span>
                  <span class="n">GFile</span>        <span class="o">**</span><span class="n">files</span><span class="p">,</span>
                  <span class="kt">int</span>            <span class="n">n_files</span><span class="p">,</span>
                  <span class="k">const</span> <span class="kt">char</span>    <span class="o">*</span><span class="n">hint</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">GList</span> <span class="o">*</span><span class="n">windows</span><span class="p">;</span>
  <span class="n">ExampleAppWindow</span> <span class="o">*</span><span class="n">win</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

  <span class="n">windows</span> <span class="o">=</span> <span class="n">gtk_application_get_windows</span> <span class="p">(</span><span class="n">GTK_APPLICATION</span> <span class="p">(</span><span class="n">app</span><span class="p">));</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">windows</span><span class="p">)</span>
    <span class="n">win</span> <span class="o">=</span> <span class="n">EXAMPLE_APP_WINDOW</span> <span class="p">(</span><span class="n">windows</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
  <span class="k">else</span>
    <span class="n">win</span> <span class="o">=</span> <span class="n">example_app_window_new</span> <span class="p">(</span><span class="n">EXAMPLE_APP</span> <span class="p">(</span><span class="n">app</span><span class="p">));</span>

  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n_files</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="n">example_app_window_open</span> <span class="p">(</span><span class="n">win</span><span class="p">,</span> <span class="n">files</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

  <span class="n">gtk_window_present</span> <span class="p">(</span><span class="n">GTK_WINDOW</span> <span class="p">(</span><span class="n">win</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">example_app_class_init</span> <span class="p">(</span><span class="n">ExampleAppClass</span> <span class="o">*</span><span class="n">class</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">G_APPLICATION_CLASS</span> <span class="p">(</span><span class="n">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">activate</span> <span class="o">=</span> <span class="n">example_app_activate</span><span class="p">;</span>
  <span class="n">G_APPLICATION_CLASS</span> <span class="p">(</span><span class="n">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">open</span> <span class="o">=</span> <span class="n">example_app_open</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">ExampleApp</span> <span class="o">*</span>
<span class="n">example_app_new</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="nf">g_object_new</span> <span class="p">(</span><span class="n">EXAMPLE_APP_TYPE</span><span class="p">,</span>
                       <span class="s">&quot;application-id&quot;</span><span class="p">,</span> <span class="s">&quot;org.gtk.exampleapp&quot;</span><span class="p">,</span>
                       <span class="s">&quot;flags&quot;</span><span class="p">,</span> <span class="n">G_APPLICATION_HANDLES_OPEN</span><span class="p">,</span>
                       <span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>Another important class that is part of the application support in <span class="caps">GTK</span> is
<code>GtkApplicationWindow</code>. It is typically subclassed as well. Our subclass does
not do anything yet, so we will just get an empty&nbsp;window.</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">&lt;gtk/gtk.h&gt;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&quot;exampleapp.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;exampleappwin.h&quot;</span><span class="cp"></span>

<span class="k">struct</span> <span class="nc">_ExampleAppWindow</span>
<span class="p">{</span>
  <span class="n">GtkApplicationWindow</span> <span class="n">parent</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">G_DEFINE_TYPE</span><span class="p">(</span><span class="n">ExampleAppWindow</span><span class="p">,</span> <span class="n">example_app_window</span><span class="p">,</span> <span class="n">GTK_TYPE_APPLICATION_WINDOW</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">example_app_window_init</span> <span class="p">(</span><span class="n">ExampleAppWindow</span> <span class="o">*</span><span class="n">app</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">example_app_window_class_init</span> <span class="p">(</span><span class="n">ExampleAppWindowClass</span> <span class="o">*</span><span class="n">class</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="n">ExampleAppWindow</span> <span class="o">*</span>
<span class="n">example_app_window_new</span> <span class="p">(</span><span class="n">ExampleApp</span> <span class="o">*</span><span class="n">app</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="nf">g_object_new</span> <span class="p">(</span><span class="n">EXAMPLE_APP_WINDOW_TYPE</span><span class="p">,</span> <span class="s">&quot;application&quot;</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="n">example_app_window_open</span> <span class="p">(</span><span class="n">ExampleAppWindow</span> <span class="o">*</span><span class="n">win</span><span class="p">,</span>
                         <span class="n">GFile</span>            <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>
</code></pre></div>

<p>As part of the initial setup of our application, we also
create an icon and a desktop&nbsp;file.</p>
<p><img alt="An icon" src="exampleapp.png" /></p>
<div class="codehilite"><pre><span></span><code>[Desktop Entry]
Type=Application
Name=Example
Icon=exampleapp
StartupNotify=true
Exec=`bindir`@/exampleapp
</code></pre></div>

<p>Note that <code>`bindir</code>@` needs to be replaced with the actual path to the binary
before this desktop file can be&nbsp;used.</p>
<p>Here is what we&#8217;ve achieved so&nbsp;far:</p>
<p><img alt="An application" src="getting-started-app1.png" /></p>
<p>This does not look very impressive yet, but our application is already
presenting itself on the session bus, it has single-instance semantics,
and it accepts files as commandline&nbsp;arguments.</p>
<h3 id="populating-the-window">Populating the window<a class="md-anchor" href="#populating-the-window" title="Permanent link"></a></h3>
<p>In this step, we use a GtkBuilder template to associate a
GtkBuilder ui file with our application window&nbsp;class.</p>
<p>Our simple ui file gives the window a title, and puts a GtkStack
widget as the main&nbsp;content.</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;interface&gt;</span>
  <span class="nt">&lt;template</span> <span class="na">class=</span><span class="s">&quot;ExampleAppWindow&quot;</span> <span class="na">parent=</span><span class="s">&quot;GtkApplicationWindow&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;title&quot;</span> <span class="na">translatable=</span><span class="s">&quot;yes&quot;</span><span class="nt">&gt;</span>Example Application<span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;default-width&quot;</span><span class="nt">&gt;</span>600<span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;default-height&quot;</span><span class="nt">&gt;</span>400<span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;child&gt;</span>
      <span class="nt">&lt;object</span> <span class="na">class=</span><span class="s">&quot;GtkBox&quot;</span> <span class="na">id=</span><span class="s">&quot;content_box&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;orientation&quot;</span><span class="nt">&gt;</span>vertical<span class="nt">&lt;/property&gt;</span>
        <span class="nt">&lt;child&gt;</span>
          <span class="nt">&lt;object</span> <span class="na">class=</span><span class="s">&quot;GtkStack&quot;</span> <span class="na">id=</span><span class="s">&quot;stack&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/child&gt;</span>
      <span class="nt">&lt;/object&gt;</span>
    <span class="nt">&lt;/child&gt;</span>
  <span class="nt">&lt;/template&gt;</span>
<span class="nt">&lt;/interface&gt;</span>
</code></pre></div>

<p>To make use of this file in our application, we revisit our
<code>GtkApplicationWindow</code> subclass, and call
<code>gtk_widget_class_set_template_from_resource()</code> from the class init
function to set the ui file as template for this class. We also
add a call to <code>gtk_widget_init_template()</code> in the instance init
function to instantiate the template for each instance of our&nbsp;class.</p>
<div class="codehilite"><pre><span></span><code> <span class="p">...</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">example_app_window_init</span> <span class="p">(</span><span class="n">ExampleAppWindow</span> <span class="o">*</span><span class="n">win</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">gtk_widget_init_template</span> <span class="p">(</span><span class="n">GTK_WIDGET</span> <span class="p">(</span><span class="n">win</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">example_app_window_class_init</span> <span class="p">(</span><span class="n">ExampleAppWindowClass</span> <span class="o">*</span><span class="n">class</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">gtk_widget_class_set_template_from_resource</span> <span class="p">(</span><span class="n">GTK_WIDGET_CLASS</span> <span class="p">(</span><span class="n">class</span><span class="p">),</span>
                                               <span class="s">&quot;/org/gtk/exampleapp/window.ui&quot;</span><span class="p">);</span>
<span class="p">}</span>

 <span class="p">...</span>
</code></pre></div>

<p>(<a href="https://gitlab.gnome.org/GNOME/gtk/blob/master/examples/application2/exampleappwin.c">full source</a>)</p>
<p>You may have noticed that we used the <code>_from_resource()</code> variant of the function
that sets a template. Now we need to use
<a href="https://developer.gnome.org/gio/stable/GResource.html">GLib&#8217;s resource functionality</a>
to include the ui file in the binary. This is commonly done by listing all resources
in a <code>.gresource.xml</code> file, such as&nbsp;this:</p>
<div class="codehilite"><pre><span></span><code><span class="o">&lt;?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s">&quot;1.0&quot;</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="o">?&gt;</span>
<span class="o">&lt;</span><span class="n">gresources</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">gresource</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;/org/gtk/exampleapp&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">file</span> <span class="n">preprocess</span><span class="o">=</span><span class="s">&quot;xml-stripblanks&quot;</span><span class="o">&gt;</span><span class="n">window</span><span class="p">.</span><span class="n">ui</span><span class="o">&lt;/</span><span class="n">file</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">gresource</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">gresources</span><span class="o">&gt;</span>
</code></pre></div>

<p>This file has to be converted into a C source file that will be compiled and linked
into the application together with the other source files. To do so, we use the
<code>glib-compile-resources</code> utility:</p>
<div class="codehilite"><pre><span></span><code>glib-compile-resources exampleapp.gresource.xml --target=resources.c --generate-source
</code></pre></div>

<p>The gnome module of the <a href="https://mesonbuild.com">Meson build system</a>
provides the <a href="https://mesonbuild.com/Gnome-module.html#gnomecompile_resources">gnome.compile_resources()</a>
method for this&nbsp;task.</p>
<p>Our application now looks like&nbsp;this:</p>
<p><img alt="The application" src="getting-started-app2.png" /></p>
<h3 id="opening-files">Opening files<a class="md-anchor" href="#opening-files" title="Permanent link"></a></h3>
<p>In this step, we make our application show the content of all the files
that it is given on the&nbsp;commandline.</p>
<p>To this end, we add a member to the struct of our application window subclass
and keep a reference to the <code>GtkStack</code> there. The first member of the struct
should be the parent type from which the class is derived. Here,
<code>ExampleAppWindow</code> is derived from <code>GtkApplicationWindow</code>. The
<code>gtk_widget_class_bind_template_child()</code> function arranges things so that after
instantiating the template, the <code>stack</code> member of the struct will point to the
widget of the same name from the&nbsp;template.</p>
<div class="codehilite"><pre><span></span><code><span class="p">...</span>

<span class="k">struct</span> <span class="nc">_ExampleAppWindow</span>
<span class="p">{</span>
  <span class="n">GtkApplicationWindow</span> <span class="n">parent</span><span class="p">;</span>

  <span class="n">GtkWidget</span> <span class="o">*</span><span class="n">stack</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">G_DEFINE_TYPE</span> <span class="p">(</span><span class="n">ExampleAppWindow</span><span class="p">,</span> <span class="n">example_app_window</span><span class="p">,</span> <span class="n">GTK_TYPE_APPLICATION_WINDOW</span><span class="p">)</span>

<span class="p">...</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">example_app_window_class_init</span> <span class="p">(</span><span class="n">ExampleAppWindowClass</span> <span class="o">*</span><span class="n">class</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">gtk_widget_class_set_template_from_resource</span> <span class="p">(</span><span class="n">GTK_WIDGET_CLASS</span> <span class="p">(</span><span class="n">class</span><span class="p">),</span>
                                               <span class="s">&quot;/org/gtk/exampleapp/window.ui&quot;</span><span class="p">);</span>
  <span class="n">gtk_widget_class_bind_template_child</span> <span class="p">(</span><span class="n">GTK_WIDGET_CLASS</span> <span class="p">(</span><span class="n">class</span><span class="p">),</span> <span class="n">ExampleAppWindow</span><span class="p">,</span> <span class="n">stack</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">...</span>
</code></pre></div>

<p>(<a href="https://gitlab.gnome.org/GNOME/gtk/blob/master/examples/application3/exampleappwin.c">full source</a>)</p>
<p>Now we revisit the <code>example_app_window_open()</code> function that is called for each
commandline argument, and construct a GtkTextView that we then add as a page
to the&nbsp;stack:</p>
<div class="codehilite"><pre><span></span><code><span class="p">...</span>

<span class="kt">void</span>
<span class="n">example_app_window_open</span> <span class="p">(</span><span class="n">ExampleAppWindow</span> <span class="o">*</span><span class="n">win</span><span class="p">,</span>
                         <span class="n">GFile</span>            <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">basename</span><span class="p">;</span>
  <span class="n">GtkWidget</span> <span class="o">*</span><span class="n">scrolled</span><span class="p">,</span> <span class="o">*</span><span class="n">view</span><span class="p">;</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">contents</span><span class="p">;</span>
  <span class="n">gsize</span> <span class="n">length</span><span class="p">;</span>

  <span class="n">basename</span> <span class="o">=</span> <span class="n">g_file_get_basename</span> <span class="p">(</span><span class="n">file</span><span class="p">);</span>

  <span class="n">scrolled</span> <span class="o">=</span> <span class="n">gtk_scrolled_window_new</span> <span class="p">();</span>
  <span class="n">gtk_widget_set_hexpand</span> <span class="p">(</span><span class="n">scrolled</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">);</span>
  <span class="n">gtk_widget_set_vexpand</span> <span class="p">(</span><span class="n">scrolled</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">);</span>
  <span class="n">view</span> <span class="o">=</span> <span class="n">gtk_text_view_new</span> <span class="p">();</span>
  <span class="n">gtk_text_view_set_editable</span> <span class="p">(</span><span class="n">GTK_TEXT_VIEW</span> <span class="p">(</span><span class="n">view</span><span class="p">),</span> <span class="n">FALSE</span><span class="p">);</span>
  <span class="n">gtk_text_view_set_cursor_visible</span> <span class="p">(</span><span class="n">GTK_TEXT_VIEW</span> <span class="p">(</span><span class="n">view</span><span class="p">),</span> <span class="n">FALSE</span><span class="p">);</span>
  <span class="n">gtk_scrolled_window_set_child</span> <span class="p">(</span><span class="n">GTK_SCROLLED_WINDOW</span> <span class="p">(</span><span class="n">scrolled</span><span class="p">),</span> <span class="n">view</span><span class="p">);</span>
  <span class="n">gtk_stack_add_titled</span> <span class="p">(</span><span class="n">GTK_STACK</span> <span class="p">(</span><span class="n">win</span><span class="o">-&gt;</span><span class="n">stack</span><span class="p">),</span> <span class="n">scrolled</span><span class="p">,</span> <span class="n">basename</span><span class="p">,</span> <span class="n">basename</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">g_file_load_contents</span> <span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">contents</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">length</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">))</span>
    <span class="p">{</span>
      <span class="n">GtkTextBuffer</span> <span class="o">*</span><span class="n">buffer</span><span class="p">;</span>

      <span class="n">buffer</span> <span class="o">=</span> <span class="n">gtk_text_view_get_buffer</span> <span class="p">(</span><span class="n">GTK_TEXT_VIEW</span> <span class="p">(</span><span class="n">view</span><span class="p">));</span>
      <span class="n">gtk_text_buffer_set_text</span> <span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">contents</span><span class="p">,</span> <span class="n">length</span><span class="p">);</span>
      <span class="n">g_free</span> <span class="p">(</span><span class="n">contents</span><span class="p">);</span>
    <span class="p">}</span>

  <span class="n">g_free</span> <span class="p">(</span><span class="n">basename</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">...</span>
</code></pre></div>

<p>(<a href="https://gitlab.gnome.org/GNOME/gtk/blob/master/examples/application3/exampleappwin.c">full source</a>)</p>
<p>Lastly, we add a <a href="class.StackSwitcher.html"><code>GtkStackSwitcher</code></a> to the titlebar area in the <span class="caps">UI</span> file, and we
tell it to display information about our&nbsp;stack.</p>
<p>The stack switcher gets all its information it needs to display tabs from
the stack that it belongs to. Here, we are passing the label to show for
each file as the last argument to the <a href="method.Stack.add_titled.html">gtk_stack_add_titled()</a>&nbsp;function.</p>
<p>Our application is beginning to take&nbsp;shape:</p>
<p><img alt="Application window" src="getting-started-app3.png" /></p>
<h3 id="a-menu">A menu<a class="md-anchor" href="#a-menu" title="Permanent link"></a></h3>
<p>The menu is shown at the right side of the headerbar. It is meant to collect
infrequently used actions that affect the whole&nbsp;application.</p>
<p>Just like the window template, we specify our menu in a ui file, and add it
as a resource to our&nbsp;binary.</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;interface&gt;</span>
  <span class="nt">&lt;menu</span> <span class="na">id=</span><span class="s">&quot;menu&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;section&gt;</span>
      <span class="nt">&lt;item&gt;</span>
        <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">&quot;label&quot;</span> <span class="na">translatable=</span><span class="s">&quot;yes&quot;</span><span class="nt">&gt;</span>_Preferences<span class="nt">&lt;/attribute&gt;</span>
        <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">&quot;action&quot;</span><span class="nt">&gt;</span>app.preferences<span class="nt">&lt;/attribute&gt;</span>
      <span class="nt">&lt;/item&gt;</span>
    <span class="nt">&lt;/section&gt;</span>
    <span class="nt">&lt;section&gt;</span>
      <span class="nt">&lt;item&gt;</span>
        <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">&quot;label&quot;</span> <span class="na">translatable=</span><span class="s">&quot;yes&quot;</span><span class="nt">&gt;</span>_Quit<span class="nt">&lt;/attribute&gt;</span>
        <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">&quot;action&quot;</span><span class="nt">&gt;</span>app.quit<span class="nt">&lt;/attribute&gt;</span>
      <span class="nt">&lt;/item&gt;</span>
    <span class="nt">&lt;/section&gt;</span>
  <span class="nt">&lt;/menu&gt;</span>
<span class="nt">&lt;/interface&gt;</span>
</code></pre></div>

<p>To make the menu appear, we have to load the ui file and associate the
resulting menu model with the menu button that we&#8217;ve added to the headerbar.
Since menus work by activating GActions, we also have to add a suitable set
of actions to our&nbsp;application.</p>
<p>Adding the actions is best done in the startup() vfunc, which is guaranteed
to be called once for each primary application&nbsp;instance:</p>
<div class="codehilite"><pre><span></span><code><span class="p">...</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">preferences_activated</span> <span class="p">(</span><span class="n">GSimpleAction</span> <span class="o">*</span><span class="n">action</span><span class="p">,</span>
                       <span class="n">GVariant</span>      <span class="o">*</span><span class="n">parameter</span><span class="p">,</span>
                       <span class="n">gpointer</span>       <span class="n">app</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">quit_activated</span> <span class="p">(</span><span class="n">GSimpleAction</span> <span class="o">*</span><span class="n">action</span><span class="p">,</span>
                <span class="n">GVariant</span>      <span class="o">*</span><span class="n">parameter</span><span class="p">,</span>
                <span class="n">gpointer</span>       <span class="n">app</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">g_application_quit</span> <span class="p">(</span><span class="n">G_APPLICATION</span> <span class="p">(</span><span class="n">app</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">GActionEntry</span> <span class="n">app_entries</span><span class="p">[]</span> <span class="o">=</span>
<span class="p">{</span>
  <span class="p">{</span> <span class="s">&quot;preferences&quot;</span><span class="p">,</span> <span class="n">preferences_activated</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span> <span class="p">},</span>
  <span class="p">{</span> <span class="s">&quot;quit&quot;</span><span class="p">,</span> <span class="n">quit_activated</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">example_app_startup</span> <span class="p">(</span><span class="n">GApplication</span> <span class="o">*</span><span class="n">app</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">GtkBuilder</span> <span class="o">*</span><span class="n">builder</span><span class="p">;</span>
  <span class="n">GMenuModel</span> <span class="o">*</span><span class="n">app_menu</span><span class="p">;</span>
  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">quit_accels</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;&amp;lt;Ctrl&amp;gt;Q&quot;</span><span class="p">,</span> <span class="nb">NULL</span> <span class="p">};</span>

  <span class="n">G_APPLICATION_CLASS</span> <span class="p">(</span><span class="n">example_app_parent_class</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">startup</span> <span class="p">(</span><span class="n">app</span><span class="p">);</span>

  <span class="n">g_action_map_add_action_entries</span> <span class="p">(</span><span class="n">G_ACTION_MAP</span> <span class="p">(</span><span class="n">app</span><span class="p">),</span>
                                   <span class="n">app_entries</span><span class="p">,</span> <span class="n">G_N_ELEMENTS</span> <span class="p">(</span><span class="n">app_entries</span><span class="p">),</span>
                                   <span class="n">app</span><span class="p">);</span>
  <span class="n">gtk_application_set_accels_for_action</span> <span class="p">(</span><span class="n">GTK_APPLICATION</span> <span class="p">(</span><span class="n">app</span><span class="p">),</span>
                                         <span class="s">&quot;app.quit&quot;</span><span class="p">,</span>
                                         <span class="n">quit_accels</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">example_app_class_init</span> <span class="p">(</span><span class="n">ExampleAppClass</span> <span class="o">*</span><span class="n">class</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">G_APPLICATION_CLASS</span> <span class="p">(</span><span class="n">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">startup</span> <span class="o">=</span> <span class="n">example_app_startup</span><span class="p">;</span>
  <span class="p">...</span>
<span class="p">}</span>

<span class="p">...</span>
</code></pre></div>

<p>(<a href="https://gitlab.gnome.org/GNOME/gtk/blob/master/examples/application4/exampleapp.c">full source</a>)</p>
<p>Our preferences menu item does not do anything yet, but the Quit menu item
is fully functional. Note that it can also be activated by the usual Ctrl-Q
shortcut. The shortcut was added with <code>gtk_application_set_accels_for_action()</code>.</p>
<p>The application menu looks like&nbsp;this:</p>
<p><img alt="Application window" src="getting-started-app4.png" /></p>
<h3 id="a-preference-dialog">A preference dialog<a class="md-anchor" href="#a-preference-dialog" title="Permanent link"></a></h3>
<p>A typical application will have a some preferences that should be remembered
from one run to the next. Even for our simple example application, we may
want to change the font that is used for the&nbsp;content.</p>
<p>We are going to use <code>GSettings</code> to store our preferences. <code>GSettings</code> requires
a schema that describes our&nbsp;settings:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;schemalist&gt;</span>
  <span class="nt">&lt;schema</span> <span class="na">path=</span><span class="s">&quot;/org/gtk/exampleapp/&quot;</span> <span class="na">id=</span><span class="s">&quot;org.gtk.exampleapp&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;key</span> <span class="na">name=</span><span class="s">&quot;font&quot;</span> <span class="na">type=</span><span class="s">&quot;s&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;default&gt;</span>&#39;Monospace 12&#39;<span class="nt">&lt;/default&gt;</span>
      <span class="nt">&lt;summary&gt;</span>Font<span class="nt">&lt;/summary&gt;</span>
      <span class="nt">&lt;description&gt;</span>The font to be used for content.<span class="nt">&lt;/description&gt;</span>
    <span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;key</span> <span class="na">name=</span><span class="s">&quot;transition&quot;</span> <span class="na">type=</span><span class="s">&quot;s&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;choices&gt;</span>
        <span class="nt">&lt;choice</span> <span class="na">value=</span><span class="s">&#39;none&#39;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;choice</span> <span class="na">value=</span><span class="s">&#39;crossfade&#39;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;choice</span> <span class="na">value=</span><span class="s">&#39;slide-left-right&#39;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/choices&gt;</span>
      <span class="nt">&lt;default&gt;</span>&#39;none&#39;<span class="nt">&lt;/default&gt;</span>
      <span class="nt">&lt;summary&gt;</span>Transition<span class="nt">&lt;/summary&gt;</span>
      <span class="nt">&lt;description&gt;</span>The transition to use when switching tabs.<span class="nt">&lt;/description&gt;</span>
    <span class="nt">&lt;/key&gt;</span>
  <span class="nt">&lt;/schema&gt;</span>
<span class="nt">&lt;/schemalist&gt;</span>
</code></pre></div>

<p>Before we can make use of this schema in our application, we need to compile
it into the binary form that GSettings expects. <span class="caps">GIO</span> provides
<a href="https://developer.gnome.org/gio/2.36/ch31s06.html">macros</a> to do this in
autotools-based projects, and the gnome module of the Meson build system
provides the <a href="https://mesonbuild.com/Gnome-module.html#gnomecompile_schemas">gnome.compile_schemas()</a>
method for this&nbsp;task.</p>
<p>Next, we need to connect our settings to the widgets that they are supposed
to control. One convenient way to do this is to use <code>GSettings</code> bind
functionality to bind settings keys to object properties, as we do here
for the transition&nbsp;setting.</p>
<div class="codehilite"><pre><span></span><code><span class="p">...</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">example_app_window_init</span> <span class="p">(</span><span class="n">ExampleAppWindow</span> <span class="o">*</span><span class="n">win</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">gtk_widget_init_template</span> <span class="p">(</span><span class="n">GTK_WIDGET</span> <span class="p">(</span><span class="n">win</span><span class="p">));</span>
  <span class="n">win</span><span class="o">-&gt;</span><span class="n">settings</span> <span class="o">=</span> <span class="n">g_settings_new</span> <span class="p">(</span><span class="s">&quot;org.gtk.exampleapp&quot;</span><span class="p">);</span>

  <span class="n">g_settings_bind</span> <span class="p">(</span><span class="n">win</span><span class="o">-&gt;</span><span class="n">settings</span><span class="p">,</span> <span class="s">&quot;transition&quot;</span><span class="p">,</span>
                   <span class="n">win</span><span class="o">-&gt;</span><span class="n">stack</span><span class="p">,</span> <span class="s">&quot;transition-type&quot;</span><span class="p">,</span>
                   <span class="n">G_SETTINGS_BIND_DEFAULT</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">...</span>
</code></pre></div>

<p>(<a href="https://gitlab.gnome.org/GNOME/gtk/blob/master/examples/application5/exampleappwin.c">full source</a>)</p>
<p>The code to connect the font setting is a little more involved, since there
is no simple object property that it corresponds to, so we are not going to
go into that&nbsp;here.</p>
<p>At this point, the application will already react if you change one of the
settings, e.g. using the <code>gsettings</code> command line tool. Of course, we expect
the application to provide a preference dialog for these. So lets do that
now. Our preference dialog will be a subclass of <a href="class.Dialog.html"><code>GtkDialog</code></a>, and
we&#8217;ll use the same techniques that we&#8217;ve already seen: templates, private
structs, settings&nbsp;bindings.</p>
<p>Lets start with the&nbsp;template.</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;interface&gt;</span>
  <span class="nt">&lt;template</span> <span class="na">class=</span><span class="s">&quot;ExampleAppPrefs&quot;</span> <span class="na">parent=</span><span class="s">&quot;GtkDialog&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;title&quot;</span> <span class="na">translatable=</span><span class="s">&quot;yes&quot;</span><span class="nt">&gt;</span>Preferences<span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;resizable&quot;</span><span class="nt">&gt;</span>0<span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;modal&quot;</span><span class="nt">&gt;</span>1<span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;child</span> <span class="na">internal-child=</span><span class="s">&quot;content_area&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;object</span> <span class="na">class=</span><span class="s">&quot;GtkBox&quot;</span> <span class="na">id=</span><span class="s">&quot;content_area&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;child&gt;</span>
          <span class="nt">&lt;object</span> <span class="na">class=</span><span class="s">&quot;GtkGrid&quot;</span> <span class="na">id=</span><span class="s">&quot;grid&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;margin-start&quot;</span><span class="nt">&gt;</span>12<span class="nt">&lt;/property&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;margin-end&quot;</span><span class="nt">&gt;</span>12<span class="nt">&lt;/property&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;margin-top&quot;</span><span class="nt">&gt;</span>12<span class="nt">&lt;/property&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;margin-bottom&quot;</span><span class="nt">&gt;</span>12<span class="nt">&lt;/property&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;row-spacing&quot;</span><span class="nt">&gt;</span>12<span class="nt">&lt;/property&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;column-spacing&quot;</span><span class="nt">&gt;</span>12<span class="nt">&lt;/property&gt;</span>
            <span class="nt">&lt;child&gt;</span>
              <span class="nt">&lt;object</span> <span class="na">class=</span><span class="s">&quot;GtkLabel&quot;</span> <span class="na">id=</span><span class="s">&quot;fontlabel&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;label&quot;</span><span class="nt">&gt;</span>_Font:<span class="nt">&lt;/property&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;use-underline&quot;</span><span class="nt">&gt;</span>1<span class="nt">&lt;/property&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;mnemonic-widget&quot;</span><span class="nt">&gt;</span>font<span class="nt">&lt;/property&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;xalign&quot;</span><span class="nt">&gt;</span>1<span class="nt">&lt;/property&gt;</span>
                <span class="nt">&lt;layout&gt;</span>
                  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;column&quot;</span><span class="nt">&gt;</span>0<span class="nt">&lt;/property&gt;</span>
                  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>0<span class="nt">&lt;/property&gt;</span>
                <span class="nt">&lt;/layout&gt;</span>
              <span class="nt">&lt;/object&gt;</span>
            <span class="nt">&lt;/child&gt;</span>
            <span class="nt">&lt;child&gt;</span>
              <span class="nt">&lt;object</span> <span class="na">class=</span><span class="s">&quot;GtkFontButton&quot;</span> <span class="na">id=</span><span class="s">&quot;font&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;layout&gt;</span>
                  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;column&quot;</span><span class="nt">&gt;</span>1<span class="nt">&lt;/property&gt;</span>
                  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>0<span class="nt">&lt;/property&gt;</span>
                <span class="nt">&lt;/layout&gt;</span>
              <span class="nt">&lt;/object&gt;</span>
            <span class="nt">&lt;/child&gt;</span>
            <span class="nt">&lt;child&gt;</span>
              <span class="nt">&lt;object</span> <span class="na">class=</span><span class="s">&quot;GtkLabel&quot;</span> <span class="na">id=</span><span class="s">&quot;transitionlabel&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;label&quot;</span><span class="nt">&gt;</span>_Transition:<span class="nt">&lt;/property&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;use-underline&quot;</span><span class="nt">&gt;</span>1<span class="nt">&lt;/property&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;mnemonic-widget&quot;</span><span class="nt">&gt;</span>transition<span class="nt">&lt;/property&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;xalign&quot;</span><span class="nt">&gt;</span>1<span class="nt">&lt;/property&gt;</span>
                <span class="nt">&lt;layout&gt;</span>
                  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;column&quot;</span><span class="nt">&gt;</span>0<span class="nt">&lt;/property&gt;</span>
                  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>1<span class="nt">&lt;/property&gt;</span>
                <span class="nt">&lt;/layout&gt;</span>
              <span class="nt">&lt;/object&gt;</span>
            <span class="nt">&lt;/child&gt;</span>
            <span class="nt">&lt;child&gt;</span>
              <span class="nt">&lt;object</span> <span class="na">class=</span><span class="s">&quot;GtkComboBoxText&quot;</span> <span class="na">id=</span><span class="s">&quot;transition&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;items&gt;</span>
                  <span class="nt">&lt;item</span> <span class="na">translatable=</span><span class="s">&quot;yes&quot;</span> <span class="na">id=</span><span class="s">&quot;none&quot;</span><span class="nt">&gt;</span>None<span class="nt">&lt;/item&gt;</span>
                  <span class="nt">&lt;item</span> <span class="na">translatable=</span><span class="s">&quot;yes&quot;</span> <span class="na">id=</span><span class="s">&quot;crossfade&quot;</span><span class="nt">&gt;</span>Fade<span class="nt">&lt;/item&gt;</span>
                  <span class="nt">&lt;item</span> <span class="na">translatable=</span><span class="s">&quot;yes&quot;</span> <span class="na">id=</span><span class="s">&quot;slide-left-right&quot;</span><span class="nt">&gt;</span>Slide<span class="nt">&lt;/item&gt;</span>
                <span class="nt">&lt;/items&gt;</span>
                <span class="nt">&lt;layout&gt;</span>
                  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;column&quot;</span><span class="nt">&gt;</span>1<span class="nt">&lt;/property&gt;</span>
                  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>1<span class="nt">&lt;/property&gt;</span>
                <span class="nt">&lt;/layout&gt;</span>
              <span class="nt">&lt;/object&gt;</span>
            <span class="nt">&lt;/child&gt;</span>
          <span class="nt">&lt;/object&gt;</span>
        <span class="nt">&lt;/child&gt;</span>
      <span class="nt">&lt;/object&gt;</span>
    <span class="nt">&lt;/child&gt;</span>
  <span class="nt">&lt;/template&gt;</span>
<span class="nt">&lt;/interface&gt;</span>
</code></pre></div>

<p>Next comes the dialog&nbsp;subclass.</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">&lt;gtk/gtk.h&gt;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&quot;exampleapp.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;exampleappwin.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;exampleappprefs.h&quot;</span><span class="cp"></span>

<span class="k">struct</span> <span class="nc">_ExampleAppPrefs</span>
<span class="p">{</span>
  <span class="n">GtkDialog</span> <span class="n">parent</span><span class="p">;</span>

  <span class="n">GSettings</span> <span class="o">*</span><span class="n">settings</span><span class="p">;</span>
  <span class="n">GtkWidget</span> <span class="o">*</span><span class="n">font</span><span class="p">;</span>
  <span class="n">GtkWidget</span> <span class="o">*</span><span class="n">transition</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">G_DEFINE_TYPE</span> <span class="p">(</span><span class="n">ExampleAppPrefs</span><span class="p">,</span> <span class="n">example_app_prefs</span><span class="p">,</span> <span class="n">GTK_TYPE_DIALOG</span><span class="p">)</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">example_app_prefs_init</span> <span class="p">(</span><span class="n">ExampleAppPrefs</span> <span class="o">*</span><span class="n">prefs</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">gtk_widget_init_template</span> <span class="p">(</span><span class="n">GTK_WIDGET</span> <span class="p">(</span><span class="n">prefs</span><span class="p">));</span>
  <span class="n">prefs</span><span class="o">-&gt;</span><span class="n">settings</span> <span class="o">=</span> <span class="n">g_settings_new</span> <span class="p">(</span><span class="s">&quot;org.gtk.exampleapp&quot;</span><span class="p">);</span>

  <span class="n">g_settings_bind</span> <span class="p">(</span><span class="n">prefs</span><span class="o">-&gt;</span><span class="n">settings</span><span class="p">,</span> <span class="s">&quot;font&quot;</span><span class="p">,</span>
                   <span class="n">prefs</span><span class="o">-&gt;</span><span class="n">font</span><span class="p">,</span> <span class="s">&quot;font&quot;</span><span class="p">,</span>
                   <span class="n">G_SETTINGS_BIND_DEFAULT</span><span class="p">);</span>
  <span class="n">g_settings_bind</span> <span class="p">(</span><span class="n">prefs</span><span class="o">-&gt;</span><span class="n">settings</span><span class="p">,</span> <span class="s">&quot;transition&quot;</span><span class="p">,</span>
                   <span class="n">prefs</span><span class="o">-&gt;</span><span class="n">transition</span><span class="p">,</span> <span class="s">&quot;active-id&quot;</span><span class="p">,</span>
                   <span class="n">G_SETTINGS_BIND_DEFAULT</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">example_app_prefs_dispose</span> <span class="p">(</span><span class="n">GObject</span> <span class="o">*</span><span class="n">object</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">ExampleAppPrefs</span> <span class="o">*</span><span class="n">prefs</span><span class="p">;</span>

  <span class="n">prefs</span> <span class="o">=</span> <span class="n">EXAMPLE_APP_PREFS</span> <span class="p">(</span><span class="n">object</span><span class="p">);</span>

  <span class="n">g_clear_object</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">prefs</span><span class="o">-&gt;</span><span class="n">settings</span><span class="p">);</span>

  <span class="n">G_OBJECT_CLASS</span> <span class="p">(</span><span class="n">example_app_prefs_parent_class</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">dispose</span> <span class="p">(</span><span class="n">object</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">example_app_prefs_class_init</span> <span class="p">(</span><span class="n">ExampleAppPrefsClass</span> <span class="o">*</span><span class="n">class</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">G_OBJECT_CLASS</span> <span class="p">(</span><span class="n">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">dispose</span> <span class="o">=</span> <span class="n">example_app_prefs_dispose</span><span class="p">;</span>

  <span class="n">gtk_widget_class_set_template_from_resource</span> <span class="p">(</span><span class="n">GTK_WIDGET_CLASS</span> <span class="p">(</span><span class="n">class</span><span class="p">),</span>
                                               <span class="s">&quot;/org/gtk/exampleapp/prefs.ui&quot;</span><span class="p">);</span>
  <span class="n">gtk_widget_class_bind_template_child</span> <span class="p">(</span><span class="n">GTK_WIDGET_CLASS</span> <span class="p">(</span><span class="n">class</span><span class="p">),</span> <span class="n">ExampleAppPrefs</span><span class="p">,</span> <span class="n">font</span><span class="p">);</span>
  <span class="n">gtk_widget_class_bind_template_child</span> <span class="p">(</span><span class="n">GTK_WIDGET_CLASS</span> <span class="p">(</span><span class="n">class</span><span class="p">),</span> <span class="n">ExampleAppPrefs</span><span class="p">,</span> <span class="n">transition</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">ExampleAppPrefs</span> <span class="o">*</span>
<span class="n">example_app_prefs_new</span> <span class="p">(</span><span class="n">ExampleAppWindow</span> <span class="o">*</span><span class="n">win</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="nf">g_object_new</span> <span class="p">(</span><span class="n">EXAMPLE_APP_PREFS_TYPE</span><span class="p">,</span> <span class="s">&quot;transient-for&quot;</span><span class="p">,</span> <span class="n">win</span><span class="p">,</span> <span class="s">&quot;use-header-bar&quot;</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>Now we revisit the <code>preferences_activated()</code> function in our application
class, and make it open a new preference&nbsp;dialog.</p>
<div class="codehilite"><pre><span></span><code><span class="p">...</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">preferences_activated</span> <span class="p">(</span><span class="n">GSimpleAction</span> <span class="o">*</span><span class="n">action</span><span class="p">,</span>
                       <span class="n">GVariant</span>      <span class="o">*</span><span class="n">parameter</span><span class="p">,</span>
                       <span class="n">gpointer</span>       <span class="n">app</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">ExampleAppPrefs</span> <span class="o">*</span><span class="n">prefs</span><span class="p">;</span>
  <span class="n">GtkWindow</span> <span class="o">*</span><span class="n">win</span><span class="p">;</span>

  <span class="n">win</span> <span class="o">=</span> <span class="n">gtk_application_get_active_window</span> <span class="p">(</span><span class="n">GTK_APPLICATION</span> <span class="p">(</span><span class="n">app</span><span class="p">));</span>
  <span class="n">prefs</span> <span class="o">=</span> <span class="n">example_app_prefs_new</span> <span class="p">(</span><span class="n">EXAMPLE_APP_WINDOW</span> <span class="p">(</span><span class="n">win</span><span class="p">));</span>
  <span class="n">gtk_window_present</span> <span class="p">(</span><span class="n">GTK_WINDOW</span> <span class="p">(</span><span class="n">prefs</span><span class="p">));</span>
<span class="p">}</span>

<span class="p">...</span>
</code></pre></div>

<p>(<a href="https://gitlab.gnome.org/GNOME/gtk/blob/master/examples/application6/exampleapp.c">full source</a>)</p>
<p>After all this work, our application can now show a preference dialog
like&nbsp;this:</p>
<p><img alt="Preference dialog" src="getting-started-app6.png" /></p>
<h3 id="adding-a-search-bar">Adding a search bar<a class="md-anchor" href="#adding-a-search-bar" title="Permanent link"></a></h3>
<p>We continue to flesh out the functionality of our application. For now, we
add search. <span class="caps">GTK</span> supports this with <a href="class.SearchEntry.html"><code>GtkSearchEntry</code></a> and
<a href="class.SearchBar.html"><code>GtkSearchBar</code></a>. The search bar is a widget that can slide in from the
top to present a search&nbsp;entry.</p>
<p>We add a toggle button to the header bar, which can be used to slide out
the search bar below the header&nbsp;bar.</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;interface&gt;</span>
  <span class="nt">&lt;template</span> <span class="na">class=</span><span class="s">&quot;ExampleAppWindow&quot;</span> <span class="na">parent=</span><span class="s">&quot;GtkApplicationWindow&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;title&quot;</span> <span class="na">translatable=</span><span class="s">&quot;yes&quot;</span><span class="nt">&gt;</span>Example Application<span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;default-width&quot;</span><span class="nt">&gt;</span>600<span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;default-height&quot;</span><span class="nt">&gt;</span>400<span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;child</span> <span class="na">type=</span><span class="s">&quot;titlebar&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;object</span> <span class="na">class=</span><span class="s">&quot;GtkHeaderBar&quot;</span> <span class="na">id=</span><span class="s">&quot;header&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;child</span> <span class="na">type=</span><span class="s">&quot;title&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;object</span> <span class="na">class=</span><span class="s">&quot;GtkStackSwitcher&quot;</span> <span class="na">id=</span><span class="s">&quot;tabs&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;stack&quot;</span><span class="nt">&gt;</span>stack<span class="nt">&lt;/property&gt;</span>
          <span class="nt">&lt;/object&gt;</span>
        <span class="nt">&lt;/child&gt;</span>
        <span class="nt">&lt;child</span> <span class="na">type=</span><span class="s">&quot;end&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;object</span> <span class="na">class=</span><span class="s">&quot;GtkMenuButton&quot;</span> <span class="na">id=</span><span class="s">&quot;gears&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;direction&quot;</span><span class="nt">&gt;</span>none<span class="nt">&lt;/property&gt;</span>
          <span class="nt">&lt;/object&gt;</span>
        <span class="nt">&lt;/child&gt;</span>
        <span class="nt">&lt;child</span> <span class="na">type=</span><span class="s">&quot;end&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;object</span> <span class="na">class=</span><span class="s">&quot;GtkToggleButton&quot;</span> <span class="na">id=</span><span class="s">&quot;search&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;sensitive&quot;</span><span class="nt">&gt;</span>0<span class="nt">&lt;/property&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;icon-name&quot;</span><span class="nt">&gt;</span>edit-find-symbolic<span class="nt">&lt;/property&gt;</span>
          <span class="nt">&lt;/object&gt;</span>
        <span class="nt">&lt;/child&gt;</span>
      <span class="nt">&lt;/object&gt;</span>
    <span class="nt">&lt;/child&gt;</span>
    <span class="nt">&lt;child&gt;</span>
      <span class="nt">&lt;object</span> <span class="na">class=</span><span class="s">&quot;GtkBox&quot;</span> <span class="na">id=</span><span class="s">&quot;content_box&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;orientation&quot;</span><span class="nt">&gt;</span>vertical<span class="nt">&lt;/property&gt;</span>
        <span class="nt">&lt;child&gt;</span>
          <span class="nt">&lt;object</span> <span class="na">class=</span><span class="s">&quot;GtkSearchBar&quot;</span> <span class="na">id=</span><span class="s">&quot;searchbar&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;child&gt;</span>
              <span class="nt">&lt;object</span> <span class="na">class=</span><span class="s">&quot;GtkSearchEntry&quot;</span> <span class="na">id=</span><span class="s">&quot;searchentry&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;signal</span> <span class="na">name=</span><span class="s">&quot;search-changed&quot;</span> <span class="na">handler=</span><span class="s">&quot;search_text_changed&quot;</span><span class="nt">/&gt;</span>
              <span class="nt">&lt;/object&gt;</span>
            <span class="nt">&lt;/child&gt;</span>
          <span class="nt">&lt;/object&gt;</span>
        <span class="nt">&lt;/child&gt;</span>
        <span class="nt">&lt;child&gt;</span>
          <span class="nt">&lt;object</span> <span class="na">class=</span><span class="s">&quot;GtkStack&quot;</span> <span class="na">id=</span><span class="s">&quot;stack&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;signal</span> <span class="na">name=</span><span class="s">&quot;notify::visible-child&quot;</span> <span class="na">handler=</span><span class="s">&quot;visible_child_changed&quot;</span><span class="nt">/&gt;</span>
          <span class="nt">&lt;/object&gt;</span>
        <span class="nt">&lt;/child&gt;</span>
      <span class="nt">&lt;/object&gt;</span>
    <span class="nt">&lt;/child&gt;</span>
  <span class="nt">&lt;/template&gt;</span>
<span class="nt">&lt;/interface&gt;</span>
</code></pre></div>

<p>Implementing the search needs quite a few code changes that we are not
going to completely go over here. The central piece of the search
implementation is a signal handler that listens for text changes in
the search&nbsp;entry.</p>
<div class="codehilite"><pre><span></span><code><span class="p">...</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">search_text_changed</span> <span class="p">(</span><span class="n">GtkEntry</span>         <span class="o">*</span><span class="n">entry</span><span class="p">,</span>
                     <span class="n">ExampleAppWindow</span> <span class="o">*</span><span class="n">win</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">text</span><span class="p">;</span>
  <span class="n">GtkWidget</span> <span class="o">*</span><span class="n">tab</span><span class="p">;</span>
  <span class="n">GtkWidget</span> <span class="o">*</span><span class="n">view</span><span class="p">;</span>
  <span class="n">GtkTextBuffer</span> <span class="o">*</span><span class="n">buffer</span><span class="p">;</span>
  <span class="n">GtkTextIter</span> <span class="n">start</span><span class="p">,</span> <span class="n">match_start</span><span class="p">,</span> <span class="n">match_end</span><span class="p">;</span>

  <span class="n">text</span> <span class="o">=</span> <span class="n">gtk_editable_get_text</span> <span class="p">(</span><span class="n">GTK_EDITABLE</span> <span class="p">(</span><span class="n">entry</span><span class="p">));</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">text</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;\0&#39;</span><span class="p">)</span>
    <span class="k">return</span><span class="p">;</span>

  <span class="n">tab</span> <span class="o">=</span> <span class="n">gtk_stack_get_visible_child</span> <span class="p">(</span><span class="n">GTK_STACK</span> <span class="p">(</span><span class="n">win</span><span class="o">-&gt;</span><span class="n">stack</span><span class="p">));</span>
  <span class="n">view</span> <span class="o">=</span> <span class="n">gtk_scrolled_window_get_child</span> <span class="p">(</span><span class="n">GTK_SCROLLED_WINDOW</span> <span class="p">(</span><span class="n">tab</span><span class="p">));</span>
  <span class="n">buffer</span> <span class="o">=</span> <span class="n">gtk_text_view_get_buffer</span> <span class="p">(</span><span class="n">GTK_TEXT_VIEW</span> <span class="p">(</span><span class="n">view</span><span class="p">));</span>

  <span class="cm">/* Very simple-minded search implementation */</span>
  <span class="n">gtk_text_buffer_get_start_iter</span> <span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">start</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">gtk_text_iter_forward_search</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">start</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">GTK_TEXT_SEARCH_CASE_INSENSITIVE</span><span class="p">,</span>
                                    <span class="o">&amp;</span><span class="n">match_start</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">match_end</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">))</span>
    <span class="p">{</span>
      <span class="n">gtk_text_buffer_select_range</span> <span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">match_start</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">match_end</span><span class="p">);</span>
      <span class="n">gtk_text_view_scroll_to_iter</span> <span class="p">(</span><span class="n">GTK_TEXT_VIEW</span> <span class="p">(</span><span class="n">view</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">match_start</span><span class="p">,</span>
                                    <span class="mf">0.0</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">example_app_window_init</span> <span class="p">(</span><span class="n">ExampleAppWindow</span> <span class="o">*</span><span class="n">win</span><span class="p">)</span>
<span class="p">{</span>

<span class="p">...</span>

  <span class="n">gtk_widget_class_bind_template_callback</span> <span class="p">(</span><span class="n">GTK_WIDGET_CLASS</span> <span class="p">(</span><span class="n">class</span><span class="p">),</span> <span class="n">search_text_changed</span><span class="p">);</span>

<span class="p">...</span>

<span class="p">}</span>

<span class="p">...</span>
</code></pre></div>

<p>(<a href="https://gitlab.gnome.org/GNOME/gtk/blob/master/examples/application7/exampleappwin.c">full source</a>)</p>
<p>With the search bar, our application now looks like&nbsp;this:</p>
<p><img alt="A search bar" src="getting-started-app7.png" /></p>
<h3 id="adding-a-side-bar">Adding a side bar<a class="md-anchor" href="#adding-a-side-bar" title="Permanent link"></a></h3>
<p>As another piece of functionality, we are adding a sidebar, which demonstrates
<a href="class.MenuButton.html"><code>GtkMenuButton</code></a>, <a href="class.Revealer.html"><code>GtkRevealer</code></a> and <a href="class.ListBox.html"><code>GtkListBox</code></a>.</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;interface&gt;</span>
  <span class="nt">&lt;template</span> <span class="na">class=</span><span class="s">&quot;ExampleAppWindow&quot;</span> <span class="na">parent=</span><span class="s">&quot;GtkApplicationWindow&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;title&quot;</span> <span class="na">translatable=</span><span class="s">&quot;yes&quot;</span><span class="nt">&gt;</span>Example Application<span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;default-width&quot;</span><span class="nt">&gt;</span>600<span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;default-height&quot;</span><span class="nt">&gt;</span>400<span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;child</span> <span class="na">type=</span><span class="s">&quot;titlebar&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;object</span> <span class="na">class=</span><span class="s">&quot;GtkHeaderBar&quot;</span> <span class="na">id=</span><span class="s">&quot;header&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;child</span> <span class="na">type=</span><span class="s">&quot;title&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;object</span> <span class="na">class=</span><span class="s">&quot;GtkStackSwitcher&quot;</span> <span class="na">id=</span><span class="s">&quot;tabs&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;stack&quot;</span><span class="nt">&gt;</span>stack<span class="nt">&lt;/property&gt;</span>
          <span class="nt">&lt;/object&gt;</span>
        <span class="nt">&lt;/child&gt;</span>
        <span class="nt">&lt;child</span> <span class="na">type=</span><span class="s">&quot;end&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;object</span> <span class="na">class=</span><span class="s">&quot;GtkToggleButton&quot;</span> <span class="na">id=</span><span class="s">&quot;search&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;sensitive&quot;</span><span class="nt">&gt;</span>0<span class="nt">&lt;/property&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;icon-name&quot;</span><span class="nt">&gt;</span>edit-find-symbolic<span class="nt">&lt;/property&gt;</span>
          <span class="nt">&lt;/object&gt;</span>
        <span class="nt">&lt;/child&gt;</span>
        <span class="nt">&lt;child</span> <span class="na">type=</span><span class="s">&quot;end&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;object</span> <span class="na">class=</span><span class="s">&quot;GtkMenuButton&quot;</span> <span class="na">id=</span><span class="s">&quot;gears&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;direction&quot;</span><span class="nt">&gt;</span>none<span class="nt">&lt;/property&gt;</span>
          <span class="nt">&lt;/object&gt;</span>
        <span class="nt">&lt;/child&gt;</span>
      <span class="nt">&lt;/object&gt;</span>
    <span class="nt">&lt;/child&gt;</span>
    <span class="nt">&lt;child&gt;</span>
      <span class="nt">&lt;object</span> <span class="na">class=</span><span class="s">&quot;GtkBox&quot;</span> <span class="na">id=</span><span class="s">&quot;content_box&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;orientation&quot;</span><span class="nt">&gt;</span>vertical<span class="nt">&lt;/property&gt;</span>
        <span class="nt">&lt;child&gt;</span>
          <span class="nt">&lt;object</span> <span class="na">class=</span><span class="s">&quot;GtkSearchBar&quot;</span> <span class="na">id=</span><span class="s">&quot;searchbar&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;child&gt;</span>
              <span class="nt">&lt;object</span> <span class="na">class=</span><span class="s">&quot;GtkSearchEntry&quot;</span> <span class="na">id=</span><span class="s">&quot;searchentry&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;signal</span> <span class="na">name=</span><span class="s">&quot;search-changed&quot;</span> <span class="na">handler=</span><span class="s">&quot;search_text_changed&quot;</span><span class="nt">/&gt;</span>
              <span class="nt">&lt;/object&gt;</span>
            <span class="nt">&lt;/child&gt;</span>
          <span class="nt">&lt;/object&gt;</span>
        <span class="nt">&lt;/child&gt;</span>
        <span class="nt">&lt;child&gt;</span>
          <span class="nt">&lt;object</span> <span class="na">class=</span><span class="s">&quot;GtkBox&quot;</span> <span class="na">id=</span><span class="s">&quot;hbox&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;child&gt;</span>
              <span class="nt">&lt;object</span> <span class="na">class=</span><span class="s">&quot;GtkRevealer&quot;</span> <span class="na">id=</span><span class="s">&quot;sidebar&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;transition-type&quot;</span><span class="nt">&gt;</span>slide-right<span class="nt">&lt;/property&gt;</span>
                <span class="nt">&lt;child&gt;</span>
                  <span class="nt">&lt;object</span> <span class="na">class=</span><span class="s">&quot;GtkScrolledWindow&quot;</span> <span class="na">id=</span><span class="s">&quot;sidebar-sw&quot;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;hscrollbar-policy&quot;</span><span class="nt">&gt;</span>never<span class="nt">&lt;/property&gt;</span>
                    <span class="nt">&lt;child&gt;</span>
                      <span class="nt">&lt;object</span> <span class="na">class=</span><span class="s">&quot;GtkListBox&quot;</span> <span class="na">id=</span><span class="s">&quot;words&quot;</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;selection-mode&quot;</span><span class="nt">&gt;</span>none<span class="nt">&lt;/property&gt;</span>
                      <span class="nt">&lt;/object&gt;</span>
                    <span class="nt">&lt;/child&gt;</span>
                  <span class="nt">&lt;/object&gt;</span>
                <span class="nt">&lt;/child&gt;</span>
              <span class="nt">&lt;/object&gt;</span>
            <span class="nt">&lt;/child&gt;</span>
            <span class="nt">&lt;child&gt;</span>
              <span class="nt">&lt;object</span> <span class="na">class=</span><span class="s">&quot;GtkStack&quot;</span> <span class="na">id=</span><span class="s">&quot;stack&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;signal</span> <span class="na">name=</span><span class="s">&quot;notify::visible-child&quot;</span> <span class="na">handler=</span><span class="s">&quot;visible_child_changed&quot;</span><span class="nt">/&gt;</span>
              <span class="nt">&lt;/object&gt;</span>
            <span class="nt">&lt;/child&gt;</span>
          <span class="nt">&lt;/object&gt;</span>
        <span class="nt">&lt;/child&gt;</span>
      <span class="nt">&lt;/object&gt;</span>
    <span class="nt">&lt;/child&gt;</span>
  <span class="nt">&lt;/template&gt;</span>
<span class="nt">&lt;/interface&gt;</span>
</code></pre></div>

<p>The code to populate the sidebar with buttons for the words found in each
file is a little too involved to go into here. But we&#8217;ll look at the code
to add a checkbutton for the new feature to the&nbsp;menu.</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;interface&gt;</span>
  <span class="nt">&lt;menu</span> <span class="na">id=</span><span class="s">&quot;menu&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;section&gt;</span>
      <span class="nt">&lt;item&gt;</span>
        <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">&quot;label&quot;</span> <span class="na">translatable=</span><span class="s">&quot;yes&quot;</span><span class="nt">&gt;</span>_Words<span class="nt">&lt;/attribute&gt;</span>
        <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">&quot;action&quot;</span><span class="nt">&gt;</span>win.show-words<span class="nt">&lt;/attribute&gt;</span>
      <span class="nt">&lt;/item&gt;</span>
      <span class="nt">&lt;item&gt;</span>
        <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">&quot;label&quot;</span> <span class="na">translatable=</span><span class="s">&quot;yes&quot;</span><span class="nt">&gt;</span>_Preferences<span class="nt">&lt;/attribute&gt;</span>
        <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">&quot;action&quot;</span><span class="nt">&gt;</span>app.preferences<span class="nt">&lt;/attribute&gt;</span>
      <span class="nt">&lt;/item&gt;</span>
    <span class="nt">&lt;/section&gt;</span>
    <span class="nt">&lt;section&gt;</span>
      <span class="nt">&lt;item&gt;</span>
        <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">&quot;label&quot;</span> <span class="na">translatable=</span><span class="s">&quot;yes&quot;</span><span class="nt">&gt;</span>_Quit<span class="nt">&lt;/attribute&gt;</span>
        <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">&quot;action&quot;</span><span class="nt">&gt;</span>app.quit<span class="nt">&lt;/attribute&gt;</span>
      <span class="nt">&lt;/item&gt;</span>
    <span class="nt">&lt;/section&gt;</span>
  <span class="nt">&lt;/menu&gt;</span>
<span class="nt">&lt;/interface&gt;</span>
</code></pre></div>

<p>To connect the menuitem to the show-words setting, we use
a <code>GAction</code> corresponding to the given <code>GSettings</code> key.</p>
<div class="codehilite"><pre><span></span><code><span class="p">...</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">example_app_window_init</span> <span class="p">(</span><span class="n">ExampleAppWindow</span> <span class="o">*</span><span class="n">win</span><span class="p">)</span>
<span class="p">{</span>

<span class="p">...</span>

  <span class="n">builder</span> <span class="o">=</span> <span class="n">gtk_builder_new_from_resource</span> <span class="p">(</span><span class="s">&quot;/org/gtk/exampleapp/gears-menu.ui&quot;</span><span class="p">);</span>
  <span class="n">menu</span> <span class="o">=</span> <span class="n">G_MENU_MODEL</span> <span class="p">(</span><span class="n">gtk_builder_get_object</span> <span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="s">&quot;menu&quot;</span><span class="p">));</span>
  <span class="n">gtk_menu_button_set_menu_model</span> <span class="p">(</span><span class="n">GTK_MENU_BUTTON</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">gears</span><span class="p">),</span> <span class="n">menu</span><span class="p">);</span>
  <span class="n">g_object_unref</span> <span class="p">(</span><span class="n">builder</span><span class="p">);</span>

  <span class="n">action</span> <span class="o">=</span> <span class="n">g_settings_create_action</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">settings</span><span class="p">,</span> <span class="s">&quot;show-words&quot;</span><span class="p">);</span>
  <span class="n">g_action_map_add_action</span> <span class="p">(</span><span class="n">G_ACTION_MAP</span> <span class="p">(</span><span class="n">win</span><span class="p">),</span> <span class="n">action</span><span class="p">);</span>
  <span class="n">g_object_unref</span> <span class="p">(</span><span class="n">action</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">...</span>
</code></pre></div>

<p>(<a href="https://gitlab.gnome.org/GNOME/gtk/blob/master/examples/application8/exampleappwin.c">full source</a>)</p>
<p>What our application looks like&nbsp;now:</p>
<p><img alt="A sidebar" src="getting-started-app8.png" /></p>
<h3 id="properties">Properties<a class="md-anchor" href="#properties" title="Permanent link"></a></h3>
<p>Widgets and other objects have many useful&nbsp;properties.</p>
<p>Here we show some ways to use them in new and flexible ways, by wrapping
them in actions with <code>GPropertyAction</code> or by binding them with <code>GBinding</code>.</p>
<p>To set this up, we add two labels to the header bar in our window template,
named <code>lines_label</code> and <code>lines</code>, and bind them to struct members in the
private struct, as we&#8217;ve seen a couple of times by&nbsp;now.</p>
<p>We add a new &#8220;Lines&#8221; menu item to the gears menu, which triggers the
show-lines&nbsp;action:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;interface&gt;</span>
  <span class="nt">&lt;menu</span> <span class="na">id=</span><span class="s">&quot;menu&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;section&gt;</span>
      <span class="nt">&lt;item&gt;</span>
        <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">&quot;label&quot;</span> <span class="na">translatable=</span><span class="s">&quot;yes&quot;</span><span class="nt">&gt;</span>_Words<span class="nt">&lt;/attribute&gt;</span>
        <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">&quot;action&quot;</span><span class="nt">&gt;</span>win.show-words<span class="nt">&lt;/attribute&gt;</span>
      <span class="nt">&lt;/item&gt;</span>
      <span class="nt">&lt;item&gt;</span>
        <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">&quot;label&quot;</span> <span class="na">translatable=</span><span class="s">&quot;yes&quot;</span><span class="nt">&gt;</span>_Lines<span class="nt">&lt;/attribute&gt;</span>
        <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">&quot;action&quot;</span><span class="nt">&gt;</span>win.show-lines<span class="nt">&lt;/attribute&gt;</span>
      <span class="nt">&lt;/item&gt;</span>
      <span class="nt">&lt;item&gt;</span>
        <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">&quot;label&quot;</span> <span class="na">translatable=</span><span class="s">&quot;yes&quot;</span><span class="nt">&gt;</span>_Preferences<span class="nt">&lt;/attribute&gt;</span>
        <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">&quot;action&quot;</span><span class="nt">&gt;</span>app.preferences<span class="nt">&lt;/attribute&gt;</span>
      <span class="nt">&lt;/item&gt;</span>
    <span class="nt">&lt;/section&gt;</span>
    <span class="nt">&lt;section&gt;</span>
      <span class="nt">&lt;item&gt;</span>
        <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">&quot;label&quot;</span> <span class="na">translatable=</span><span class="s">&quot;yes&quot;</span><span class="nt">&gt;</span>_Quit<span class="nt">&lt;/attribute&gt;</span>
        <span class="nt">&lt;attribute</span> <span class="na">name=</span><span class="s">&quot;action&quot;</span><span class="nt">&gt;</span>app.quit<span class="nt">&lt;/attribute&gt;</span>
      <span class="nt">&lt;/item&gt;</span>
    <span class="nt">&lt;/section&gt;</span>
  <span class="nt">&lt;/menu&gt;</span>
<span class="nt">&lt;/interface&gt;</span>
</code></pre></div>

<p>To make this menu item do something, we create a property action for the
visible property of the <code>lines</code> label, and add it to the actions of the
window. The effect of this is that the visibility of the label gets toggled
every time the action is&nbsp;activated.</p>
<p>Since we want both labels to appear and disappear together, we bind
the visible property of the <code>lines_label</code> widget to the same property
of the <code>lines</code> widget.</p>
<div class="codehilite"><pre><span></span><code><span class="p">...</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="n">example_app_window_init</span> <span class="p">(</span><span class="n">ExampleAppWindow</span> <span class="o">*</span><span class="n">win</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">...</span>

  <span class="n">action</span> <span class="o">=</span> <span class="p">(</span><span class="n">GAction</span><span class="o">*</span><span class="p">)</span> <span class="n">g_property_action_new</span> <span class="p">(</span><span class="s">&quot;show-lines&quot;</span><span class="p">,</span> <span class="n">win</span><span class="o">-&gt;</span><span class="n">lines</span><span class="p">,</span> <span class="s">&quot;visible&quot;</span><span class="p">);</span>
  <span class="n">g_action_map_add_action</span> <span class="p">(</span><span class="n">G_ACTION_MAP</span> <span class="p">(</span><span class="n">win</span><span class="p">),</span> <span class="n">action</span><span class="p">);</span>
  <span class="n">g_object_unref</span> <span class="p">(</span><span class="n">action</span><span class="p">);</span>

  <span class="n">g_object_bind_property</span> <span class="p">(</span><span class="n">win</span><span class="o">-&gt;</span><span class="n">lines</span><span class="p">,</span> <span class="s">&quot;visible&quot;</span><span class="p">,</span>
                          <span class="n">win</span><span class="o">-&gt;</span><span class="n">lines_label</span><span class="p">,</span> <span class="s">&quot;visible&quot;</span><span class="p">,</span>
                          <span class="n">G_BINDING_DEFAULT</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">...</span>
</code></pre></div>

<p>(<a href="https://gitlab.gnome.org/GNOME/gtk/blob/master/examples/application9/exampleappwin.c">full source</a>)</p>
<p>We also need a function that counts the lines of the currently active tab,
and updates the <code>lines</code> label. See the <a href="https://gitlab.gnome.org/GNOME/gtk/blob/master/examples/application9/exampleappwin.c">full source</a>
if you are interested in the&nbsp;details.</p>
<p>This brings our example application to this&nbsp;appearance:</p>
<p><img alt="Full application" src="getting-started-app9.png" /></p>
    </div>
  </section>
</section>


    <section id="search" class="content hidden"></section>

    <footer>
    
    </footer>
  </div>
</body>
</html>