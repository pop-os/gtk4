<!--
SPDX-FileCopyrightText: 2021 GNOME Foundation

SPDX-License-Identifier: Apache-2.0 OR GPL-3.0-or-later
-->

<!--
SPDX-FileCopyrightText: 2021 GNOME Foundation

SPDX-License-Identifier: Apache-2.0 OR GPL-3.0-or-later
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <title>Gtk &ndash; 4.0: Migrating from GTK 3.x to GTK 4</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta charset="utf-8" />

  
  <meta property="og:type" content="website"/>

  
  <meta property="og:image:width" content="256"/>
  <meta property="og:image:height" content="256"/>
  <meta property="og:image:secure_url" content="gtk-logo.svg"/>
  <meta property="og:image:alt" content="Gtk-4.0"/>
  

  
  <meta property="og:title" content="Gtk: Migrating from GTK 3.x to GTK 4"/>
  <meta property="og:description" content="Reference for Gtk-4.0: Migrating from GTK 3.x to GTK 4"/>
  <meta name="twitter:title" content="Gtk: Migrating from GTK 3.x to GTK 4"/>
  <meta name="twitter:description" content="Reference for Gtk-4.0: Migrating from GTK 3.x to GTK 4"/>


  
  <meta name="twitter:card" content="summary"/>

  

  <link rel="stylesheet" href="style.css" type="text/css" />

  

  
  <script src="urlmap.js"></script>
  
  
  <script src="fzy.js"></script>
  <script src="search.js"></script>
  
  <script src="main.js"></script>
  <!--[if IE]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>

<body>
  <div id="body-wrapper" tabindex="-1">

    <nav class="sidebar devhelp-hidden">
      
      <div class="section">
        <img src="gtk-logo.svg" class="logo"/>
      </div>
      
      
      <div class="search section">
        <form id="search-form" autocomplete="off">
          <input id="search-input" type="text" name="do-not-autocomplete" placeholder="Click, or press 's' to search" autocomplete="off"/>
        </form>
      </div>
      
      <div class="section namespace">
        <h3><a href="index.html">Gtk</a></h3>
        <p>API Version: 4.0</p>
        
        <p>Library Version: 4.3.2</p>
        
      </div>
      
      
    </nav>

    
    <button id="btn-to-top" class="hidden"><span class="up-arrow"></span></button>
    

    
<section id="main" class="content">
  <section>
    <div class="docblock">
    <p><span class="caps">GTK</span> 4 is a major new version of <span class="caps">GTK</span> that breaks both <span class="caps">API</span> and <span class="caps">ABI</span>
compared to <span class="caps">GTK</span> 3.x. Thankfully, most of the changes are not hard
to adapt to and there are a number of steps that you can take to
prepare your <span class="caps">GTK</span> 3.x application for the switch to <span class="caps">GTK</span> 4. After
that, there&#8217;s a number of adjustments that you may have to do
when you actually switch your application to build against <span class="caps">GTK</span>&nbsp;4.</p>
<h2 id="preparation-in-gtk-3x">Preparation in GTK 3.x<a class="md-anchor" href="#preparation-in-gtk-3x" title="Permanent link"></a></h2>
<p>The steps outlined in the following sections assume that your
application is working with <span class="caps">GTK</span> 3.24, which is the final stable
release of <span class="caps">GTK</span> 3.x. It includes all the necessary APIs and tools
to help you port your application to <span class="caps">GTK</span> 4. If you are using
an older version of <span class="caps">GTK</span> 3.x, you should first get your application
to build and work with the latest minor release in the 3.24&nbsp;series.</p>
<h3 id="do-not-use-deprecated-symbols">Do not use deprecated symbols<a class="md-anchor" href="#do-not-use-deprecated-symbols" title="Permanent link"></a></h3>
<p>Over the years, a number of functions, and in some cases, entire
widgets have been deprecated. These deprecations are clearly spelled
out in the <span class="caps">API</span> reference, with hints about the recommended replacements.
The <span class="caps">API</span> reference for <span class="caps">GTK</span> 3 also includes an
<a href="https://developer.gnome.org/gtk3/3.24/api-index-deprecated.html">index</a>
of all deprecated&nbsp;symbols.</p>
<p>To verify that your program does not use any deprecated symbols,
you can use defines to remove deprecated symbols from the header files,
as&nbsp;follows:</p>
<div class="codehilite"><pre><span></span><code>make CFLAGS+=&quot;-DGDK_DISABLE_DEPRECATED -DGTK_DISABLE_DEPRECATED&quot;
</code></pre></div>

<p>Note that some parts of our <span class="caps">API</span>, such as enumeration values, are
not well covered by the deprecation warnings. In most cases, using
them will require you to also use deprecated functions, which will
trigger&nbsp;warnings.</p>
<h3 id="enable-diagnostic-warnings">Enable diagnostic warnings<a class="md-anchor" href="#enable-diagnostic-warnings" title="Permanent link"></a></h3>
<p>Deprecations of properties and signals cannot be caught at compile
time, as both properties and signals are installed and used after
types have been instantiated. In order to catch deprecations and
changes in the run time components, you should use the
<code>G_ENABLE_DIAGNOSTIC</code> environment variable when running your
application,&nbsp;e.g.:</p>
<div class="codehilite"><pre><span></span><code>G_ENABLE_DIAGNOSTIC=1 ./your-app
</code></pre></div>

<h3 id="do-not-use-gtk-specific-command-line-arguments">Do not use GTK-specific command line arguments<a class="md-anchor" href="#do-not-use-gtk-specific-command-line-arguments" title="Permanent link"></a></h3>
<p><span class="caps">GTK</span> 4 does not parse command line arguments any more. If you are using
command line arguments like <code>--gtk-debug</code> you should use the <code>GTK_DEBUG</code>
environment variable instead. If you are using <code>--g-fatal-warnings</code> for
debugging purposes, you should use the <code>G_DEBUG</code> environment variable, as
specified by the
<a href="https://developer.gnome.org/glib/stable/glib-running.html">GLib documentation</a>.</p>
<h3 id="do-not-use-widget-style-properties">Do not use widget style properties<a class="md-anchor" href="#do-not-use-widget-style-properties" title="Permanent link"></a></h3>
<p>Style properties do not exist in <span class="caps">GTK</span> 4. You should stop using them in
your custom <span class="caps">CSS</span> and in your&nbsp;code.</p>
<h3 id="review-your-window-creation-flags">Review your window creation flags<a class="md-anchor" href="#review-your-window-creation-flags" title="Permanent link"></a></h3>
<p><span class="caps">GTK</span> 4 removes the <code>GDK_WA_CURSOR</code> flag. Instead, just use
<code>gdk_window_set_cursor()</code> to set a cursor on the window after
creating it. <span class="caps">GTK</span> 4 also removes the <code>GDK_WA_VISUAL</code> flag, and
always uses an <span class="caps">RGBA</span> visual for windows. To prepare your code for
this, use <code>gdk_window_set_visual (gdk_screen_get_rgba_visual ())</code>
after creating your window. <span class="caps">GTK</span> 4 also removes the <code>GDK_WA_WMCLASS</code>
flag. If you need this X11-specific functionality, use <code>XSetClassHint()</code>
directly.</p>
<h3 id="stop-using-direct-access-to-gdkevent-structs">Stop using direct access to GdkEvent structs<a class="md-anchor" href="#stop-using-direct-access-to-gdkevent-structs" title="Permanent link"></a></h3>
<p>In <span class="caps">GTK</span> 4, event structs are opaque and immutable. Many fields already
have accessors in <span class="caps">GTK</span> 3, and you should use those to reduce the amount
of porting work you have to do at the time of the&nbsp;switch.</p>
<h3 id="stop-using-gdk_pointer_warp">Stop using <code>gdk_pointer_warp()</code><a class="md-anchor" href="#stop-using-gdk_pointer_warp" title="Permanent link"></a></h3>
<p>Warping the pointer is disorienting and unfriendly to users.
<span class="caps">GTK</span> 4 does not support it. In special circumstances (such as when
implementing remote connection UIs) it can be necessary to
warp the pointer; in this case, use platform APIs such as
<code>XWarpPointer()</code> directly.</p>
<h3 id="stop-using-non-rgba-visuals">Stop using non-RGBA visuals<a class="md-anchor" href="#stop-using-non-rgba-visuals" title="Permanent link"></a></h3>
<p><span class="caps">GTK</span> 4 always uses <span class="caps">RGBA</span> visuals for its windows; you should make
sure that your code works with such visuals. At the same time,
you should stop using <code>GdkVisual</code> APIs, since this object not longer
exists in <span class="caps">GTK</span> 4. Most of its APIs are deprecated already and not
useful when dealing with <span class="caps">RGBA</span>&nbsp;visuals.</p>
<h3 id="stop-using-gtk_widget_set_app_paintable">Stop using <code>gtk_widget_set_app_paintable</code><a class="md-anchor" href="#stop-using-gtk_widget_set_app_paintable" title="Permanent link"></a></h3>
<p>This is gone in <span class="caps">GTK4</span> with no direct replacement. But for some usecases there
are alternatives. If you want to make the background transparent, you can set
the background color to, for example, <code>rgba(255, 255, 255, 0)</code> using <span class="caps">CSS</span>&nbsp;instead.</p>
<h3 id="stop-using-gtkbox-padding-fill-and-expand-child-properties">Stop using <code>GtkBox</code> padding, fill and expand child properties<a class="md-anchor" href="#stop-using-gtkbox-padding-fill-and-expand-child-properties" title="Permanent link"></a></h3>
<p><span class="caps">GTK</span> 4 removes these <a href="class.Box.html"><code>GtkBox</code></a> child properties, so you should stop using
them. You can replace <code>GtkBox:padding</code> using <code>GtkWidget</code><span class="quo">&#8216;</span>s <code>margin-*</code> properties
on your child&nbsp;widgets.</p>
<p>The fill child property can be replaced by setting appropriate values for
the <a href="property.Widget.halign.html"><code>GtkWidget:halign</code></a> and <a href="property.Widget.valign.html"><code>GtkWidget:valign</code></a> properties
of the child widgets. If you previously set the <code>fill</code> child property to
<code>TRUE</code>, you can achieve the same effect by setting the <code>halign</code> or <code>valign</code>
properties to <code>GTK_ALIGN_FILL</code>, depending on the parent box &#8212; <code>halign</code> for a
horizontal box, <code>valign</code> for a vertical&nbsp;one.</p>
<p><a href="class.Box.html"><code>GtkBox</code></a> also uses the expand child property. It can be replaced by
setting <a href="property.Widget.hexpand.html"><code>GtkWidget:hexpand</code></a> or <a href="property.Widget.vexpand.html"><code>GtkWidget:vexpand</code></a> on
the child widgets. To match the old behavior of the <code>GtkBox</code><span class="quo">&#8216;</span>s expand child
property, you need to set <code>hexpand</code> on the child widgets of a horizontal
<code>GtkBox</code> and <code>vexpand</code> on the child widgets of a vertical <code>GtkBox</code>.</p>
<p>Note that there&#8217;s a subtle but important difference between <code>GtkBox</code><span class="quo">&#8216;</span>s
<code>expand</code> and <code>fill</code> child properties and the ones in <code>GtkWidget</code>: setting
<a href="property.Widget.hexpand.html"><code>GtkWidget:hexpand</code></a> or <a href="property.Widget.vexpand.html"><code>GtkWidget:vexpand</code></a> to <code>TRUE</code>
will propagate up the widget hierarchy, so a pixel-perfect port might
require you to reset the expansion flags to <code>FALSE</code> in a parent widget higher
up the&nbsp;hierarchy.</p>
<h3 id="stop-using-the-state-argument-of-gtkstylecontext-getters">Stop using the state argument of <code>GtkStyleContext</code> getters<a class="md-anchor" href="#stop-using-the-state-argument-of-gtkstylecontext-getters" title="Permanent link"></a></h3>
<p>The getters in the <a href="class.StyleContext.html"><code>GtkStyleContext</code></a> <span class="caps">API</span>, such as
<code>gtk_style_context_get_property()</code>, <code>gtk_style_context_get()</code>,
or <code>gtk_style_context_get_color()</code> only accept the context&#8217;s current
state for their state argument. You should update all callers to pass
the current&nbsp;state.</p>
<h3 id="stop-using-gdk_pixbuf_get_from_window-and-gdk_cairo_set_source_window">Stop using <code>gdk_pixbuf_get_from_window()</code> and <code>gdk_cairo_set_source_window()</code><a class="md-anchor" href="#stop-using-gdk_pixbuf_get_from_window-and-gdk_cairo_set_source_window" title="Permanent link"></a></h3>
<p>These functions are not supported in <span class="caps">GTK</span> 4. Instead, either use
backend-specific APIs, or render your widgets using
<a href="vfunc.Widget.snapshot.html"><code>Gtk.WidgetClass.snapshot</code></a>, once you are using <span class="caps">GTK</span>&nbsp;4.</p>
<h3 id="stop-using-gtkbuttons-image-related-api">Stop using <code>GtkButton</code>'s image-related API<a class="md-anchor" href="#stop-using-gtkbuttons-image-related-api" title="Permanent link"></a></h3>
<p>The functions and properties related to automatically add a
<a href="class.Image.html"><code>GtkImage</code></a> to a <a href="class.Button.html"><code>GtkButton</code></a>, and using a <code>GtkSetting</code> to
control its visibility, are not supported in <span class="caps">GTK</span> 4. Instead, you can just
pack a GtkImage inside a GtkButton, and control its visibility like you
would for any other widget. If you only want to add a named icon to a
GtkButton, you can use <a href="ctor.Button.new_from_icon_name.html">gtk_button_new_from_icon_name()</a>.</p>
<h3 id="stop-using-gtkwidget-event-signals">Stop using <code>GtkWidget</code> event signals<a class="md-anchor" href="#stop-using-gtkwidget-event-signals" title="Permanent link"></a></h3>
<p>Event controllers and gestures replace event signals in <span class="caps">GTK</span>&nbsp;4.</p>
<p>Most of them have been backported to <span class="caps">GTK</span> 3.x so you can prepare
for this&nbsp;change.</p>
<table>
<thead>
<tr>
<th>Signal</th>
<th>Event controller</th>
</tr>
</thead>
<tbody>
<tr>
<td>::event</td>
<td><a href="class.EventControllerLegacy.html"><code>GtkEventControllerLegacy</code></a></td>
</tr>
<tr>
<td>::event-after</td>
<td><a href="class.EventControllerLegacy.html"><code>GtkEventControllerLegacy</code></a></td>
</tr>
<tr>
<td>::button-press-event</td>
<td><a href="class.GestureClick.html"><code>GtkGestureClick</code></a></td>
</tr>
<tr>
<td>::button-release-event</td>
<td><a href="class.GestureClick.html"><code>GtkGestureClick</code></a></td>
</tr>
<tr>
<td>::touch-event</td>
<td>various touch gestures</td>
</tr>
<tr>
<td>::scroll-event</td>
<td><a href="class.EventControllerScroll.html"><code>GtkEventControllerScroll</code></a></td>
</tr>
<tr>
<td>::motion-notify-event</td>
<td><a href="class.EventControllerMotion.html"><code>GtkEventControllerMotion</code></a></td>
</tr>
<tr>
<td>::delete-event</td>
<td>-</td>
</tr>
<tr>
<td>::key-press-event</td>
<td><a href="class.EventControllerKey.html"><code>GtkEventControllerKey</code></a></td>
</tr>
<tr>
<td>::key-release-event</td>
<td><a href="class.EventControllerKey.html"><code>GtkEventControllerKey</code></a></td>
</tr>
<tr>
<td>::enter-notify-event</td>
<td><a href="class.EventControllerMotion.html"><code>GtkEventControllerMotion</code></a></td>
</tr>
<tr>
<td>::leave-notify-event</td>
<td><a href="class.EventControllerMotion.html"><code>GtkEventControllerMotion</code></a></td>
</tr>
<tr>
<td>::configure-event</td>
<td>-</td>
</tr>
<tr>
<td>::focus-in-event</td>
<td><a href="class.EventControllerFocus.html"><code>GtkEventControllerFocus</code></a></td>
</tr>
<tr>
<td>::focus-out-event</td>
<td><a href="class.EventControllerFocus.html"><code>GtkEventControllerFocus</code></a></td>
</tr>
<tr>
<td>::map-event</td>
<td>-</td>
</tr>
<tr>
<td>::unmap-event</td>
<td>-</td>
</tr>
<tr>
<td>::property-notify-event</td>
<td>replaced by <a href="javascript:void(0)" data-namespace="Gdk" data-link="class.Clipboard.html" class="external"><code>GdkClipboard</code></a></td>
</tr>
<tr>
<td>::selection-clear-event</td>
<td>replaced by <a href="javascript:void(0)" data-namespace="Gdk" data-link="class.Clipboard.html" class="external"><code>GdkClipboard</code></a></td>
</tr>
<tr>
<td>::selection-request-event</td>
<td>replaced by <a href="javascript:void(0)" data-namespace="Gdk" data-link="class.Clipboard.html" class="external"><code>GdkClipboard</code></a></td>
</tr>
<tr>
<td>::selection-notify-event</td>
<td>replaced by <a href="javascript:void(0)" data-namespace="Gdk" data-link="class.Clipboard.html" class="external"><code>GdkClipboard</code></a></td>
</tr>
<tr>
<td>Drag-and-Drop signals</td>
<td><a href="class.DragSource.html"><code>GtkDragSource</code></a>, <a href="class.DropTarget.html"><code>GtkDropTarget</code></a></td>
</tr>
<tr>
<td>::proximity-in-event</td>
<td><a href="class.GestureStylus.html"><code>GtkGestureStylus</code></a></td>
</tr>
<tr>
<td>::proximity-out-event</td>
<td><a href="class.GestureStylus.html"><code>GtkGestureStylus</code></a></td>
</tr>
<tr>
<td>::visibility-notify-event</td>
<td>-</td>
</tr>
<tr>
<td>::window-state-event</td>
<td>-</td>
</tr>
<tr>
<td>::damage-event</td>
<td>-</td>
</tr>
<tr>
<td>::grab-broken-event</td>
<td>-</td>
</tr>
</tbody>
</table>
<p>Event signals which are not directly related to input have to be dealt with
on a one-by-one&nbsp;basis:</p>
<ul>
<li>If you were using <code>::configure-event</code> and <code>::window-state-event</code> to save
   window state, you should use property notification for corresponding
   <a href="class.Window.html"><code>GtkWindow</code></a> properties, such as <a href="property.Window.default-width.html"><code>GtkWindow:default-width</code></a>,
   <a href="property.Window.default-height.html"><code>GtkWindow:default-height</code></a>, <a href="property.Window.maximized.html"><code>GtkWindow:maximized</code></a> or
   <a href="property.Window.fullscreened.html"><code>GtkWindow:fullscreened</code></a>.</li>
<li>If you were using <code>::delete-event</code> to present a confirmation when using
   the close button of a window, you should use the
   <a href="signal.Window.close-request.html"><code>GtkWindow::close-request</code></a>&nbsp;signal.</li>
<li>If you were using <code>::map-event</code> and <code>::unmap-event</code> to track a window
   being mapped, you should use property notification for the
   <a href="javascript:void(0)" data-namespace="Gdk" data-link="property.Surface.mapped.html" class="external"><code>GdkSurface:mapped</code></a> property&nbsp;instead.</li>
<li>The <code>::damage-event</code> signal has no replacement, as the only consumer
   of damage events were the offscreen <span class="caps">GDK</span> surfaces, which have no
   replacement in <span class="caps">GTK</span>&nbsp;4.x.</li>
</ul>
<h3 id="set-a-proper-application-id">Set a proper application ID<a class="md-anchor" href="#set-a-proper-application-id" title="Permanent link"></a></h3>
<p>In <span class="caps">GTK</span> 4 we want the application&#8217;s <code>GApplication</code> <span class="quo">&#8216;</span>application-id&#8217; (and
therefore the D-Bus name), the desktop file basename and Wayland&#8217;s xdg-shell
<code>app_id</code> to match. In order to achieve this with <span class="caps">GTK</span> 3.x call
<code>g_set_prgname()</code> with the same application <span class="caps">ID</span> you passed to
<a href="class.Application.html"><code>GtkApplication</code></a>.  Rename your desktop files to match the application
<span class="caps">ID</span> if&nbsp;needed.</p>
<p>The call to <code>g_set_prgname()</code> can be removed once you fully migrated to <span class="caps">GTK</span>&nbsp;4.</p>
<p>You should be aware that changing the application <span class="caps">ID</span> makes your
application appear as a new, different app to application installers.
You should consult the appstream documentation for best practices
around renaming&nbsp;applications.</p>
<h3 id="stop-using-gtk_main-and-related-apis">Stop using <code>gtk_main()</code> and related APIs<a class="md-anchor" href="#stop-using-gtk_main-and-related-apis" title="Permanent link"></a></h3>
<p><span class="caps">GTK</span> 4 removes the <code>gtk_main_*</code> family of APIs. The recommended replacement
is <a href="class.Application.html"><code>GtkApplication</code></a>, but you can also iterate the GLib main loop directly,
using <code>GMainContext</code> APIs. The replacement for <code>gtk_events_pending()</code> is
<code>g_main_context_pending()</code>, the replacement for <code>gtk_main_iteration()</code> is
<code>g_main_context_iteration()</code>.</p>
<p>In <span class="caps">GTK</span> 4, you can use this replacement that will iterate the default main loop
until all windows have been&nbsp;closed:</p>
<div class="codehilite"><pre><span></span><code>while (g_list_model_get_n_items (gtk_window_get_toplevels ()) &gt; 0)
  g_main_context_iteration (NULL, TRUE);
</code></pre></div>

<h3 id="reduce-the-use-of-gtk_widget_destroy">Reduce the use of <code>gtk_widget_destroy()</code><a class="md-anchor" href="#reduce-the-use-of-gtk_widget_destroy" title="Permanent link"></a></h3>
<p><span class="caps">GTK</span> 4 introduces a <a href="method.Window.destroy.html">gtk_window_destroy()</a> api. While that is not available
in <span class="caps">GTK</span> 3, you can prepare for the switch by using <code>gtk_widget_destroy()</code>
only on toplevel windows, and replace all other uses with
<code>gtk_container_remove()</code> or <code>g_object_unref()</code>.</p>
<h3 id="stop-using-the-gtkwidgetdestroy-vfunc">Stop using the GtkWidget.destroy vfunc<a class="md-anchor" href="#stop-using-the-gtkwidgetdestroy-vfunc" title="Permanent link"></a></h3>
<p>Instead of implementing GtkWidget.destroy, you can implement&nbsp;GObject.dispose.</p>
<h3 id="reduce-the-use-of-generic-container-apis">Reduce the use of generic container APIs<a class="md-anchor" href="#reduce-the-use-of-generic-container-apis" title="Permanent link"></a></h3>
<p><span class="caps">GTK</span> 4 removes <code>gtk_container_add()</code> and <code>gtk_container_remove()</code>. While there
is not always a replacement for <code>gtk_container_remove()</code> in <span class="caps">GTK</span> 3, you can
replace many uses of <code>gtk_container_add()</code> with equivalent container-specific
APIs such as <code>gtk_box_pack_start()</code> or <code>gtk_grid_attach()</code>, and thereby reduce
the amount of work you have to do at the time of the&nbsp;switch.</p>
<h3 id="review-your-use-of-icon-resources">Review your use of icon resources<a class="md-anchor" href="#review-your-use-of-icon-resources" title="Permanent link"></a></h3>
<p>When using icons as resources, the behavior of <span class="caps">GTK</span> 4 is different in one
respect: Icons that are directly in <code>$APP_ID/icons/</code> are treated as unthemed
icons, which also means that symbolic icons are not recolored. If you want
your icon resources to have icon theme semantics, they need to be placed
into theme subdirectories such as <code>$APP_ID/icons/16x16/actions</code> or
<code>$APP_ID/icons/scalable/status</code>.</p>
<p>This location works fine in <span class="caps">GTK</span> 3 too, so you can prepare for this change
before switching to <span class="caps">GTK</span>&nbsp;4.</p>
<h2 id="changes-that-need-to-be-done-at-the-time-of-the-switch">Changes that need to be done at the time of the switch<a class="md-anchor" href="#changes-that-need-to-be-done-at-the-time-of-the-switch" title="Permanent link"></a></h2>
<p>This section outlines porting tasks that you need to tackle when
you get to the point that you actually build your application against
<span class="caps">GTK</span> 4. Making it possible to prepare for these in <span class="caps">GTK</span> 3 would
have been either impossible or&nbsp;impractical.</p>
<h3 id="larger-changes">Larger changes<a class="md-anchor" href="#larger-changes" title="Permanent link"></a></h3>
<p>Some of the larger themes of <span class="caps">GTK</span> 4 development are hard to cover in the form
of checklist items, so we mention them separately&nbsp;up-front.</p>
<h4 id="subclassing">Subclassing<a class="md-anchor" href="#subclassing" title="Permanent link"></a></h4>
<p>Compared to previous versions, <span class="caps">GTK</span> 4 emphasizes composition and delegation
over subclassing. As a consequence, many widgets can no longer be subclassed.
In most cases, you should look deriving your widget directly from GtkWidget
and use complex widgets as child widgets instead of deriving from&nbsp;them.</p>
<h4 id="life-cycle-handling">Life-cycle handling<a class="md-anchor" href="#life-cycle-handling" title="Permanent link"></a></h4>
<p>Widgets in <span class="caps">GTK</span> 4 are treated like any other objects - their parent widget
holds a reference on them, and <span class="caps">GTK</span> holds a reference on toplevel windows.
<a href="method.Window.destroy.html">gtk_window_destroy()</a> will drop the reference on the toplevel window,
and cause the whole widget hierarchy to be finalized unless there are other
references that keep widgets&nbsp;alive.</p>
<p>The <a href="signal.Widget.destroy.html"><code>GtkWidget::destroy</code></a> signal is emitted when a widget is
disposed, and therefore can no longer be used to break reference cycles.
A typical sign of a reference cycle involving a toplevel window is when
closing the window does not make the application&nbsp;quit.</p>
<h3 id="stop-using-gdkscreen">Stop using GdkScreen<a class="md-anchor" href="#stop-using-gdkscreen" title="Permanent link"></a></h3>
<p>The <code>GdkScreen</code> object has been removed in <span class="caps">GTK</span> 4. Most of its APIs already
had replacements in <span class="caps">GTK</span> 3 and were deprecated, a few remaining replacements
have been added to <code>GdkDisplay</code>.</p>
<h3 id="stop-using-the-root-window">Stop using the root window<a class="md-anchor" href="#stop-using-the-root-window" title="Permanent link"></a></h3>
<p>The root window is an X11-centric concept that is no longer exposed in the
backend-neutral <span class="caps">GDK</span> <span class="caps">API</span>. If you need to interact with the X11 root window,
you can use GdkX11.Display.get_xrootwindow to get its <span class="caps">XID</span>.</p>
<h3 id="stop-using-gdkvisual">Stop using <code>GdkVisual</code><a class="md-anchor" href="#stop-using-gdkvisual" title="Permanent link"></a></h3>
<p>This object is not useful with current <span class="caps">GTK</span> drawing APIs and has been removed
without&nbsp;replacement.</p>
<h3 id="stop-using-gdkdevicemanager">Stop using <code>GdkDeviceManager</code><a class="md-anchor" href="#stop-using-gdkdevicemanager" title="Permanent link"></a></h3>
<p>The <code>GdkDeviceManager</code> object has been removed in <span class="caps">GTK</span> 4. Most of its APIs already
had replacements in <span class="caps">GTK</span> 3 and were deprecated in favor of <code>GdkSeat</code>.</p>
<h3 id="adapt-to-gdkwindow-api-changes">Adapt to <code>GdkWindow</code> API changes<a class="md-anchor" href="#adapt-to-gdkwindow-api-changes" title="Permanent link"></a></h3>
<p><code>GdkWindow</code> has been renamed to <code>GdkSurface</code>.</p>
<p>In <span class="caps">GTK</span> 4, the two roles of a standalone toplevel window and of a popup that
is placed relative to a parent window have been separated out into two
interfaces, <a href="javascript:void(0)" data-namespace="Gdk" data-link="class.Toplevel.html" class="external"><code>GdkToplevel</code></a> and <a href="javascript:void(0)" data-namespace="Gdk" data-link="class.Popup.html" class="external"><code>GdkPopup</code></a>. Surfaces
implementing these interfaces are created with <a href="javascript:void(0)" data-namespace="Gdk" data-link="ctor.Surface.new_toplevel.html" class="external">gdk_surface_new_toplevel()</a>
and <a href="javascript:void(0)" data-namespace="Gdk" data-link="ctor.Surface.new_popup.html" class="external">gdk_surface_new_popup()</a>, respectively, and they are presented on
screen using <a href="javascript:void(0)" data-namespace="Gdk" data-link="method.Toplevel.present.html" class="external">gdk_toplevel_present()</a> and <a href="javascript:void(0)" data-namespace="Gdk" data-link="method.Popup.present.html" class="external">gdk_popup_present()</a>.
The <code>present()</code> functions take parameters in the form of an auxiliary layout
struct, <a href="javascript:void(0)" data-namespace="Gdk" data-link="struct.PopupLayout.html" class="external"><code>GdkPopupLayout</code></a> or <a href="javascript:void(0)" data-namespace="Gdk" data-link="struct.ToplevelLayout.html" class="external"><code>GdkToplevelLayout</code></a>.</p>
<p>If your code is dealing directly with surfaces, you may have to change it
to call the <span class="caps">API</span> in these interfaces, depending on whether the surface you are
dealing with is a toplevel or a&nbsp;popup.</p>
<p>As part of this reorganization, X11-only concepts such as sticky,
keep-below, urgency, skip-taskbar or window groups have either been
removed or moved to X11 backend api. If you need to use them on your
X11 windows, you will have to use those backend apis or set the
corresponding X11 properties (as specified in the <span class="caps">EWMH</span>)&nbsp;yourself.</p>
<p>Subsurfaces are not currently supported. Native and foreign subwindows
are no longer supported. These concepts were complicating the code
and could not be supported across&nbsp;backends.</p>
<p>A number of GdkWindow APIs are no longer available. This includes
<code>gdk_window_reparent()</code>, <code>gdk_window_set_geometry_hints()</code>, <code>gdk_window_raise()</code>,
<code>gdk_window_restack()</code>, <code>gdk_window_move()</code>, <code>gdk_window_resize()</code>. If
you need to manually control the position or stacking of your X11
windows, you you will have to use Xlib&nbsp;apis.</p>
<p>A number of minor <span class="caps">API</span> cleanups have happened in <code>GdkSurface</code>
as well. For example, <code>gdk_surface_input_shape_combine_region()</code>
has been renamed to <a href="javascript:void(0)" data-namespace="Gdk" data-link="method.Surface.set_input_region.html" class="external">gdk_surface_set_input_region()</a>, and
<code>gdk_surface_begin_resize_drag()</code> has been renamed to
<a href="javascript:void(0)" data-namespace="Gdk" data-link="method.Toplevel.begin_resize.html" class="external">gdk_toplevel_begin_resize()</a>.</p>
<h3 id="the-iconified-window-state-has-been-renamed-to-minimized">The "iconified" window state has been renamed to "minimized"<a class="md-anchor" href="#the-iconified-window-state-has-been-renamed-to-minimized" title="Permanent link"></a></h3>
<p>The <code>GDK_TOPLEVEL_STATE_ICONIFIED</code> value of the <code>GdkSurfaceState</code> enumeration
is now <code>GDK_TOPLEVEL_STATE_MINIMIZED</code> in the <code>GdkToplevelState</code> enumeration.</p>
<p>The <code>GdkWindow</code> functions <code>gdk_window_iconify()</code> and
<code>gdk_window_deiconify()</code> have been renamed to <a href="javascript:void(0)" data-namespace="Gdk" data-link="method.Toplevel.minimize.html" class="external">gdk_toplevel_minimize()</a>
and <a href="javascript:void(0)" data-namespace="Gdk" data-link="method.Toplevel.present.html" class="external">gdk_toplevel_present()</a>,&nbsp;respectively.</p>
<p>The behavior of the minimization and unminimization operations have
not been changed, and they still require support from the underlying
windowing&nbsp;system.</p>
<h3 id="adapt-to-gdkevent-api-changes">Adapt to <code>GdkEvent</code> API changes<a class="md-anchor" href="#adapt-to-gdkevent-api-changes" title="Permanent link"></a></h3>
<p>Direct access to <a href="javascript:void(0)" data-namespace="Gdk" data-link="class.Event.html" class="external"><code>GdkEvent</code></a> structs is no longer possible in <span class="caps">GTK</span> 4.
<code>GdkEvent</code> is now a strictly read-only type, and you can no longer
change any of its fields, or construct new events. All event fields
have accessors that you will have to&nbsp;use.</p>
<p>Event compression is always enabled in <span class="caps">GTK</span> 4, for both motion and
scroll events. If you need to see the uncoalesced motion or scroll
history, use <a href="javascript:void(0)" data-namespace="Gdk" data-link="method.Event.get_history.html" class="external">gdk_event_get_history()</a> on the latest&nbsp;event.</p>
<h3 id="stop-using-grabs">Stop using grabs<a class="md-anchor" href="#stop-using-grabs" title="Permanent link"></a></h3>
<p><span class="caps">GTK</span> 4 no longer provides the <code>gdk_device_grab()</code> or <code>gdk_seat_grab()</code>
apis. If you need to dismiss a popup when the user clicks outside
(the most common use for grabs), you can use the <code>GdkPopup</code>
<a href="javascript:void(0)" data-namespace="Gdk" data-link="property.Popup.autohide.html" class="external"><code>GdkPopup:autohide</code></a> property instead. <a href="class.Popover.html"><code>GtkPopover</code></a>
also has a <a href="property.Popover.autohide.html"><code>GtkPopover:autohide</code></a> property for this. If you
need to prevent the user from interacting with a window while a dialog
is open, use the <a href="property.Window.modal.html"><code>GtkWindow:modal</code></a> property of the&nbsp;dialog.</p>
<h3 id="adapt-to-coordinate-api-changes">Adapt to coordinate API changes<a class="md-anchor" href="#adapt-to-coordinate-api-changes" title="Permanent link"></a></h3>
<p>A number of coordinate APIs in <span class="caps">GTK</span> 3 had <code>double</code> variants:
<code>gdk_device_get_surface_at_position()</code>, <code>gdk_surface_get_device_position()</code>.
These have been changed to use doubles, and the <code>double</code> variants
have been removed. Update your code&nbsp;accordingly.</p>
<p>Any APIs that deal with global (or root) coordinates have been
removed in <span class="caps">GTK</span> 4, since not all backends support them. You should
replace your use of such APIs with surface-relative equivalents.
Examples of this are <code>gdk_surface_get_origin()</code>, <code>gdk_surface_move()</code>
or <code>gdk_event_get_root_coords()</code>.</p>
<h3 id="adapt-to-gdkkeymap-api-changes">Adapt to <code>GdkKeymap</code> API changes<a class="md-anchor" href="#adapt-to-gdkkeymap-api-changes" title="Permanent link"></a></h3>
<p><code>GdkKeymap</code> no longer exists as an independent&nbsp;object.</p>
<p>If you need access to keymap state, it is now exposed as properties
on the <code>GdkDevice</code> representing the keyboard:
<a href="javascript:void(0)" data-namespace="Gdk" data-link="property.Device.direction.html" class="external"><code>GdkDevice:direction</code></a>,
<a href="javascript:void(0)" data-namespace="Gdk" data-link="property.Device.has-bidi-layouts.html" class="external"><code>GdkDevice:has-bidi-layouts</code></a>,
<a href="javascript:void(0)" data-namespace="Gdk" data-link="property.Device.caps-lock-state.html" class="external"><code>GdkDevice:caps-lock-state</code></a>,
<a href="javascript:void(0)" data-namespace="Gdk" data-link="property.Device.num-lock-state.html" class="external"><code>GdkDevice:num-lock-state</code></a>,
<a href="javascript:void(0)" data-namespace="Gdk" data-link="property.Device.scroll-lock-state.html" class="external"><code>GdkDevice:scroll-lock-state</code></a> and
<a href="javascript:void(0)" data-namespace="Gdk" data-link="property.Device.modifier-state.html" class="external"><code>GdkDevice:modifier-state</code></a>. To obtain the keyboard device,
you can&nbsp;use</p>
<div class="codehilite"><pre><span></span><code>gdk_seat_get_keyboard (gdk_display_get_default_seat (display)
</code></pre></div>

<p>If you need access to translated keys for event handling, <code>GdkEvent</code>
now includes all of the translated key state, including consumed
modifiers, group and shift level, so there should be no need to
manually call <code>gdk_keymap_translate_keyboard_state()</code> (which has
been&nbsp;removed).</p>
<p>If you need to do forward or backward mapping between key codes
and key values, use <a href="javascript:void(0)" data-namespace="Gdk" data-link="method.Display.map_keycode.html" class="external">gdk_display_map_keycode()</a> and
<a href="javascript:void(0)" data-namespace="Gdk" data-link="method.Display.map_keyval.html" class="external">gdk_display_map_keyval()</a>, which are the replacements for
<code>gdk_keymap_get_entries_for_keycode()</code> and
<code>gdk_keymap_get_entries_for_keyval()</code>.</p>
<h3 id="adapt-to-changes-in-keyboard-modifier-handling">Adapt to changes in keyboard modifier handling<a class="md-anchor" href="#adapt-to-changes-in-keyboard-modifier-handling" title="Permanent link"></a></h3>
<p><span class="caps">GTK</span> 3 has the idea that use of modifiers may differ between different
platforms, and has a <code>GdkModifierIntent</code> api to let platforms provide
hint about how modifiers are expected to be used. It also promoted
the use of <code>&lt;Primary&gt;</code> instead of <code>&lt;Control&gt;</code> to specify accelerators that
adapt to platform&nbsp;conventions.</p>
<p>In <span class="caps">GTK</span> 4, the meaning of modifiers has been fixed, and backends are
expected to map the platform conventions to the existing modifiers.
The expected use of modifiers in <span class="caps">GTK</span> 4&nbsp;is:</p>
<dl>
<dt><code>GDK_CONTROL_MASK</code></dt>
<dd>Primary&nbsp;accelerators</dd>
<dt><code>GDK_ALT_MASK</code></dt>
<dd>Mnemonics</dd>
<dt><code>GDK_SHIFT_MASK</code></dt>
<dd>Extending&nbsp;selections</dd>
<dt><code>GDK_CONTROL_MASK</code></dt>
<dd>Modifying&nbsp;selections</dd>
<dt><code>GDK_CONTROL_MASK|GDK_ALT_MASK</code></dt>
<dd>Prevent text&nbsp;input</dd>
</dl>
<p>Consequently, <code>GdkModifierIntent</code> and related APIs have been removed,
and <code>&lt;Control&gt;</code> is preferred over <code>&lt;Primary&gt;</code> in&nbsp;accelerators.</p>
<p>A related change is that <span class="caps">GTK</span> 4 no longer supports the use of archaic
X11 &#8216;real&#8217; modifiers with the names Mod1,&#8230;, Mod5, and <code>GDK_MOD1_MASK</code>
has been renamed to <code>GDK_ALT_MASK</code>.</p>
<h3 id="replace-gtkclipboard-with-gdkclipboard">Replace <code>GtkClipboard</code> with <code>GdkClipboard</code><a class="md-anchor" href="#replace-gtkclipboard-with-gdkclipboard" title="Permanent link"></a></h3>
<p>The <code>GtkClipboard</code> <span class="caps">API</span> has been removed, and replaced by <code>GdkClipboard</code>.
There is not direct 1:1 mapping between the old an the new <span class="caps">API</span>, so it cannot
be a mechanical replacement; the new <span class="caps">API</span> is based on object types and <code>GValue</code>
like object properties, instead of opaque identifiers, so it should be easier
to&nbsp;use.</p>
<p>For instance, the example below copies the contents of an entry into the&nbsp;clipboard:</p>
<div class="codehilite"><pre><span></span><code><span class="k">static</span> <span class="kt">void</span>
<span class="n">copy_text</span> <span class="p">(</span><span class="n">GtkWidget</span> <span class="o">*</span><span class="n">widget</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">GtkEditable</span> <span class="o">*</span><span class="n">editable</span> <span class="o">=</span> <span class="n">GTK_EDITABLE</span> <span class="p">(</span><span class="n">widget</span><span class="p">);</span>

  <span class="c1">// Initialize a GValue with the contents of the widget</span>
  <span class="n">GValue</span> <span class="n">value</span> <span class="o">=</span> <span class="n">G_VALUE_INIT</span><span class="p">;</span>
  <span class="n">g_value_init</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">value</span><span class="p">,</span> <span class="n">G_TYPE_STRING</span><span class="p">);</span>
  <span class="n">g_value_set_string</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">value</span><span class="p">,</span> <span class="n">gtk_editable_get_text</span> <span class="p">(</span><span class="n">editable</span><span class="p">));</span>

  <span class="c1">// Store the value in the clipboard object</span>
  <span class="n">GdkClipboard</span> <span class="o">*</span><span class="n">clipboard</span> <span class="o">=</span> <span class="n">gtk_widget_get_clipboard</span> <span class="p">(</span><span class="n">widget</span><span class="p">);</span>
  <span class="n">gdk_clipboard_set_value</span> <span class="p">(</span><span class="n">clipboard</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">value</span><span class="p">);</span>

  <span class="n">g_value_unset</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">value</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>whereas the example below pastes the contents into the&nbsp;entry:</p>
<div class="codehilite"><pre><span></span><code><span class="k">static</span> <span class="kt">void</span>
<span class="n">paste_text</span> <span class="p">(</span><span class="n">GtkWidget</span> <span class="o">*</span><span class="n">widget</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">GtkEditable</span> <span class="o">*</span><span class="n">editable</span> <span class="o">=</span> <span class="n">GTK_EDITABLE</span> <span class="p">(</span><span class="n">widget</span><span class="p">);</span>

  <span class="c1">// Initialize a GValue to receive text</span>
  <span class="n">GValue</span> <span class="n">value</span> <span class="o">=</span> <span class="n">G_VALUE_INIT</span><span class="p">;</span>
  <span class="n">g_value_init</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">value</span><span class="p">,</span> <span class="n">G_TYPE_STRING</span><span class="p">);</span>

  <span class="c1">// Get the content provider for the clipboard, and ask it for text</span>
  <span class="n">GdkClipboard</span> <span class="o">*</span><span class="n">clipboard</span> <span class="o">=</span> <span class="n">gtk_widget_get_clipboard</span> <span class="p">(</span><span class="n">widget</span><span class="p">);</span>
  <span class="n">GdkContentProvider</span> <span class="o">*</span><span class="n">provider</span> <span class="o">=</span> <span class="n">gdk_clipboard_get_content</span> <span class="p">(</span><span class="n">clipboard</span><span class="p">);</span>

  <span class="c1">// If the content provider does not contain text, we are not interested</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">gdk_content_provider_get_value</span> <span class="p">(</span><span class="n">provider</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">value</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">))</span>
    <span class="k">return</span><span class="p">;</span>

  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span> <span class="o">=</span> <span class="n">g_value_get_string</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">value</span><span class="p">);</span>

  <span class="n">gtk_editable_set_text</span> <span class="p">(</span><span class="n">editable</span><span class="p">,</span> <span class="n">str</span><span class="p">);</span>

  <span class="n">g_value_unset</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">value</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>The convenience <span class="caps">API</span> for specific target types in <code>GtkClipboard</code> has been
replaced by their corresponding&nbsp;GType:</p>
<table>
<thead>
<tr>
<th>GtkClipboard</th>
<th>GType</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>gtk_clipboard_request_text()</code></td>
<td><code>G_TYPE_STRING</code></td>
</tr>
<tr>
<td><code>gtk_clipboard_request_rich_text()</code></td>
<td><code>GTK_TYPE_TEXT_BUFFER</code></td>
</tr>
<tr>
<td><code>gtk_clipboard_request_image()</code></td>
<td><code>GDK_TYPE_PIXBUF</code></td>
</tr>
<tr>
<td><code>gtk_clipboard_request_uris()</code></td>
<td><code>GDK_TYPE_FILE_LIST</code></td>
</tr>
</tbody>
</table>
<p><strong>Note</strong>: Support for rich text serialization across different processes
for <code>GtkTextBuffer</code> is not available any&nbsp;more.</p>
<p>If you are copying the contents of an image, it is recommended to use
<code>GDK_TYPE_PAINTABLE</code> instead of <code>GDK_TYPE_PIXBUF</code>, to minimize the amount of
potential&nbsp;copies.</p>
<h3 id="stop-using-gtk_get_current_-apis">Stop using <code>gtk_get_current_...</code> APIs<a class="md-anchor" href="#stop-using-gtk_get_current_-apis" title="Permanent link"></a></h3>
<p>The function <code>gtk_get_current_event()</code> and its variants have been
replaced by equivalent event controller APIs:
<a href="method.EventController.get_current_event.html">gtk_event_controller_get_current_event()</a>,&nbsp;etc.</p>
<h3 id="convert-your-ui-files">Convert your UI files<a class="md-anchor" href="#convert-your-ui-files" title="Permanent link"></a></h3>
<p>A number of the changes outlined below affect <code>.ui</code> files. The
<code>gtk4-builder-tool simplify</code> command can perform many of the
necessary changes automatically, when called with the <code>--3to4</code>
option. You should always review the resulting&nbsp;changes.</p>
<p>The <code>&lt;requires&gt;</code> tag now supports for the <code>lib</code> attribute the
<code>gtk</code> value only, instead of the <code>gtk+</code> one&nbsp;previously.</p>
<h3 id="adapt-to-gtkbuilder-api-changes">Adapt to GtkBuilder API changes<a class="md-anchor" href="#adapt-to-gtkbuilder-api-changes" title="Permanent link"></a></h3>
<p><code>gtk_builder_connect_signals()</code> no longer exists. Instead, signals are
always connected automatically. If you need to add user data to your
signals, <a href="method.Builder.set_current_object.html">gtk_builder_set_current_object()</a> must be called. An important
caveat is that you have to do this before loading any <span class="caps">XML</span>. This means if
you need to use <a href="method.Builder.set_current_object.html">gtk_builder_set_current_object()</a>, you can no longer use
<a href="ctor.Builder.new_from_file.html">gtk_builder_new_from_file()</a>, <a href="ctor.Builder.new_from_resource.html">gtk_builder_new_from_resource()</a>, or
<a href="ctor.Builder.new_from_string.html">gtk_builder_new_from_string()</a>. Instead, you must use vanilla <a href="ctor.Builder.new.html">gtk_builder_new()</a>,
then call <a href="method.Builder.set_current_object.html">gtk_builder_set_current_object()</a>, then load the <span class="caps">XML</span> using
<a href="method.Builder.add_from_file.html">gtk_builder_add_from_file()</a>, <a href="method.Builder.add_from_resource.html">gtk_builder_add_from_resource()</a>, or
<a href="method.Builder.add_from_string.html">gtk_builder_add_from_string()</a>. You must check the return value for
failure and manually abort with <code>g_error()</code> if something went&nbsp;wrong.</p>
<p>You only have to worry about this if you were previously using
<code>gtk_builder_connect_signals()</code>. If you are using templates, then
<code>gtk_widget_init_template()</code> will call <code>gtk_builder_set_current_object()</code>
for you, so templates work like&nbsp;before.</p>
<h3 id="adapt-to-event-controller-api-changes">Adapt to event controller API changes<a class="md-anchor" href="#adapt-to-event-controller-api-changes" title="Permanent link"></a></h3>
<p>A few changes to the event controller and <a href="class.Gesture.html"><code>GtkGesture</code></a> APIs
did not make it back to <span class="caps">GTK</span> 3, and have to be taken into account
when moving to <span class="caps">GTK</span> 4. One is that the <a href="signal.EventControllerMotion.enter.html"><code>GtkEventControllerMotion::enter</code></a>
and <a href="signal.EventControllerMotion.leave.html"><code>GtkEventControllerMotion::leave</code></a> signals have gained new arguments.
Another is that <code>GtkGestureMultiPress</code> has been renamed to <a href="class.GestureClick.html"><code>GtkGestureClick</code></a>,
and has lost its area property. A <a href="class.EventControllerFocus.html"><code>GtkEventControllerFocus</code></a> has been
split off from <a href="class.EventControllerKey.html"><code>GtkEventControllerKey</code></a>.</p>
<p>In <span class="caps">GTK</span> 3, <code>GtkEventController:widget</code> was a construct-only property, so a
<code>GtkWidget</code> was provided whenever constructing a <code>GtkEventController</code>. In
<span class="caps">GTK</span> 4, <a href="property.EventController.widget.html"><code>GtkEventController:widget</code></a> is now read-only. Use
<a href="method.Widget.add_controller.html">gtk_widget_add_controller()</a> to add an event controller to a&nbsp;widget.</p>
<p>In <span class="caps">GTK</span> 3, widgets did not own their event controllers, and event
controllers did not own their widgets, so developers were responsible
for manually keeping event controllers alive for the lifetime of their
associated widgets. In <span class="caps">GTK</span> 4, widgets own their event controllers.
<a href="method.Widget.add_controller.html">gtk_widget_add_controller()</a> takes ownership of the event controller, so
there is no longer any need to store a reference to the event controller
after it has been added to a&nbsp;widget.</p>
<p>Although not normally needed, an event controller could be removed from
a widget in <span class="caps">GTK</span> 3 by destroying the event controller with <code>g_object_unref()</code>.
In <span class="caps">GTK</span> 4, you must use <a href="method.Widget.remove_controller.html">gtk_widget_remove_controller()</a>.</p>
<h3 id="focus-handling-changes">Focus handling changes<a class="md-anchor" href="#focus-handling-changes" title="Permanent link"></a></h3>
<p>The semantics of the <a href="property.Widget.can-focus.html"><code>GtkWidget:can-focus</code></a> property have changed.
In <span class="caps">GTK</span> 3, this property only meant that the widget itself would not
accept keyboard input, but its children still might (in the case of
containers). In <span class="caps">GTK</span> 4, if <code>:can-focus</code> is <code>FALSE</code>, the focus cannot enter
the widget or any of its descendents, and the default value has changed
from <code>FALSE</code> to <code>TRUE</code>. In addition, there is a <a href="property.Widget.focusable.html"><code>GtkWidget:focusable</code></a>
property, which controls whether an individual widget can receive
the input&nbsp;focus.</p>
<p>The <code>gtk4-builder-tool</code> utility, when called with the <code>--3to4</code> option of the
<code>simplify</code> command, will replace <code>:can-focus</code> by <code>:focusable</code>.</p>
<p>The feature to automatically keep the focus widget scrolled into view with
<code>gtk_container_set_focus_vadjustment()</code> has been removed together with
<code>GtkContainer</code>, and is provided by scrollable widgets instead. In the common
case that the scrollable is a <a href="class.Viewport.html"><code>GtkViewport</code></a>, use
<a href="property.Viewport.scroll-to-focus.html"><code>GtkViewport:scroll-to-focus</code></a>.</p>
<h3 id="use-the-new-apis-for-keyboard-shortcuts">Use the new apis for keyboard shortcuts<a class="md-anchor" href="#use-the-new-apis-for-keyboard-shortcuts" title="Permanent link"></a></h3>
<p>The APIs for keyboard shortcuts and accelerators have changed in <span class="caps">GTK</span>&nbsp;4.</p>
<p>Instead of <code>GtkAccelGroup</code>, you now use a <a href="class.ShortcutController.html"><code>GtkShortcutController</code></a> with global
scope, and instead of <code>GtkBindingSet</code>, you now use <a href="class_method.Widget.add_shortcut.html">gtk_widget_class_add_shortcut()</a>,
<a href="class_method.Widget.add_binding.html">gtk_widget_class_add_binding()</a> and its variants. In both cases, you probably
want to add actions that can be triggered by your&nbsp;shortcuts.</p>
<p>There is no direct replacement for loading and saving accelerators with
<code>GtkAccelMap</code>. But since <code>GtkShortcutController</code> implements <code>GListModel</code> and
both <a href="class.ShortcutTrigger.html"><code>GtkShortcutTrigger</code></a> and <a href="class.ShortcutAction.html"><code>GtkShortcutAction</code></a> can be
serialized to strings, it is relatively easy to implement saving and loading&nbsp;yourself.</p>
<h3 id="stop-using-gtkeventbox">Stop using <code>GtkEventBox</code><a class="md-anchor" href="#stop-using-gtkeventbox" title="Permanent link"></a></h3>
<p><code>GtkEventBox</code> is no longer needed and has been&nbsp;removed.</p>
<p>All widgets receive all&nbsp;events.</p>
<h3 id="stop-using-gtkbuttonbox">Stop using <code>GtkButtonBox</code><a class="md-anchor" href="#stop-using-gtkbuttonbox" title="Permanent link"></a></h3>
<p><code>GtkButtonBox</code> has been removed. Use a <a href="class.Box.html"><code>GtkBox</code></a>&nbsp;instead.</p>
<h3 id="adapt-to-gtkbox-api-changes">Adapt to <code>GtkBox</code> API changes<a class="md-anchor" href="#adapt-to-gtkbox-api-changes" title="Permanent link"></a></h3>
<p>The GtkBox <code>pack_start()</code> and <code>pack_end()</code> methods have been replaced by
<a href="method.Box.prepend.html">gtk_box_prepend()</a> and <a href="method.Box.append.html">gtk_box_append()</a>. You can also reorder
box children as&nbsp;necessary.</p>
<h3 id="adapt-to-gtkwindow-api-changes">Adapt to <code>GtkWindow</code> API changes<a class="md-anchor" href="#adapt-to-gtkwindow-api-changes" title="Permanent link"></a></h3>
<p>Following the <code>GdkSurface</code> changes, a number of <code>GtkWindow</code> APIs that were
X11-specific have been removed. This includes <code>gtk_window_set_geometry_hints()</code>,
<code>gtk_window_set_gravity()</code>, <code>gtk_window_move()</code>, <code>gtk_window_parse_geometry()</code>,
<code>gtk_window_set_keep_above()</code>, <code>gtk_window_set_keep_below()</code>,
<code>gtk_window_begin_resize_drag()</code>, <code>gtk_window_begin_move_drag()</code>.
Most likely, you should just stop using them. In some cases, you can
fall back to using the underlying <code>GdkToplevel</code> APIs (for example,
<a href="javascript:void(0)" data-namespace="Gdk" data-link="method.Toplevel.begin_resize.html" class="external">gdk_toplevel_begin_resize()</a>).</p>
<p>The APIs for controlling <code>GtkWindow</code> size have changed to be better aligned
with the way size changes are integrated in the frame cycle. <code>gtk_window_resize()</code>
and <code>gtk_window_get_size()</code> have been removed. Instead, use
<a href="method.Window.set_default_size.html">gtk_window_set_default_size()</a> and <a href="method.Window.get_default_size.html">gtk_window_get_default_size()</a>.</p>
<h3 id="adapt-to-gtkheaderbar-and-gtkactionbar-api-changes">Adapt to <code>GtkHeaderBar</code> and <code>GtkActionBar</code> API changes<a class="md-anchor" href="#adapt-to-gtkheaderbar-and-gtkactionbar-api-changes" title="Permanent link"></a></h3>
<p>The <code>gtk_header_bar_set_show_close_button()</code> function has been renamed to
the more accurate name <a href="method.HeaderBar.set_show_title_buttons.html">gtk_header_bar_set_show_title_buttons()</a>. The
corresponding getter and the property itself have also been renamed.
The default value of the property is now <code>TRUE</code> instead of <code>FALSE</code>.</p>
<p>The <code>gtk_header_bar_set_custom_title()</code> function has been renamed to
the more accurate name <a href="method.HeaderBar.set_title_widget.html">gtk_header_bar_set_title_widget()</a>. The
corresponding getter and the property itself have also been&nbsp;renamed.</p>
<p>The <code>gtk_header_bar_set_title()</code> function has been removed along with its
corresponding getter and the property. By default <a href="class.HeaderBar.html"><code>GtkHeaderBar</code></a>
shows the title of the window, so if you were setting the title of the
header bar, consider setting the window title instead. If you need to show a
title that&#8217;s different from the window title, use the
<a href="property.HeaderBar.title-widget.html"><code>GtkHeaderBar:title-widget</code></a> property to add a <a href="class.Label.html"><code>GtkLabel</code></a> as
shown in the example in the <a href="class.HeaderBar.html"><code>GtkHeaderBar</code></a>&nbsp;documentation.</p>
<p>The <code>gtk_header_bar_set_subtitle()</code> function has been removed along with
its corresponding getter and the property. The old &#8220;subtitle&#8221; behavior
can be replicated by setting the <a href="property.HeaderBar.title-widget.html"><code>GtkHeaderBar:title-widget</code></a> property to
a <a href="class.Box.html"><code>GtkBox</code></a> with two labels inside, with the title label matching the
example in <code>GtkHeaderBar</code> documentation, and the subtitle label being
similar, but with <code>"subtitle"</code> style class instead of <code>"title"</code>.</p>
<p>The <code>gtk_header_bar_set_has_subtitle()</code> function has been removed along with
its corresponding getter and the property. Its behavior can be replicated by
setting the <a href="property.HeaderBar.title-widget.html"><code>GtkHeaderBar:title-widget</code></a> property to a
<a href="class.Stack.html"><code>GtkStack</code></a> with <a href="property.Stack.vhomogeneous.html"><code>GtkStack:vhomogeneous</code></a> property set to
<code>TRUE</code> and two pages, each with a <a href="class.Box.html"><code>GtkBox</code></a> with title and subtitle as
described&nbsp;above.</p>
<p>Some of the internal structure of <code>GtkHeaderBar</code> has been made available as
public <span class="caps">API</span>: <a href="class.WindowHandle.html"><code>GtkWindowHandle</code></a> and <a href="class.WindowControls.html"><code>GtkWindowControls</code></a>. If you
have unusual needs for custom headerbars, these might be useful to&nbsp;you.</p>
<p>The <code>:pack-type</code> child properties of <code>GtkHeaderBar</code> and <code>GtkActionBar</code> have
been removed. If you need to programmatically place children, use the
<a href="method.HeaderBar.pack_start.html">gtk_header_bar_pack_start()</a> and <a href="method.HeaderBar.pack_end.html">gtk_header_bar_pack_end()</a> methods.
In <span class="caps">UI</span> files, use the <code>type</code> attribute on the <code>child</code> element.</p>
<p>The <code>gtk4-builder-tool</code> utility can help with this conversion, with the
<code>--3to4</code> option of the <code>simplify</code> command.</p>
<h3 id="adapt-to-gtkstack-gtkassistant-and-gtknotebook-api-changes">Adapt to GtkStack, GtkAssistant and GtkNotebook API changes<a class="md-anchor" href="#adapt-to-gtkstack-gtkassistant-and-gtknotebook-api-changes" title="Permanent link"></a></h3>
<p>The child properties of <code>GtkStack</code>, <code>GtkAssistant</code> and <code>GtkNotebook</code> have been
converted into child meta&nbsp;objects.</p>
<p>Instead of <code>gtk_container_child_set (stack, child, )</code>, you can now use
<code>g_object_set (gtk_stack_get_page (stack, child), )</code>. In .ui files, the
<code>GtkStackPage</code> objects must be created explicitly, and take the child widget
as property. The changes to <code>GtkNotebook</code> and <code>GtkAssistant</code> are&nbsp;similar.</p>
<p><code>gtk4-builder-tool</code> can help with this conversion, with the <code>--3to4</code> option
of the <code>simplify</code> command.</p>
<h3 id="adapt-to-button-class-hierarchy-changes">Adapt to button class hierarchy changes<a class="md-anchor" href="#adapt-to-button-class-hierarchy-changes" title="Permanent link"></a></h3>
<p><code>GtkCheckButton</code> is no longer derived from <code>GtkToggleButton</code>. Call
<a href="method.CheckButton.set_active.html">gtk_check_button_set_active()</a> instead of <a href="method.ToggleButton.set_active.html">gtk_toggle_button_set_active()</a>.</p>
<p><code>GtkRadioButton</code> has been removed, and its grouping functionality has
been added to <code>GtkCheckButton</code> and <code>GtkToggleButton</code>. Use grouped
check buttons for traditional radio groups, and used grouped toggle
buttons for view switchers. The new <span class="caps">API</span> to set up groups of buttons
is <a href="method.CheckButton.set_group.html">gtk_check_button_set_group()</a> and <a href="method.ToggleButton.set_group.html">gtk_toggle_button_set_group()</a>.</p>
<p><code>gtk4-builder-tool</code> can help with this conversion, with the <code>--3to4</code> option
of the <code>simplify</code> command.</p>
<h3 id="adapt-to-gtkscrolledwindow-api-changes">Adapt to GtkScrolledWindow API changes<a class="md-anchor" href="#adapt-to-gtkscrolledwindow-api-changes" title="Permanent link"></a></h3>
<p>The constructor for <code>GtkScrolledWindow</code> no longer takes the adjustments
as arguments - these were almost always <code>NULL</code>.</p>
<h3 id="adapt-to-gtkbin-removal">Adapt to GtkBin removal<a class="md-anchor" href="#adapt-to-gtkbin-removal" title="Permanent link"></a></h3>
<p>The abstract base class <code>GtkBin</code> for single-child containers has been
removed. The former subclasses are now derived directly from <code>GtkWidget</code>,
and have a &#8220;child&#8221; property for their child widget. To add a child, use
the setter for the &#8220;child&#8221; property (e.g. <a href="method.Frame.set_child.html">gtk_frame_set_child()</a>) instead
of <code>gtk_container_add()</code>. Adding a child in a ui file with <code>&lt;child&gt;</code> still&nbsp;works.</p>
<p>The affected classes&nbsp;are:</p>
<ul>
<li><a href="class.AspectFrame.html"><code>GtkAspectFrame</code></a></li>
<li><a href="class.Button.html"><code>GtkButton</code></a> (and&nbsp;subclasses)</li>
<li><a href="class.ComboBox.html"><code>GtkComboBox</code></a></li>
<li><a href="class.FlowBoxChild.html"><code>GtkFlowBoxChild</code></a></li>
<li><a href="class.Frame.html"><code>GtkFrame</code></a></li>
<li><a href="class.ListBoxRow.html"><code>GtkListBoxRow</code></a></li>
<li><a href="class.Overlay.html"><code>GtkOverlay</code></a></li>
<li><a href="class.Popover.html"><code>GtkPopover</code></a></li>
<li><a href="class.Revealer.html"><code>GtkRevealer</code></a></li>
<li><a href="class.ScrolledWindow.html"><code>GtkScrolledWindow</code></a></li>
<li><a href="class.SearchBar.html"><code>GtkSearchBar</code></a></li>
<li><a href="class.Viewport.html"><code>GtkViewport</code></a></li>
<li><a href="class.Window.html"><code>GtkWindow</code></a> (and&nbsp;subclasses)</li>
</ul>
<p>If you have custom widgets that were derived from <code>GtkBin</code>, you should
port them to derive from <code>GtkWidget</code>. Notable vfuncs that you will have
to implement include the <code>GObject</code> dispose vfunc (to unparent your child),
<a href="vfunc.Widget.compute_expand.html"><code>Gtk.WidgetClass.compute_expand</code></a> (if you want your container to propagate
expand flags) and <a href="vfunc.Widget.get_request_mode.html"><code>Gtk.WidgetClass.get_request_mode</code></a> (if you want your
container to support&nbsp;height-for-width).</p>
<p>You may also want to implement the <a href="iface.Buildable.html"><code>GtkBuildable</code></a> interface, to support
adding children with <code>&lt;child&gt;</code> in ui&nbsp;files.</p>
<h3 id="adapt-to-gtkcontainer-removal">Adapt to GtkContainer removal<a class="md-anchor" href="#adapt-to-gtkcontainer-removal" title="Permanent link"></a></h3>
<p>The abstract base class <code>GtkContainer</code> for general containers has been
removed. The former subclasses are now derived directly from <code>GtkWidget</code>,
and have class-specific add() and remove()&nbsp;functions.</p>
<p>The most noticeable change is the use of <a href="method.Box.append.html">gtk_box_append()</a> or <a href="method.Box.prepend.html">gtk_box_prepend()</a>
instead of <code>gtk_container_add()</code> for adding children to <code>GtkBox</code>, and the change
to use container-specific remove functions, such as <a href="method.Stack.remove.html">gtk_stack_remove()</a> instead
of <code>gtk_container_remove()</code>. Adding a child in a ui file with <code>&lt;child&gt;</code> still&nbsp;works.</p>
<p>The affected classes&nbsp;are:</p>
<ul>
<li><a href="class.ActionBar.html"><code>GtkActionBar</code></a></li>
<li><a href="class.Box.html"><code>GtkBox</code></a> (and&nbsp;subclasses)</li>
<li><a href="class.Expander.html"><code>GtkExpander</code></a></li>
<li><a href="class.Fixed.html"><code>GtkFixed</code></a></li>
<li><a href="class.FlowBox.html"><code>GtkFlowBox</code></a></li>
<li><a href="class.Grid.html"><code>GtkGrid</code></a></li>
<li><a href="class.HeaderBar.html"><code>GtkHeaderBar</code></a></li>
<li><a href="class.IconView.html"><code>GtkIconView</code></a></li>
<li><a href="class.InfoBar.html"><code>GtkInfoBar</code></a></li>
<li><a href="class.ListBox.html"><code>GtkListBox</code></a></li>
<li><a href="class.Notebook.html"><code>GtkNotebook</code></a></li>
<li><a href="class.Paned.html"><code>GtkPaned</code></a></li>
<li><a href="class.Stack.html"><code>GtkStack</code></a></li>
<li><a href="class.TextView.html"><code>GtkTextView</code></a></li>
<li><a href="class.TreeView.html"><code>GtkTreeView</code></a></li>
</ul>
<p>Without <code>GtkContainer</code>, there are no longer facilities for defining and
using child properties. If you have custom widgets using child properties,
they will have to be converted either to layout properties provided
by a layout manager (if they are layout-related), or handled in some
other way. One possibility is to use child meta objects, as seen with
<a href="class.AssistantPage.html"><code>GtkAssistantPage</code></a>, <a href="class.StackPage.html"><code>GtkStackPage</code></a> and the&nbsp;like.</p>
<p>If you used to define child properties with <code>&lt;packing&gt;</code> in ui files, you have
to switch to using <code>&lt;layout&gt;</code> for the corresponding layout properties.
<code>gtk4-builder-tool</code> can help with this conversion, with the <code>--3to4</code> option
of the <code>simplify</code> command.</p>
<p>The replacements for gtk_container_add()&nbsp;are:</p>
<table>
<thead>
<tr>
<th>Widget</th>
<th>Replacement</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>GtkActionBar</code></td>
<td><a href="method.ActionBar.pack_start.html">gtk_action_bar_pack_start()</a>, <a href="method.ActionBar.pack_end.html">gtk_action_bar_pack_end()</a></td>
</tr>
<tr>
<td><code>GtkBox</code></td>
<td><a href="method.Box.prepend.html">gtk_box_prepend()</a>, <a href="method.Box.append.html">gtk_box_append()</a></td>
</tr>
<tr>
<td><code>GtkExpander</code></td>
<td><a href="method.Expander.set_child.html">gtk_expander_set_child()</a></td>
</tr>
<tr>
<td><code>GtkFixed</code></td>
<td><a href="method.Fixed.put.html">gtk_fixed_put()</a></td>
</tr>
<tr>
<td><code>GtkFlowBox</code></td>
<td><a href="method.FlowBox.insert.html">gtk_flow_box_insert()</a></td>
</tr>
<tr>
<td><code>GtkGrid</code></td>
<td><a href="method.Grid.attach.html">gtk_grid_attach()</a></td>
</tr>
<tr>
<td><code>GtkHeaderBar</code></td>
<td><a href="method.HeaderBar.pack_start.html">gtk_header_bar_pack_start()</a>, <a href="method.HeaderBar.pack_end.html">gtk_header_bar_pack_end()</a></td>
</tr>
<tr>
<td><code>GtkIconView</code></td>
<td>-</td>
</tr>
<tr>
<td><code>GtkInfoBar</code></td>
<td><a href="method.InfoBar.add_child.html">gtk_info_bar_add_child()</a></td>
</tr>
<tr>
<td><code>GtkListBox</code></td>
<td><a href="method.ListBox.insert.html">gtk_list_box_insert()</a></td>
</tr>
<tr>
<td><code>GtkNotebook</code></td>
<td><a href="method.Notebook.append_page.html">gtk_notebook_append_page()</a></td>
</tr>
<tr>
<td><code>GtkPaned</code></td>
<td><a href="method.Paned.set_start_child.html">gtk_paned_set_start_child()</a>, <a href="method.Paned.set_end_child.html">gtk_paned_set_end_child()</a></td>
</tr>
<tr>
<td><code>GtkStack</code></td>
<td><a href="method.Stack.add_child.html">gtk_stack_add_child()</a></td>
</tr>
<tr>
<td><code>GtkTextView</code></td>
<td><a href="method.TextView.add_child_at_anchor.html">gtk_text_view_add_child_at_anchor()</a>, <a href="method.TextView.add_overlay.html">gtk_text_view_add_overlay()</a></td>
</tr>
<tr>
<td><code>GtkTreeView</code></td>
<td>-</td>
</tr>
</tbody>
</table>
<h3 id="stop-using-gtkcontainerborder-width">Stop using GtkContainer::border-width<a class="md-anchor" href="#stop-using-gtkcontainerborder-width" title="Permanent link"></a></h3>
<p><span class="caps">GTK</span> 4 has removed the <code>GtkContainer::border-width</code> property (together
with the rest of <code>GtkContainer</code>). Use other means to influence the spacing
of your containers, such as the <span class="caps">CSS</span> margin and padding properties on child
widgets, or the <span class="caps">CSS</span> border-spacing property on&nbsp;containers.</p>
<h3 id="adapt-to-gtk_widget_destroy-removal">Adapt to gtk_widget_destroy() removal<a class="md-anchor" href="#adapt-to-gtk_widget_destroy-removal" title="Permanent link"></a></h3>
<p>The function <code>gtk_widget_destroy()</code> has been removed. To explicitly destroy
a toplevel window, use <a href="method.Window.destroy.html">gtk_window_destroy()</a>. To destroy a widget that is
part of a hierarchy, remove it from its parent using a container-specific
remove <span class="caps">API</span>, such as <a href="method.Box.remove.html">gtk_box_remove()</a> or <a href="method.Stack.remove.html">gtk_stack_remove()</a>. To
destroy a freestanding non-toplevel widget, use <code>g_object_unref()</code> to drop your&nbsp;reference.</p>
<h3 id="adapt-to-coordinate-api-changes_1">Adapt to coordinate API changes<a class="md-anchor" href="#adapt-to-coordinate-api-changes_1" title="Permanent link"></a></h3>
<p>A number of APIs that are accepting or returning coordinates have
been changed from ints to doubles: <code>gtk_widget_translate_coordinates()</code>,
<code>gtk_fixed_put()</code>, <code>gtk_fixed_move()</code>. This change is mostly transparent,
except for cases where out parameters are involved: you need to
pass double<em> now, instead of int</em>.</p>
<h3 id="adapt-to-gtkstylecontext-api-changes">Adapt to GtkStyleContext API changes<a class="md-anchor" href="#adapt-to-gtkstylecontext-api-changes" title="Permanent link"></a></h3>
<p>The getters in the GtkStyleContext <span class="caps">API</span>, such as
<a href="method.StyleContext.get_color.html">gtk_style_context_get_color()</a>, <a href="method.StyleContext.get_border.html">gtk_style_context_get_border()</a>,
or <a href="method.StyleContext.get_margin.html">gtk_style_context_get_margin()</a> have lost their state argument,
and always use the context&#8217;s current state. Update all callers
to omit the state&nbsp;argument.</p>
<p>The most commonly used GtkStyleContext <span class="caps">API</span>, <code>gtk_style_context_add_class()</code>,
has been moved to GtkWidget as <a href="method.Widget.add_css_class.html">gtk_widget_add_css_class()</a>, as have the
corresponding <code>gtk_style_context_remove_class()</code> and
<code>gtk_style_context_has_class()</code> APIs.</p>
<h3 id="adapt-to-gtkcssprovider-api-changes">Adapt to GtkCssProvider API changes<a class="md-anchor" href="#adapt-to-gtkcssprovider-api-changes" title="Permanent link"></a></h3>
<p>In <span class="caps">GTK</span> 4, the various <code>GtkCssProvider</code> load functions have lost their
<code>GError</code> argument. If you want to handle <span class="caps">CSS</span> loading errors, use the
<a href="signal.CssProvider.parsing-error.html"><code>GtkCssProvider::parsing-error</code></a> signal instead. gtk_css_provider_get_named()
has been replaced by <a href="method.CssProvider.load_named.html">gtk_css_provider_load_named()</a>.</p>
<h3 id="stop-using-gtkshadowtype-and-gtkrelief-properties">Stop using GtkShadowType and GtkRelief properties<a class="md-anchor" href="#stop-using-gtkshadowtype-and-gtkrelief-properties" title="Permanent link"></a></h3>
<p>The shadow-type properties in <code>GtkScrolledWindow</code>, <code>GtkViewport</code>,
and <code>GtkFrame</code>, as well as the relief properties in <code>GtkButton</code>
and its subclasses have been removed. <code>GtkScrolledWindow</code>, <code>GtkButton</code>
and <code>GtkMenuButton</code> have instead gained a boolean has-frame&nbsp;property.</p>
<h3 id="adapt-to-gtkwidgets-size-request-changes">Adapt to GtkWidget's size request changes<a class="md-anchor" href="#adapt-to-gtkwidgets-size-request-changes" title="Permanent link"></a></h3>
<p><span class="caps">GTK</span> 3 used five different virtual functions in GtkWidget to
implement size requisition, namely the <code>gtk_widget_get_preferred_width()</code>
family of functions. To simplify widget implementations, <span class="caps">GTK</span> 4 uses
only one virtual function, <a href="vfunc.Widget.measure.html"><code>Gtk.WidgetClass.measure</code></a>, that widgets
have to implement. <a href="method.Widget.measure.html">gtk_widget_measure()</a> replaces the various
<code>gtk_widget_get_preferred_</code> functions for querying&nbsp;sizes.</p>
<h3 id="adapt-to-gtkwidgets-size-allocation-changes">Adapt to GtkWidget's size allocation changes<a class="md-anchor" href="#adapt-to-gtkwidgets-size-allocation-changes" title="Permanent link"></a></h3>
<p>The <a href="vfunc.Widget.size_allocate.html"><code>Gtk.WidgetClass.size_allocate</code></a> vfunc takes the baseline as an argument
now, so you no longer need to call <code>gtk_widget_get_allocated_baseline()</code>
to get&nbsp;it.</p>
<p>The ::size-allocate signal has been removed, since it is easy
to misuse. If you need to learn about sizing changes of custom
drawing widgets, use the <a href="signal.DrawingArea.resize.html"><code>GtkDrawingArea::resize</code></a> or
<a href="signal.GLArea.resize.html"><code>GtkGLArea::resize</code></a> signals. If you want to track the size
of toplevel windows, use property notification for
<a href="property.Window.default-width.html"><code>GtkWindow:default-width</code></a> and <a href="property.Window.default-height.html"><code>GtkWindow:default-height</code></a>.</p>
<h3 id="switch-to-gtkwidgets-children-apis">Switch to GtkWidget's children APIs<a class="md-anchor" href="#switch-to-gtkwidgets-children-apis" title="Permanent link"></a></h3>
<p>In <span class="caps">GTK</span> 4, any widget can have children (and <code>GtkContainer</code> is gone).
There is new <span class="caps">API</span> to navigate the widget tree, for use in widget
implementations:
<a href="method.Widget.get_first_child.html">gtk_widget_get_first_child()</a>,
<a href="method.Widget.get_last_child.html">gtk_widget_get_last_child()</a>,
<a href="method.Widget.get_next_sibling.html">gtk_widget_get_next_sibling()</a>,
<a href="method.Widget.get_prev_sibling.html">gtk_widget_get_prev_sibling()</a>.</p>
<h3 id="dont-use-gtk-gradient-in-your-css">Don't use -gtk-gradient in your CSS<a class="md-anchor" href="#dont-use-gtk-gradient-in-your-css" title="Permanent link"></a></h3>
<p><span class="caps">GTK</span> now supports standard <span class="caps">CSS</span> syntax for both linear and radial
gradients, just use&nbsp;those.</p>
<h3 id="dont-use-gtk-icon-effect-in-your-css">Don't use -gtk-icon-effect in your CSS<a class="md-anchor" href="#dont-use-gtk-icon-effect-in-your-css" title="Permanent link"></a></h3>
<p><span class="caps">GTK</span> now supports a more versatile -gtk-icon-filter&nbsp;instead.</p>
<p>Replace</p>
<table>
<thead>
<tr>
<th>Old</th>
<th>Replacement</th>
</tr>
</thead>
<tbody>
<tr>
<td>-gtk-icon-effect: dim</td>
<td>-gtk-icon-filter: opacity(0.5)</td>
</tr>
<tr>
<td>-gtk-icon-effect: highlight</td>
<td>-gtk-icon-filter: brightness(1.2)</td>
</tr>
</tbody>
</table>
<h3 id="dont-use-gtk-icon-theme-in-your-css">Don't use -gtk-icon-theme in your CSS<a class="md-anchor" href="#dont-use-gtk-icon-theme-in-your-css" title="Permanent link"></a></h3>
<p><span class="caps">GTK</span> 4 always uses the current icon theme, with no way to change&nbsp;this.</p>
<h3 id="dont-use-gtk-outline-radius-in-your-css">Don't use -gtk-outline-...-radius in your CSS<a class="md-anchor" href="#dont-use-gtk-outline-radius-in-your-css" title="Permanent link"></a></h3>
<p>These non-standard properties have been removed from <span class="caps">GTK</span>
<span class="caps">CSS</span>. Just use regular border&nbsp;radius.</p>
<h3 id="adapt-to-drawing-model-changes">Adapt to drawing model changes<a class="md-anchor" href="#adapt-to-drawing-model-changes" title="Permanent link"></a></h3>
<p>This area has seen the most radical changes in the transition from <span class="caps">GTK</span> 3
to <span class="caps">GTK</span> 4. Widgets no longer use a draw() function to render their contents
to a cairo surface. Instead, they have a <a href="vfunc.Widget.snapshot.html"><code>Gtk.WidgetClass.snapshot</code></a> function
that creates one or more GskRenderNodes to represent their content. Third-party
widgets that use a draw() function or a <code>GtkWidget::draw</code> signal handler for
custom drawing will need to be converted to use <a href="method.Snapshot.append_cairo.html">gtk_snapshot_append_cairo()</a>.</p>
<p>The auxiliary <a href="class.Snapshot.html"><code>GtkSnapshot</code></a> object has APIs to help with creating render&nbsp;nodes.</p>
<p>If you are using a <code>GtkDrawingArea</code> for custom drawing, you need to switch
to using <a href="method.DrawingArea.set_draw_func.html">gtk_drawing_area_set_draw_func()</a> to set a draw function instead
of connecting a handler to the <code>GtkWidget::draw</code> signal.</p>
<h3 id="stop-using-apis-to-query-gdksurfaces">Stop using APIs to query GdkSurfaces<a class="md-anchor" href="#stop-using-apis-to-query-gdksurfaces" title="Permanent link"></a></h3>
<p>A number of APIs for querying special-purpose windows have been removed,
since these windows no longer exist:
<code>gtk_tree_view_get_bin_window()</code>, <code>gtk_viewport_get_bin_window()</code>,
<code>gtk_viewport_get_view_window()</code>.</p>
<h3 id="widgets-are-now-visible-by-default">Widgets are now visible by default<a class="md-anchor" href="#widgets-are-now-visible-by-default" title="Permanent link"></a></h3>
<p>The default value of <a href="property.Widget.visible.html"><code>GtkWidget:visible</code></a> in <span class="caps">GTK</span> 4 is <code>TRUE</code>, so you no
longer need to explicitly show all your widgets. On the flip side, you
need to hide widgets that are not meant to be visible from the start.
The only widgets that still need to be explicitly shown are toplevel
windows, dialogs and&nbsp;popovers.</p>
<p>A convenient way to remove unnecessary property assignments like this
from ui files it run the command <code>gtk4-builder-tool simplify --replace</code>
on&nbsp;them.</p>
<p>The function <code>gtk_widget_show_all()</code>, the <code>GtkWidget:no-show-all</code> property
and its getter and setter have been removed in <span class="caps">GTK</span> 4, so you should stop
using&nbsp;them.</p>
<h3 id="adapt-to-changes-in-animated-hiding-and-showing-of-widgets">Adapt to changes in animated hiding and showing of widgets<a class="md-anchor" href="#adapt-to-changes-in-animated-hiding-and-showing-of-widgets" title="Permanent link"></a></h3>
<p>Widgets that appear and disappear with an animation, such as
<code>GtkInfoBar</code>, <code>GtkRevealer</code> no longer use <code>gtk_widget_show()</code> and
<code>gtk_widget_hide()</code> for this, but have gained dedicated APIs for this
purpose that you should use instead, such as <a href="method.InfoBar.set_revealed.html">gtk_info_bar_set_revealed()</a>.</p>
<h3 id="stop-passing-commandline-arguments-to-gtk_init">Stop passing commandline arguments to gtk_init<a class="md-anchor" href="#stop-passing-commandline-arguments-to-gtk_init" title="Permanent link"></a></h3>
<p>The <a href="func.init.html">gtk_init()</a> and <a href="func.init_check.html">gtk_init_check()</a> functions no longer accept
commandline arguments. Just call them without arguments. Other initialization
functions that were purely related to commandline argument handling, such as
<code>gtk_parse_args()</code> and <code>gtk_get_option_group()</code>, are&nbsp;gone.</p>
<p>The APIs to initialize <span class="caps">GDK</span> separately are also gone, but it is very unlikely
that you are affected by&nbsp;that.</p>
<h3 id="gdkpixbuf-is-deemphasized">GdkPixbuf is deemphasized<a class="md-anchor" href="#gdkpixbuf-is-deemphasized" title="Permanent link"></a></h3>
<p>A number of <code>GdkPixbuf</code>-based APIs have been removed. The available replacements
are either using <code>GIcon</code>, or the newly introduced <a href="javascript:void(0)" data-namespace="Gdk" data-link="class.Texture.html" class="external"><code>GdkTexture</code></a> or
<a href="javascript:void(0)" data-namespace="Gdk" data-link="iface.Paintable.html" class="external"><code>GdkPaintable</code></a> classes instead. If you are dealing with pixbufs, you can use
<a href="javascript:void(0)" data-namespace="Gdk" data-link="ctor.Texture.new_for_pixbuf.html" class="external">gdk_texture_new_for_pixbuf()</a> to convert them to texture objects where&nbsp;needed.</p>
<h3 id="gtkwidget-event-signals-are-removed">GtkWidget event signals are removed<a class="md-anchor" href="#gtkwidget-event-signals-are-removed" title="Permanent link"></a></h3>
<p>Event controllers and GtkGestures have already been introduced in <span class="caps">GTK</span> 3 to handle
input for many cases. In <span class="caps">GTK</span> 4, the traditional widget signals for handling input,
such as <code>GtkWidget::motion-event</code> or <code>GtkWidget::event</code> have been removed. All event
handling is done via event controllers&nbsp;now.</p>
<h3 id="invalidation-handling-has-changed">Invalidation handling has changed<a class="md-anchor" href="#invalidation-handling-has-changed" title="Permanent link"></a></h3>
<p>Only <a href="method.Widget.queue_draw.html">gtk_widget_queue_draw()</a> is left to mark a widget as needing redraw.
Variations like <code>gtk_widget_queue_draw_rectangle()</code> or <code>gtk_widget_queue_draw_region()</code>
are no longer&nbsp;available.</p>
<h3 id="stop-using-gtkwidgetdraw">Stop using GtkWidget::draw<a class="md-anchor" href="#stop-using-gtkwidgetdraw" title="Permanent link"></a></h3>
<p>The <code>GtkWidget::draw</code> signal has been removed. Widgets need to implement the
<a href="vfunc.Widget.snapshot.html"><code>Gtk.WidgetClass.snapshot</code></a> function now. Connecting draw signal handlers is
no longer possible. If you want to keep using cairo for drawing, use
<a href="method.Snapshot.append_cairo.html">gtk_snapshot_append_cairo()</a>.</p>
<h3 id="window-content-observation-has-changed">Window content observation has changed<a class="md-anchor" href="#window-content-observation-has-changed" title="Permanent link"></a></h3>
<p>Observing widget contents and widget size is now done by using the
<a href="class.WidgetPaintable.html"><code>GtkWidgetPaintable</code></a> object instead of connecting to widget&nbsp;signals.</p>
<h3 id="monitor-handling-has-changed">Monitor handling has changed<a class="md-anchor" href="#monitor-handling-has-changed" title="Permanent link"></a></h3>
<p>Instead of a monitor number, <a href="javascript:void(0)" data-namespace="Gdk" data-link="class.Monitor.html" class="external"><code>GdkMonitor</code></a> is now used throughout. 
<a href="javascript:void(0)" data-namespace="Gdk" data-link="method.Display.get_monitors.html" class="external">gdk_display_get_monitors()</a> returns the list of monitors that can be queried
or observed for monitors to pass to APIs like <a href="method.Window.fullscreen_on_monitor.html">gtk_window_fullscreen_on_monitor()</a>.</p>
<h3 id="adapt-to-monitor-api-changes">Adapt to monitor API changes<a class="md-anchor" href="#adapt-to-monitor-api-changes" title="Permanent link"></a></h3>
<p>The <code>gdk_monitor_get_workarea()</code> <span class="caps">API</span> is gone. Individual backends can still
provide this information, for example with&nbsp;GdkX11.Monitor.get_workarea.</p>
<p>If you use this information, your code should check which backend is in
use and then call the appropriate backend <span class="caps">API</span>.</p>
<h3 id="adapt-to-cursor-api-changes">Adapt to cursor API changes<a class="md-anchor" href="#adapt-to-cursor-api-changes" title="Permanent link"></a></h3>
<p>Use the new <a href="method.Widget.set_cursor.html">gtk_widget_set_cursor()</a> function to set cursors, instead of
setting the cursor on the underlying window directly. This is necessary
because most widgets don&#8217;t have their own window anymore, turning any
such calls into global cursor&nbsp;changes.</p>
<p>For creating standard cursors, <code>gdk_cursor_new_for_display()</code> has been removed,
you have to use cursor names instead of <code>GdkCursorType</code>. For creating custom cursors,
use <a href="javascript:void(0)" data-namespace="Gdk" data-link="ctor.Cursor.new_from_texture.html" class="external">gdk_cursor_new_from_texture()</a>. The ability to get cursor images has been&nbsp;removed.</p>
<h3 id="adapt-to-icon-size-api-changes">Adapt to icon size API changes<a class="md-anchor" href="#adapt-to-icon-size-api-changes" title="Permanent link"></a></h3>
<p>Instead of the existing extensible set of symbolic icon sizes, <span class="caps">GTK</span> now only
supports normal and large icons with the <a href="enum.IconSize.html"><code>GtkIconSize</code></a> enumeration. The actual sizes
can be defined by themes via the <span class="caps">CSS</span> property&nbsp;-gtk-icon-size.</p>
<p>GtkImage setters like <a href="method.Image.set_from_icon_name.html">gtk_image_set_from_icon_name()</a> no longer take a <code>GtkIconSize</code>
argument. You can use the separate <a href="method.Image.set_icon_size.html">gtk_image_set_icon_size()</a> setter if you need
to override the icon&nbsp;size.</p>
<p>The :stock-size property of GtkCellRendererPixbuf has been renamed to
<a href="property.CellRendererPixbuf.icon-size.html"><code>GtkCellRendererPixbuf:icon-size</code></a>.</p>
<h3 id="adapt-to-changes-in-the-gtkassistant-api">Adapt to changes in the GtkAssistant API<a class="md-anchor" href="#adapt-to-changes-in-the-gtkassistant-api" title="Permanent link"></a></h3>
<p>The :has-padding property is gone, and <code>GtkAssistant</code> no longer adds padding
to pages. You can easily do that&nbsp;yourself.</p>
<h3 id="adapt-to-changes-in-the-api-of-gtkentry-gtksearchentry-and-gtkspinbutton">Adapt to changes in the API of GtkEntry, GtkSearchEntry and GtkSpinButton<a class="md-anchor" href="#adapt-to-changes-in-the-api-of-gtkentry-gtksearchentry-and-gtkspinbutton" title="Permanent link"></a></h3>
<p>The <a href="iface.Editable.html"><code>GtkEditable</code></a> interface has been made more useful, and the core functionality of
<code>GtkEntry</code> has been broken out as a <a href="class.Text.html"><code>GtkText</code></a> widget.
<a href="class.Entry.html"><code>GtkEntry</code></a>,
<a href="class.SearchEntry.html"><code>GtkSearchEntry</code></a>,
<a href="class.SpinButton.html"><code>GtkSpinButton</code></a> and the new
<a href="class.PasswordEntry.html"><code>GtkPasswordEntry</code></a> now use a <a href="class.Text.html"><code>GtkText</code></a> widget internally
and implement <a href="iface.Editable.html"><code>GtkEditable</code></a>. In particular, this means that it is no longer
possible to use <code>GtkEntry</code> <span class="caps">API</span> such as <code>gtk_entry_grab_focus_without_selecting()</code>
on a search&nbsp;entry.</p>
<p>Use <code>GtkEditable</code> <span class="caps">API</span> for editable functionality, and widget-specific APIs for
things that go beyond the common interface. For password entries, use
<a href="class.PasswordEntry.html"><code>GtkPasswordEntry</code></a>. As an example, <code>gtk_spin_button_set_max_width_chars()</code>
has been removed in favor of <a href="method.Editable.set_max_width_chars.html">gtk_editable_set_max_width_chars()</a>.</p>
<h3 id="adapt-to-changes-in-gtkoverlay-api">Adapt to changes in GtkOverlay API<a class="md-anchor" href="#adapt-to-changes-in-gtkoverlay-api" title="Permanent link"></a></h3>
<p>The GtkOverlay :pass-through child property has been replaced by the
<a href="property.Widget.can-target.html"><code>GtkWidget:can-target</code></a> property. Note that they have the opposite sense:
pass-through ==&nbsp;!can-target.</p>
<h3 id="use-gtkfixed-instead-of-gtklayout">Use GtkFixed instead of GtkLayout<a class="md-anchor" href="#use-gtkfixed-instead-of-gtklayout" title="Permanent link"></a></h3>
<p>Since <code>GtkScrolledWindow</code> can deal with widgets that do not implement
the <code>GtkScrollable</code> interface by automatically wrapping them into a
<code>GtkViewport</code>, <code>GtkLayout</code> is redundant, and has been removed in favor
of the existing <a href="class.Fixed.html"><code>GtkFixed</code></a>&nbsp;widget.</p>
<h3 id="adapt-to-search-entry-changes">Adapt to search entry changes<a class="md-anchor" href="#adapt-to-search-entry-changes" title="Permanent link"></a></h3>
<p>The way search entries are connected to global events has changed;
<code>gtk_search_entry_handle_event()</code> has been dropped and replaced by
<a href="method.SearchEntry.set_key_capture_widget.html">gtk_search_entry_set_key_capture_widget()</a> and
<a href="method.EventControllerKey.forward.html">gtk_event_controller_key_forward()</a>.</p>
<h3 id="adapt-to-gtkscale-changes">Adapt to GtkScale changes<a class="md-anchor" href="#adapt-to-gtkscale-changes" title="Permanent link"></a></h3>
<p>The default value of <code>GtkScale:draw-value</code> has been changed to <code>FALSE</code>.
If you want your scales to draw values, you will have to set this
property explicitly&nbsp;now.</p>
<p><code>gtk4-builder-tool</code> can help with this conversion, with the <code>--3to4</code> option
of the <code>simplify</code> command.</p>
<h3 id="stop-using-gtk_window_activate_default">Stop using gtk_window_activate_default()<a class="md-anchor" href="#stop-using-gtk_window_activate_default" title="Permanent link"></a></h3>
<p>The handling of default widgets has been changed, and activating
the default now works by calling <a href="method.Widget.activate_default.html">gtk_widget_activate_default()</a>
on the widget that caused the activation. If you have a custom widget
that wants to override the default handling, you can provide an
implementation of the &#8220;default.activate&#8221; action in your widgets&#8217; action&nbsp;groups.</p>
<h3 id="stop-using-gtk_widget_grab_default">Stop using gtk_widget_grab_default()<a class="md-anchor" href="#stop-using-gtk_widget_grab_default" title="Permanent link"></a></h3>
<p>The function <code>gtk_widget_grab_default()</code> has been removed. If you need
to mark a widget as default, use <a href="method.Window.set_default_widget.html">gtk_window_set_default_widget()</a>&nbsp;directly.</p>
<h3 id="stop-setting-has-default-and-has-focus-in-ui-files">Stop setting ::has-default and ::has-focus in .ui files<a class="md-anchor" href="#stop-setting-has-default-and-has-focus-in-ui-files" title="Permanent link"></a></h3>
<p>The special handling for the :has-default and :has-focus properties
has been removed. If you want to define the initial focus or the
the default widget in a .ui file, set the <a href="property.Window.default-widget.html"><code>GtkWindow:default-widget</code></a> or
<a href="property.Window.focus-widget.html"><code>GtkWindow:focus-widget</code></a> properties of the toplevel&nbsp;window.</p>
<h3 id="stop-using-the-gtkwidgetdisplay-changed-signal">Stop using the GtkWidget::display-changed signal<a class="md-anchor" href="#stop-using-the-gtkwidgetdisplay-changed-signal" title="Permanent link"></a></h3>
<p>To track the current display, use the <a href="property.Widget.root.html"><code>GtkWidget:root</code></a> property&nbsp;instead.</p>
<h3 id="gtkpopovermodal-has-been-renamed-to-autohide">GtkPopover::modal has been renamed to autohide<a class="md-anchor" href="#gtkpopovermodal-has-been-renamed-to-autohide" title="Permanent link"></a></h3>
<p>The modal property has been renamed to <a href="property.Popover.autohide.html"><code>GtkPopover:autohide</code></a>.</p>
<p><code>gtk-builder-tool</code> can assist with the rename in ui&nbsp;files.</p>
<h3 id="gtk_widget_get_surface-has-been-removed">gtk_widget_get_surface has been removed<a class="md-anchor" href="#gtk_widget_get_surface-has-been-removed" title="Permanent link"></a></h3>
<p><code>gtk_widget_get_surface()</code> has been removed.
Use <a href="method.Native.get_surface.html">gtk_native_get_surface()</a> in combination with
<a href="method.Widget.get_native.html">gtk_widget_get_native()</a>&nbsp;instead.</p>
<h3 id="gtk_widget_is_toplevel-has-been-removed">gtk_widget_is_toplevel has been removed<a class="md-anchor" href="#gtk_widget_is_toplevel-has-been-removed" title="Permanent link"></a></h3>
<p><code>gtk_widget_is_toplevel()</code> has been removed.
Use <code>GTK_IS_ROOT</code>, <code>GTK_IS_NATIVE</code> or <code>GTK_IS_WINDOW</code>
instead, as&nbsp;appropriate.</p>
<h3 id="gtk_widget_get_toplevel-has-been-removed">gtk_widget_get_toplevel has been removed<a class="md-anchor" href="#gtk_widget_get_toplevel-has-been-removed" title="Permanent link"></a></h3>
<p><code>gtk_widget_get_toplevel()</code> has been removed.
Use <a href="method.Widget.get_root.html">gtk_widget_get_root()</a> or <a href="method.Widget.get_native.html">gtk_widget_get_native()</a>
instead, as&nbsp;appropriate.</p>
<h3 id="gtkentrybuffer-deleted-text-has-changed">GtkEntryBuffer ::deleted-text has changed<a class="md-anchor" href="#gtkentrybuffer-deleted-text-has-changed" title="Permanent link"></a></h3>
<p>To allow signal handlers to access the deleted text before it
has been deleted, the <a href="signal.EntryBuffer.deleted-text.html"><code>GtkEntryBuffer::deleted-text</code></a> signal
has changed from <code>G_SIGNAL_RUN_FIRST</code> to <code>G_SIGNAL_RUN_LAST</code>. The default
handler removes the text from the <a href="class.EntryBuffer.html"><code>GtkEntryBuffer</code></a>.</p>
<p>To adapt existing code, use <code>g_signal_connect_after()</code> or
<code>G_CONNECT_AFTER</code> when using <code>g_signal_connect_data()</code> or
<code>g_signal_connect_object()</code>.</p>
<h3 id="gtkmenu-gtkmenubar-and-gtkmenuitem-are-gone">GtkMenu, GtkMenuBar and GtkMenuItem are gone<a class="md-anchor" href="#gtkmenu-gtkmenubar-and-gtkmenuitem-are-gone" title="Permanent link"></a></h3>
<p>These widgets were heavily relying on X11-centric concepts such as
override-redirect windows and grabs, and were hard to adjust to other
windowing&nbsp;systems.</p>
<p>Menus can already be replaced using GtkPopoverMenu in <span class="caps">GTK</span> 3. Additionally,
<span class="caps">GTK</span> 4 introduces GtkPopoverMenuBar to replace menubars. These new widgets
can only be constructed from menu models, so the porting effort involves
switching to menu models and&nbsp;actions.</p>
<p>Tabular menus were rarely used and complicated the menu code,
so they have not been brought over to <a href="class.PopoverMenu.html"><code>GtkPopoverMenu</code></a>.
If you need complex layout in menu-like popups, consider directly using a
<a href="class.Popover.html"><code>GtkPopover</code></a>&nbsp;instead.</p>
<p>Since menus are gone, <code>GtkMenuButton</code> also lost its ability to show menus,
and needs to be used with popovers in <span class="caps">GTK</span>&nbsp;4.</p>
<h3 id="gtktoolbar-has-been-removed">GtkToolbar has been removed<a class="md-anchor" href="#gtktoolbar-has-been-removed" title="Permanent link"></a></h3>
<p>Toolbars were using outdated concepts such as requiring special toolitem
widgets. Toolbars should be replaced by using a <code>GtkBox</code> with regular widgets
instead and the &#8220;toolbar&#8221; style&nbsp;class.</p>
<h3 id="gtkaspectframe-is-no-longer-a-frame">GtkAspectFrame is no longer a frame<a class="md-anchor" href="#gtkaspectframe-is-no-longer-a-frame" title="Permanent link"></a></h3>
<p><code>GtkAspectFrame</code> is no longer derived from <code>GtkFrame</code> and does not
place a label and frame around its child anymore. It still lets
you control the aspect ratio of its&nbsp;child.</p>
<h3 id="stop-using-custom-tooltip-windows">Stop using custom tooltip windows<a class="md-anchor" href="#stop-using-custom-tooltip-windows" title="Permanent link"></a></h3>
<p>Tooltips no longer use <code>GtkWindow</code>s in <span class="caps">GTK</span> 4, and it is no longer
possible to provide a custom window for tooltips. Replacing the content
of the tooltip with a custom widget is still possible, with
<a href="method.Tooltip.set_custom.html">gtk_tooltip_set_custom()</a>.</p>
<h3 id="switch-to-the-new-drag-and-drop-api">Switch to the new Drag-and-Drop api<a class="md-anchor" href="#switch-to-the-new-drag-and-drop-api" title="Permanent link"></a></h3>
<p>The source-side Drag-and-Drop apis in <span class="caps">GTK</span> 4 have been changed to use an event
controller, <a href="class.DragSource.html"><code>GtkDragSource</code></a>. Instead of calling <code>gtk_drag_source_set()</code>
and connecting to <code>GtkWidget</code> signals, you create a <a href="class.DragSource.html"><code>GtkDragSource</code></a> object,
attach it to the widget with <a href="method.Widget.add_controller.html">gtk_widget_add_controller()</a>, and connect
to <code>GtkDragSource</code> signals. Instead of calling <code>gtk_drag_begin()</code> on a widget
to start a drag manually, call <a href="javascript:void(0)" data-namespace="Gdk" data-link="type_func.Drag.begin.html" class="external">gdk_drag_begin()</a>.
The <code>::drag-data-get</code> signal has been replaced by the <a href="signal.DragSource.prepare.html"><code>GtkDragSource::prepare</code></a>
signal, which returns a <a href="javascript:void(0)" data-namespace="Gdk" data-link="class.ContentProvider.html" class="external"><code>GdkContentProvider</code></a> for the drag&nbsp;operation.</p>
<p>The destination-side Drag-and-Drop <span class="caps">API</span> in <span class="caps">GTK</span> 4 have also been changed
to use an event controller, <a href="class.DropTarget.html"><code>GtkDropTarget</code></a>. Instead of calling
<code>gtk_drag_dest_set()</code> and connecting to <code>GtkWidget</code> signals, you create
a <a href="class.DropTarget.html"><code>GtkDropTarget</code></a> object, attach it to the widget with
<a href="method.Widget.add_controller.html">gtk_widget_add_controller()</a>, and connect to <code>GtkDropTarget</code> signals.
The <code>::drag-motion</code> signal has been renamed to <a href="signal.DropTarget.accept.html"><code>GtkDropTarget::accept</code></a>,
and instead of <code>::drag-data-received</code>, you need to use async read methods on the
<a href="javascript:void(0)" data-namespace="Gdk" data-link="class.Drop.html" class="external"><code>GdkDrop</code></a> object, such as <a href="javascript:void(0)" data-namespace="Gdk" data-link="method.Drop.read_async.html" class="external">gdk_drop_read_async()</a> or
<a href="javascript:void(0)" data-namespace="Gdk" data-link="method.Drop.read_value_async.html" class="external">gdk_drop_read_value_async()</a>.</p>
<h3 id="adapt-to-gtkicontheme-api-changes">Adapt to GtkIconTheme API changes<a class="md-anchor" href="#adapt-to-gtkicontheme-api-changes" title="Permanent link"></a></h3>
<p><code>gtk_icon_theme_lookup_icon()</code> returns a <a href="class.IconPaintable.html"><code>GtkIconPaintable</code></a> object now,
instead of a <code>GtkIconInfo</code>. It always returns a paintable in the requested size,
and never fails. A number of no-longer-relevant lookup flags and <span class="caps">API</span> variants
have been&nbsp;removed.</p>
<p>Note that while <span class="caps">GTK</span> 4 is moving towards <a href="javascript:void(0)" data-namespace="Gdk" data-link="iface.Paintable.html" class="external"><code>GdkPaintable</code></a> as a primary <span class="caps">API</span>
for paintable content, it is meant to be a &#8216;pure&#8217; content producer, therefore
a <a href="class.IconPaintable.html"><code>GtkIconPaintable</code></a> for a symbolic icon will <em>not</em> get recolored depending
on the context it is rendered it. To properly render a symbolic icon that
is provided in the form of a <code>GtkIconPaintable</code> (this can be checked with
<a href="method.IconPaintable.is_symbolic.html">gtk_icon_paintable_is_symbolic()</a>), you have to call
<a href="method.IconPaintable.get_icon_name.html">gtk_icon_paintable_get_icon_name()</a> and set the icon name on a <code>GtkImage</code>.</p>
<h3 id="update-to-gtkfilechooser-api-changes">Update to GtkFileChooser API changes<a class="md-anchor" href="#update-to-gtkfilechooser-api-changes" title="Permanent link"></a></h3>
<p><code>GtkFileChooser</code> moved to a GFile-based <span class="caps">API</span>. If you need to convert a path
or a <span class="caps">URI</span>, use <code>g_file_new_for_path()</code>, <code>g_file_new_for_commandline_arg()</code>,
or <code>g_file_new_for_uri()</code>; similarly, if you need to get a path, name or <span class="caps">URI</span>
from a <code>GFile</code>, use <code>g_file_get_path()</code>, <code>g_file_get_basename()</code> or <code>g_file_get_uri()</code>.
With the removal or path and <span class="caps">URI</span>-based functions, the &#8220;local-only&#8221; property
has been removed; GFile can be used to access non-local as well as local&nbsp;resources.</p>
<p>The <code>GTK_FILE_CHOOSER_ACTION_CREATE_FOLDER</code> action has been removed. Use
<code>GTK_FILE_CHOOSER_ACTION_SELECT_FOLDER</code>, instead. If a new folder is needed,
the user can create&nbsp;one.</p>
<p>The &#8220;confirm-overwrite&#8221; signal, and the &#8220;do-overwrite-confirmation&#8221;
property have been removed from <code>GtkFileChooser</code>. The file chooser widgets
will automatically handle the confirmation of overwriting a file when
using <code>GTK_FILE_CHOOSER_ACTION_SAVE</code>.</p>
<p><code>GtkFileChooser</code> does not support a custom extra widget any more. If you
need to add extra widgets, use <a href="method.FileChooser.add_choice.html">gtk_file_chooser_add_choice()</a>&nbsp;instead.</p>
<p><code>GtkFileChooser</code> does not support a custom preview widget any&nbsp;more.</p>
<h3 id="stop-using-blocking-dialog-functions">Stop using blocking dialog functions<a class="md-anchor" href="#stop-using-blocking-dialog-functions" title="Permanent link"></a></h3>
<p><code>GtkDialog</code>, <code>GtkNativeDialog</code>, and <code>GtkPrintOperation</code> removed their
blocking <span class="caps">API</span> using nested main loops. Nested main loops present
re-entrancy issues and other hard to debug issues when coupled
with other event sources (<span class="caps">IPC</span>, accessibility, network operations)
that are not under the toolkit or the application developer&#8217;s
control. Additionally, &#8220;stop-the-world&#8221; functions do not fit
the event-driven programming model of <span class="caps">GTK</span>.</p>
<p>You can replace calls to <code>gtk_dialog_run()</code> by specifying that the
<code>GtkDialog</code> must be modal using <a href="method.Window.set_modal.html">gtk_window_set_modal()</a> or the
<code>GTK_DIALOG_MODAL</code> flag, and connecting to the <a href="signal.Dialog.response.html"><code>GtkDialog::response</code></a>&nbsp;signal.</p>
<h3 id="stop-using-gtkbuildable-api">Stop using GtkBuildable API<a class="md-anchor" href="#stop-using-gtkbuildable-api" title="Permanent link"></a></h3>
<p>All the <code>GtkBuildable</code> <span class="caps">API</span> was made private, except for the
getter function to retrieve the buildable <span class="caps">ID</span>. If you are
using <code>gtk_buildable_get_name()</code> you should replace it with
<a href="method.Buildable.get_buildable_id.html">gtk_buildable_get_buildable_id()</a>.</p>
<h3 id="adapt-to-gtkaboutdialog-api-changes">Adapt to GtkAboutDialog API changes<a class="md-anchor" href="#adapt-to-gtkaboutdialog-api-changes" title="Permanent link"></a></h3>
<p><code>GtkAboutDialog</code> now directly derives from <code>GtkWindow</code>, the <code>GtkDialog</code>
<span class="caps">API</span> can no longer be used on&nbsp;it.</p>
<h3 id="adapt-to-gtktreeview-and-gtkiconview-tooltip-context-changes">Adapt to GtkTreeView and GtkIconView tooltip context changes<a class="md-anchor" href="#adapt-to-gtktreeview-and-gtkiconview-tooltip-context-changes" title="Permanent link"></a></h3>
<p>The getter functions for retrieving the data from <code>GtkTreeView</code>
and <code>GtkIconView</code> inside a <code>GtkWidget::query-tooltip</code> signal do not take the
pointer coordinates as inout arguments any more, but as normal in&nbsp;ones.</p>
<p>See: <a href="method.TreeView.get_tooltip_context.html">gtk_tree_view_get_tooltip_context()</a>, <a href="method.IconView.get_tooltip_context.html">gtk_icon_view_get_tooltip_context()</a></p>
<h3 id="stop-using-gtkfilechooserbutton">Stop using GtkFileChooserButton<a class="md-anchor" href="#stop-using-gtkfilechooserbutton" title="Permanent link"></a></h3>
<p>The <code>GtkFileChooserButton</code> widget was removed, due to its shortcomings in
the user interaction. You can replace it with a simple <code>GtkButton</code> that
shows a <a href="class.FileChooserNative.html"><code>GtkFileChooserNative</code></a> dialog when clicked; once the file selection
has completed, you can update the label of the <code>GtkButton</code> with the selected&nbsp;file.</p>
<h3 id="adapt-to-changed-gtksettings-properties">Adapt to changed GtkSettings properties<a class="md-anchor" href="#adapt-to-changed-gtksettings-properties" title="Permanent link"></a></h3>
<p>In <span class="caps">GTK</span> 3 the <a href="property.Settings.gtk-cursor-aspect-ratio.html"><code>GtkSettings:gtk-cursor-aspect-ratio</code></a> property of
<code>GtkSettings</code> was a <code>float</code>. In <span class="caps">GTK</span> 4 this has been changed to a <code>double</code>.</p>
<h2 id="changes-to-consider-after-the-switch">Changes to consider after the switch<a class="md-anchor" href="#changes-to-consider-after-the-switch" title="Permanent link"></a></h2>
<p><span class="caps">GTK</span> 4 has a number of new features that you may want to take
advantage of once the dust has settled over the initial&nbsp;migration.</p>
<h3 id="consider-porting-to-the-new-list-widgets">Consider porting to the new list widgets<a class="md-anchor" href="#consider-porting-to-the-new-list-widgets" title="Permanent link"></a></h3>
<p>In <span class="caps">GTK</span> 2 and 3, <code>GtkTreeModel</code> and <code>GtkCellRenderer</code> and widgets using
these were the primary way of displaying data and lists. <span class="caps">GTK</span> 4 brings
a new family of widgets for this purpose that uses list models instead
of tree models, and widgets instead of cell&nbsp;renderers.</p>
<p>To learn more about the new list widgets, you can read the <a href="ListWidget">List Widget
Overview</a>.</p>
    </div>
  </section>
</section>


    <section id="search" class="content hidden"></section>

    <footer>
    
    </footer>
  </div>
</body>
</html>